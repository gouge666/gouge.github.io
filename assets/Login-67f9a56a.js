/* empty css             *//* empty css                  */import{c as U,g as of,d as sf,r as Je,o as af,a as St,b as he,u as W,F as Fi,e as Te,w as lt,i as me,f as Bi,h as Oe,v as xe,E as Fr,j as Br,k as uf,l as cf,m as At,n as Dr,t as Lr,p as Tn,q as Ur,s as ps,x as ff,y as lf,z as hf,A as df,B as pf,_ as gf}from"./index-35a9e344.js";var qe={},pn={},De={};Object.defineProperty(De,"__esModule",{value:!0});De.COMMUNITY_SITE_URL=De.IS_DEBUG_MODE=De.getProtocol=De.setProtocol=De.getSdkName=De.setSdkName=void 0;var Aa="@cloudbase/js-sdk";function yf(t){Aa=t}De.setSdkName=yf;function vf(){return Aa}De.getSdkName=vf;var Ta=typeof location<"u"&&location.protocol==="http:"?"http:":"https:";function mf(t){Ta=t}De.setProtocol=mf;function _f(){return Ta}De.getProtocol=_f;De.IS_DEBUG_MODE=!1;De.COMMUNITY_SITE_URL="https://support.qq.com/products/148793";var ni={};Object.defineProperty(ni,"__esModule",{value:!0});ni.ERRORS=void 0;ni.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"};(function(t){var e=U&&U.__createBinding||(Object.create?function(i,o,n,a){a===void 0&&(a=n),Object.defineProperty(i,a,{enumerable:!0,get:function(){return o[n]}})}:function(i,o,n,a){a===void 0&&(a=n),i[a]=o[n]}),r=U&&U.__exportStar||function(i,o){for(var n in i)n!=="default"&&!o.hasOwnProperty(n)&&e(o,i,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(De,t),r(ni,t)})(pn);var Ia={},Er={},$n;(function(t){t.local="local",t.none="none",t.session="session"})($n||($n={}));var Oa=function(){function t(){}return t}(),wf=function(){function t(){}return t}();function mo(t,e,r){r===void 0&&(r={});var i=/\?/.test(e),o="";for(var n in r)o===""?!i&&(e+="?"):o+="&",o+=n+"="+encodeURIComponent(r[n]);return e+=o,/^http(s)?\:\/\//.test(e)?e:""+t+e}const Ef=Object.freeze(Object.defineProperty({__proto__:null,AbstractSDKRequest:Oa,AbstractStorage:wf,get StorageType(){return $n},formatUrl:mo},Symbol.toStringTag,{value:"Module"})),xa=of(Ef);var q={},_o={},bf={get exports(){return _o},set exports(t){_o=t}},jn={},Sf={get exports(){return jn},set exports(t){jn=t}},gs;function gn(){return gs||(gs=1,function(t,e){(function(r,i){t.exports=i()})(U,function(){var r=r||function(i,o){var n=Object.create||function(){function m(){}return function(_){var x;return m.prototype=_,x=new m,m.prototype=null,x}}(),a={},c=a.lib={},h=c.Base=function(){return{extend:function(m){var _=n(this);return m&&_.mixIn(m),(!_.hasOwnProperty("init")||this.init===_.init)&&(_.init=function(){_.$super.init.apply(this,arguments)}),_.init.prototype=_,_.$super=this,_},create:function(){var m=this.extend();return m.init.apply(m,arguments),m},init:function(){},mixIn:function(m){for(var _ in m)m.hasOwnProperty(_)&&(this[_]=m[_]);m.hasOwnProperty("toString")&&(this.toString=m.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=c.WordArray=h.extend({init:function(m,_){m=this.words=m||[],_!=o?this.sigBytes=_:this.sigBytes=m.length*4},toString:function(m){return(m||d).stringify(this)},concat:function(m){var _=this.words,x=m.words,I=this.sigBytes,T=m.sigBytes;if(this.clamp(),I%4)for(var F=0;F<T;F++){var R=x[F>>>2]>>>24-F%4*8&255;_[I+F>>>2]|=R<<24-(I+F)%4*8}else for(var F=0;F<T;F+=4)_[I+F>>>2]=x[F>>>2];return this.sigBytes+=T,this},clamp:function(){var m=this.words,_=this.sigBytes;m[_>>>2]&=4294967295<<32-_%4*8,m.length=i.ceil(_/4)},clone:function(){var m=h.clone.call(this);return m.words=this.words.slice(0),m},random:function(m){for(var _=[],x=function(L){var L=L,k=987654321,B=4294967295;return function(){k=36969*(k&65535)+(k>>16)&B,L=18e3*(L&65535)+(L>>16)&B;var ue=(k<<16)+L&B;return ue/=4294967296,ue+=.5,ue*(i.random()>.5?1:-1)}},I=0,T;I<m;I+=4){var F=x((T||i.random())*4294967296);T=F()*987654071,_.push(F()*4294967296|0)}return new s.init(_,m)}}),u=a.enc={},d=u.Hex={stringify:function(m){for(var _=m.words,x=m.sigBytes,I=[],T=0;T<x;T++){var F=_[T>>>2]>>>24-T%4*8&255;I.push((F>>>4).toString(16)),I.push((F&15).toString(16))}return I.join("")},parse:function(m){for(var _=m.length,x=[],I=0;I<_;I+=2)x[I>>>3]|=parseInt(m.substr(I,2),16)<<24-I%8*4;return new s.init(x,_/2)}},y=u.Latin1={stringify:function(m){for(var _=m.words,x=m.sigBytes,I=[],T=0;T<x;T++){var F=_[T>>>2]>>>24-T%4*8&255;I.push(String.fromCharCode(F))}return I.join("")},parse:function(m){for(var _=m.length,x=[],I=0;I<_;I++)x[I>>>2]|=(m.charCodeAt(I)&255)<<24-I%4*8;return new s.init(x,_)}},w=u.Utf8={stringify:function(m){try{return decodeURIComponent(escape(y.stringify(m)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(m){return y.parse(unescape(encodeURIComponent(m)))}},E=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(m){typeof m=="string"&&(m=w.parse(m)),this._data.concat(m),this._nDataBytes+=m.sigBytes},_process:function(m){var _=this._data,x=_.words,I=_.sigBytes,T=this.blockSize,F=T*4,R=I/F;m?R=i.ceil(R):R=i.max((R|0)-this._minBufferSize,0);var L=R*T,k=i.min(L*4,I);if(L){for(var B=0;B<L;B+=T)this._doProcessBlock(x,B);var ue=x.splice(0,L);_.sigBytes-=k}return new s.init(ue,k)},clone:function(){var m=h.clone.call(this);return m._data=this._data.clone(),m},_minBufferSize:0});c.Hasher=E.extend({cfg:h.extend(),init:function(m){this.cfg=this.cfg.extend(m),this.reset()},reset:function(){E.reset.call(this),this._doReset()},update:function(m){return this._append(m),this._process(),this},finalize:function(m){m&&this._append(m);var _=this._doFinalize();return _},blockSize:16,_createHelper:function(m){return function(_,x){return new m.init(x).finalize(_)}},_createHmacHelper:function(m){return function(_,x){return new A.HMAC.init(m,x).finalize(_)}}});var A=a.algo={};return a}(Math);return r})}(Sf)),jn}var Wn={},Af={get exports(){return Wn},set exports(t){Wn=t}},ys;function Tf(){return ys||(ys=1,function(t,e){(function(r,i){t.exports=i(gn())})(U,function(r){return function(i){var o=r,n=o.lib,a=n.WordArray,c=n.Hasher,h=o.algo,s=[],u=[];(function(){function w(_){for(var x=i.sqrt(_),I=2;I<=x;I++)if(!(_%I))return!1;return!0}function E(_){return(_-(_|0))*4294967296|0}for(var A=2,m=0;m<64;)w(A)&&(m<8&&(s[m]=E(i.pow(A,1/2))),u[m]=E(i.pow(A,1/3)),m++),A++})();var d=[],y=h.SHA256=c.extend({_doReset:function(){this._hash=new a.init(s.slice(0))},_doProcessBlock:function(w,E){for(var A=this._hash.words,m=A[0],_=A[1],x=A[2],I=A[3],T=A[4],F=A[5],R=A[6],L=A[7],k=0;k<64;k++){if(k<16)d[k]=w[E+k]|0;else{var B=d[k-15],ue=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,fe=d[k-2],ye=(fe<<15|fe>>>17)^(fe<<13|fe>>>19)^fe>>>10;d[k]=ue+d[k-7]+ye+d[k-16]}var Y=T&F^~T&R,Ae=m&_^m&x^_&x,Ne=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),ft=(T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25),re=L+ft+Y+u[k]+d[k],Re=Ne+Ae;L=R,R=F,F=T,T=I+re|0,I=x,x=_,_=m,m=re+Re|0}A[0]=A[0]+m|0,A[1]=A[1]+_|0,A[2]=A[2]+x|0,A[3]=A[3]+I|0,A[4]=A[4]+T|0,A[5]=A[5]+F|0,A[6]=A[6]+R|0,A[7]=A[7]+L|0},_doFinalize:function(){var w=this._data,E=w.words,A=this._nDataBytes*8,m=w.sigBytes*8;return E[m>>>5]|=128<<24-m%32,E[(m+64>>>9<<4)+14]=i.floor(A/4294967296),E[(m+64>>>9<<4)+15]=A,w.sigBytes=E.length*4,this._process(),this._hash},clone:function(){var w=c.clone.call(this);return w._hash=this._hash.clone(),w}});o.SHA256=c._createHelper(y),o.HmacSHA256=c._createHmacHelper(y)}(Math),r.SHA256})}(Af)),Wn}var qn={},If={get exports(){return qn},set exports(t){qn=t}},vs;function Of(){return vs||(vs=1,function(t,e){(function(r,i){t.exports=i(gn())})(U,function(r){(function(){var i=r,o=i.lib,n=o.Base,a=i.enc,c=a.Utf8,h=i.algo;h.HMAC=n.extend({init:function(s,u){s=this._hasher=new s.init,typeof u=="string"&&(u=c.parse(u));var d=s.blockSize,y=d*4;u.sigBytes>y&&(u=s.finalize(u)),u.clamp();for(var w=this._oKey=u.clone(),E=this._iKey=u.clone(),A=w.words,m=E.words,_=0;_<d;_++)A[_]^=1549556828,m[_]^=909522486;w.sigBytes=E.sigBytes=y,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var u=this._hasher,d=u.finalize(s);u.reset();var y=u.finalize(this._oKey.clone().concat(d));return y}})})()})}(If)),qn}(function(t,e){(function(r,i,o){t.exports=i(gn(),Tf(),Of())})(U,function(r){return r.HmacSHA256})})(bf);var wo={},xf={get exports(){return wo},set exports(t){wo=t}};(function(t,e){(function(r,i){t.exports=i(gn())})(U,function(r){return function(){var i=r,o=i.lib,n=o.WordArray,a=i.enc;a.Base64={stringify:function(h){var s=h.words,u=h.sigBytes,d=this._map;h.clamp();for(var y=[],w=0;w<u;w+=3)for(var E=s[w>>>2]>>>24-w%4*8&255,A=s[w+1>>>2]>>>24-(w+1)%4*8&255,m=s[w+2>>>2]>>>24-(w+2)%4*8&255,_=E<<16|A<<8|m,x=0;x<4&&w+x*.75<u;x++)y.push(d.charAt(_>>>6*(3-x)&63));var I=d.charAt(64);if(I)for(;y.length%4;)y.push(I);return y.join("")},parse:function(h){var s=h.length,u=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var y=0;y<u.length;y++)d[u.charCodeAt(y)]=y}var w=u.charAt(64);if(w){var E=h.indexOf(w);E!==-1&&(s=E)}return c(h,s,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(h,s,u){for(var d=[],y=0,w=0;w<s;w++)if(w%4){var E=u[h.charCodeAt(w-1)]<<w%4*2,A=u[h.charCodeAt(w)]>>>6-w%4*2;d[y>>>2]|=(E|A)<<24-y%4*8,y++}return n.create(d,y)}}(),r.enc.Base64})})(xf);var Eo={},Nf={get exports(){return Eo},set exports(t){Eo=t}};(function(t,e){(function(r,i){t.exports=i(gn())})(U,function(r){return r.enc.Utf8})})(Nf);var Do=U&&U.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(q,"__esModule",{value:!0});q.transformPhone=q.sleep=q.printGroupLog=q.throwError=q.printInfo=q.printError=q.printWarn=q.execCallback=q.createPromiseCallback=q.removeParam=q.getHash=q.getQuery=q.toQueryString=q.createSign=q.formatUrl=q.genSeqId=q.isFormData=q.isInstanceOf=q.isNull=q.isPalinObject=q.isUndefined=q.isString=q.isArray=void 0;var Rf=Do(_o),Cf=Do(wo),ms=Do(Eo),ii=pn;function Pf(t){return Object.prototype.toString.call(t)==="[object Array]"}q.isArray=Pf;function Ff(t){return typeof t=="string"}q.isString=Ff;function Bf(t){return typeof t>"u"}q.isUndefined=Bf;function Df(t){return Object.prototype.toString.call(t)==="[object Object]"}q.isPalinObject=Df;function Lf(t){return Object.prototype.toString.call(t)==="[object Null]"}q.isNull=Lf;function Uf(t,e){return t instanceof e}q.isInstanceOf=Uf;function Mf(t){return Object.prototype.toString.call(t)==="[object FormData]"}q.isFormData=Mf;function kf(){return Math.random().toString(16).slice(2)}q.genSeqId=kf;function $f(t,e,r){r===void 0&&(r={});var i=/\?/.test(e),o="";for(var n in r)o===""?!i&&(e+="?"):o+="&",o+=n+"="+encodeURIComponent(r[n]);return e+=o,/^http(s)?\:\/\//.test(e)?e:""+t+e}q.formatUrl=$f;function Di(t){var e=Cf.default.stringify(t);return e=e.replace(/=+$/,""),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_"),e}function jf(t,e){var r={alg:"HS256",typ:"JWT"},i=Di(ms.default.parse(JSON.stringify(r))),o=Di(ms.default.parse(JSON.stringify(t))),n=i+"."+o,a=Di(Rf.default(n,e));return n+"."+a}q.createSign=jf;function Wf(t){t===void 0&&(t={});var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")}q.toQueryString=Wf;function qf(t,e){if(typeof window>"u")return!1;var r=e||window.location.search,i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=r.substr(r.indexOf("?")+1).match(i);return o!=null?o[2]:""}q.getQuery=qf;q.getHash=function(t){if(typeof window>"u")return"";var e=window.location.hash.match(new RegExp("[#?&/]"+t+"=([^&#]*)"));return e?e[1]:""};function Hf(t,e){var r=e.split("?")[0],i,o=[],n=e.indexOf("?")!==-1?e.split("?")[1]:"";if(n!==""){o=n.split("&");for(var a=o.length-1;a>=0;a-=1)i=o[a].split("=")[0],i===t&&o.splice(a,1);r=r+"?"+o.join("&")}return r}q.removeParam=Hf;function Gf(){var t;if(!Promise){t=function(){},t.promise={};var e=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(t.promise,"then",{get:e}),Object.defineProperty(t.promise,"catch",{get:e}),t}var r=new Promise(function(i,o){t=function(n,a){return n?o(n):i(a)}});return t.promise=r,t}q.createPromiseCallback=Gf;function Kf(t,e,r){if(r===void 0&&(r=null),t&&typeof t=="function")return t(e,r);if(e)throw e;return r}q.execCallback=Kf;function Vf(t,e){console.warn("["+ii.getSdkName()+"]["+t+"]:"+e)}q.printWarn=Vf;function Jf(t,e){console.error({code:t,msg:"["+ii.getSdkName()+"]["+t+"]:"+e})}q.printError=Jf;function Yf(t,e){console.log("["+ii.getSdkName()+"]["+t+"]:"+e)}q.printInfo=Yf;function Xf(t,e){throw new Error(JSON.stringify({code:t,msg:"["+ii.getSdkName()+"]["+t+"]:"+e}))}q.throwError=Xf;function zf(t){var e=t.title,r=t.subtitle,i=r===void 0?"":r,o=t.content,n=o===void 0?[]:o,a=t.printTrace,c=a===void 0?!1:a,h=t.collapsed,s=h===void 0?!1:h;s?console.groupCollapsed(e,i):console.group(e,i);for(var u=0,d=n;u<d.length;u++){var y=d[u],w=y.type,E=y.body;switch(w){case"info":console.log(E);break;case"warn":console.warn(E);break;case"error":console.error(E);break}}c&&console.trace("stack trace:"),console.groupEnd()}q.printGroupLog=zf;q.sleep=function(t){return t===void 0&&(t=0),new Promise(function(e){return setTimeout(e,t)})};function Qf(t){return"+86"+t}q.transformPhone=Qf;var Zf=U&&U.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Xe=U&&U.__assign||function(){return Xe=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Xe.apply(this,arguments)},el=U&&U.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},tl=U&&U.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(Er,"__esModule",{value:!0});Er.WebRequest=Er.genAdapter=void 0;var rl=xa,Li=q,nl=De,Na=function(t){Zf(e,t);function e(r){var i=t.call(this)||this,o=r.timeout,n=r.timeoutMsg,a=r.restrictedMethods;return i._timeout=o||0,i._timeoutMsg=n||"请求超时",i._restrictedMethods=a||["get","post","upload","download"],i}return e.prototype.get=function(r){return this._request(Xe(Xe({},r),{method:"get"}),this._restrictedMethods.includes("get"))},e.prototype.post=function(r){return this._request(Xe(Xe({},r),{method:"post"}),this._restrictedMethods.includes("post"))},e.prototype.put=function(r){return this._request(Xe(Xe({},r),{method:"put"}))},e.prototype.upload=function(r){var i=r.data,o=r.file,n=r.name,a=new FormData;for(var c in i)a.append(c,i[c]);return a.append("key",n),a.append("file",o),this._request(Xe(Xe({},r),{data:a,method:"post"}),this._restrictedMethods.includes("upload"))},e.prototype.download=function(r){return el(this,void 0,void 0,function(){var i,o,n,a;return tl(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.get(Xe(Xe({},r),{headers:{},responseType:"blob"}))];case 1:return i=c.sent().data,o=window.URL.createObjectURL(new Blob([i])),n=decodeURIComponent(new URL(r.url).pathname.split("/").pop()||""),a=document.createElement("a"),a.href=o,a.setAttribute("download",n),a.style.display="none",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a),[3,3];case 2:return c.sent(),[3,3];case 3:return[2,new Promise(function(h){h({statusCode:200,tempFilePath:r.url})})]}})})},e.prototype._request=function(r,i){var o=this;i===void 0&&(i=!1);var n=String(r.method).toLowerCase()||"get";return new Promise(function(a){var c=r.url,h=r.headers,s=h===void 0?{}:h,u=r.data,d=r.responseType,y=r.withCredentials,w=r.body,E=r.onUploadProgress,A=Li.formatUrl(nl.getProtocol(),c,n==="get"?u:{}),m=new XMLHttpRequest;m.open(n,A),d&&(m.responseType=d);for(var _ in s)m.setRequestHeader(_,s[_]);var x;E&&m.upload.addEventListener("progress",E),m.onreadystatechange=function(){var T={};if(m.readyState===4){var F=m.getAllResponseHeaders(),R=F.trim().split(/[\r\n]+/),L={};R.forEach(function(k){var B=k.split(": "),ue=B.shift().toLowerCase(),fe=B.join(": ");L[ue]=fe}),T.header=L,T.statusCode=m.status;try{T.data=d==="blob"?m.response:JSON.parse(m.responseText)}catch{T.data=d==="blob"?m.response:m.responseText}clearTimeout(x),a(T)}},i&&o._timeout&&(x=setTimeout(function(){console.warn(o._timeoutMsg),m.abort()},o._timeout));var I;Li.isFormData(u)?I=u:s["content-type"]==="application/x-www-form-urlencoded"?I=Li.toQueryString(u):w?I=w:I=u?JSON.stringify(u):void 0,y&&(m.withCredentials=!0),m.send(I)})},e}(rl.AbstractSDKRequest);Er.WebRequest=Na;function il(){var t={root:window,reqClass:Na,wsClass:WebSocket,localStorage,sessionStorage};return t}Er.genAdapter=il;(function(t){var e=U&&U.__createBinding||(Object.create?function(s,u,d,y){y===void 0&&(y=d),Object.defineProperty(s,y,{enumerable:!0,get:function(){return u[d]}})}:function(s,u,d,y){y===void 0&&(y=d),s[y]=u[d]}),r=U&&U.__setModuleDefault||(Object.create?function(s,u){Object.defineProperty(s,"default",{enumerable:!0,value:u})}:function(s,u){s.default=u}),i=U&&U.__importStar||function(s){if(s&&s.__esModule)return s;var u={};if(s!=null)for(var d in s)d!=="default"&&Object.hasOwnProperty.call(s,d)&&e(u,s,d);return r(u,s),u};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var o=i(Er),n=q,a;(function(s){s.WEB="web",s.WX_MP="wx_mp"})(a=t.RUNTIME||(t.RUNTIME={}));function c(s){for(var u=n.isArray(s)?s:[s],d=0,y=u;d<y.length;d++){var w=y[d],E=w.isMatch,A=w.genAdapter,m=w.runtime;if(E())return{adapter:A(),runtime:m}}}t.useAdapters=c;function h(){return{adapter:o.genAdapter(),runtime:a.WEB}}t.useDefaultAdapter=h})(Ia);var oi={},ol=U&&U.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),In=U&&U.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},On=U&&U.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(oi,"__esModule",{value:!0});oi.CloudbaseCache=void 0;var sl=xa,ct=q,yt=pn,xn=function(t){ol(e,t);function e(r){var i=t.call(this)||this;return i._root=r,r.tcbCacheObject||(r.tcbCacheObject={}),i}return e.prototype.setItem=function(r,i){this._root.tcbCacheObject[r]=i},e.prototype.getItem=function(r){return this._root.tcbCacheObject[r]},e.prototype.removeItem=function(r){delete this._root.tcbCacheObject[r]},e.prototype.clear=function(){delete this._root.tcbCacheObject},e}(sl.AbstractStorage);function Ui(t,e){switch(t){case"local":return e.localStorage?e.localStorage:(ct.printWarn(yt.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new xn(e.root));case"none":return new xn(e.root);case"session":return e.sessionStorage?e.sessionStorage:(ct.printWarn(yt.ERRORS.INVALID_PARAMS,"sessionStorage is not supported on current platform"),new xn(e.root));default:return e.localStorage?e.localStorage:(ct.printWarn(yt.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new xn(e.root))}}var al=function(){function t(e){this.keys={};var r=e.persistence,i=e.platformInfo,o=i===void 0?{}:i,n=e.keys,a=n===void 0?{}:n,c=e.alwaysLocalKeys,h=c===void 0?[]:c;this._platformInfo=o,this._alwaysLocalKeys=h,this._storage||(this._persistence=o.adapter.primaryStorage||r,this._storage=Ui(this._persistence,o.adapter),this.keys=a)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this._persistence},enumerable:!1,configurable:!0}),t.prototype.updatePersistence=function(e){if(this.mode==="async"){ct.printWarn(yt.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use updatePersistenceAsync insteed");return}if(e!==this._persistence){var r=this._persistence==="local";this._persistence=e;var i=Ui(e,this._platformInfo.adapter);for(var o in this.keys){var n=this.keys[o];if(!(r&&this._alwaysLocalKeys.includes(o))){var a=this._storage.getItem(n);!ct.isUndefined(a)&&!ct.isNull(a)&&(i.setItem(n,a),this._storage.removeItem(n))}}this._storage=i}},t.prototype.updatePersistenceAsync=function(e){return In(this,void 0,void 0,function(){var r,i,o,n,a,c,h,s;return On(this,function(u){switch(u.label){case 0:if(e===this._persistence)return[2];r=this._persistence==="local",this._persistence=e,i=Ui(e,this._platformInfo.adapter),o=[];for(n in this.keys)o.push(n);a=0,u.label=1;case 1:return a<o.length?(c=o[a],h=this.keys[c],r&&this._alwaysLocalKeys.includes(c)?[3,4]:[4,this._storage.getItem(h)]):[3,5];case 2:return s=u.sent(),!ct.isUndefined(s)&&!ct.isNull(s)?(i.setItem(h,s),[4,this._storage.removeItem(h)]):[3,4];case 3:u.sent(),u.label=4;case 4:return a++,[3,1];case 5:return this._storage=i,[2]}})})},t.prototype.setStore=function(e,r,i){if(this.mode==="async"){ct.printWarn(yt.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed");return}if(this._storage)try{var o={version:i||"localCachev1",content:r};this._storage.setItem(e,JSON.stringify(o))}catch(n){throw new Error(JSON.stringify({code:yt.ERRORS.OPERATION_FAIL,msg:"["+yt.getSdkName()+"]["+yt.ERRORS.OPERATION_FAIL+"]setStore failed",info:n}))}},t.prototype.setStoreAsync=function(e,r,i){return In(this,void 0,void 0,function(){var o;return On(this,function(n){switch(n.label){case 0:if(!this._storage)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),o={version:i||"localCachev1",content:r},[4,this._storage.setItem(e,JSON.stringify(o))];case 2:return n.sent(),[3,4];case 3:return n.sent(),[2];case 4:return[2]}})})},t.prototype.getStore=function(e,r){var i;if(this.mode==="async"){ct.printWarn(yt.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed");return}try{if(typeof process<"u"&&(!((i=process.env)===null||i===void 0)&&i.tcb_token))return{}.tcb_token;if(!this._storage)return""}catch{return""}r=r||"localCachev1";var o=this._storage.getItem(e);if(!o)return"";if(o.indexOf(r)>=0){var n=JSON.parse(o);return n.content}else return""},t.prototype.getStoreAsync=function(e,r){var i;return In(this,void 0,void 0,function(){var o,n;return On(this,function(a){switch(a.label){case 0:try{if(typeof process<"u"&&(!((i=process.env)===null||i===void 0)&&i.tcb_token))return[2,{}.tcb_token];if(!this._storage)return[2,""]}catch{return[2,""]}return r=r||"localCachev1",[4,this._storage.getItem(e)];case 1:return o=a.sent(),o?o.indexOf(r)>=0?(n=JSON.parse(o),[2,n.content]):[2,""]:[2,""]}})})},t.prototype.removeStore=function(e){if(this.mode==="async"){ct.printWarn(yt.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed");return}this._storage.removeItem(e)},t.prototype.removeStoreAsync=function(e){return In(this,void 0,void 0,function(){return On(this,function(r){switch(r.label){case 0:return[4,this._storage.removeItem(e)];case 1:return r.sent(),[2]}})})},t}();oi.CloudbaseCache=al;var ke={},ul=U&&U.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),cl=U&&U.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<r;e++)for(var n=arguments[e],a=0,c=n.length;a<c;a++,o++)i[o]=n[a];return i};Object.defineProperty(ke,"__esModule",{value:!0});ke.removeEventListener=ke.activateEvent=ke.addEventListener=ke.CloudbaseEventEmitter=ke.IErrorEvent=ke.CloudbaseEvent=void 0;var _s=q;function fl(t,e,r){r[t]=r[t]||[],r[t].push(e)}function ll(t,e,r){if(r!=null&&r[t]){var i=r[t].indexOf(e);i!==-1&&r[t].splice(i,1)}}var Lo=function(){function t(e,r){this.data=r||null,this.name=e}return t}();ke.CloudbaseEvent=Lo;var Ra=function(t){ul(e,t);function e(r,i){var o=t.call(this,"error",{error:r,data:i})||this;return o.error=r,o}return e}(Lo);ke.IErrorEvent=Ra;var Ca=function(){function t(){this._listeners={}}return t.prototype.on=function(e,r){return fl(e,r,this._listeners),this},t.prototype.off=function(e,r){return ll(e,r,this._listeners),this},t.prototype.fire=function(e,r){if(_s.isInstanceOf(e,Ra))return console.error(e.error),this;var i=_s.isString(e)?new Lo(e,r||{}):e,o=i.name;if(this._listens(o)){i.target=this;for(var n=this._listeners[o]?cl(this._listeners[o]):[],a=0,c=n;a<c.length;a++){var h=c[a];h.call(this,i)}}return this},t.prototype._listens=function(e){return this._listeners[e]&&this._listeners[e].length>0},t}();ke.CloudbaseEventEmitter=Ca;var Uo=new Ca;function hl(t,e){Uo.on(t,e)}ke.addEventListener=hl;function dl(t,e){e===void 0&&(e={}),Uo.fire(t,e)}ke.activateEvent=dl;function pl(t,e){Uo.off(t,e)}ke.removeEventListener=pl;var Pa={},si={},gl=U&&U.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},yl=U&&U.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(si,"__esModule",{value:!0});si.catchErrorsDecorator=void 0;var ws=q,vl=pn,sn=!1;typeof navigator<"u"&&navigator.userAgent&&(sn=navigator.userAgent.indexOf("Firefox")!==-1);var ml=sn?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,Fa=/https?\:\/\/.+\:\d*\/.*\.js\:\d+\:\d+/;function _l(t){var e=t.mode,r=e===void 0?"async":e,i=t.customInfo,o=i===void 0?{}:i,n=t.title,a=t.messages,c=a===void 0?[]:a;return function(h,s,u){if(vl.IS_DEBUG_MODE){var d=o.className||h.constructor.name,y=o.methodName||s,w=u.value,E=wl(new Error);r==="sync"?u.value=function(){for(var A=[],m=0;m<arguments.length;m++)A[m]=arguments[m];var _=Es({err:new Error,className:d,methodName:y,sourceLink:E});try{return w.apply(this,A)}catch(R){var x=R,I=R.message,T={title:n||d+"."+y+" failed",content:[{type:"error",body:R}]};if(I&&/^\{.*\}$/.test(I)){var F=JSON.parse(I);T.subtitle=I,F.code&&(_?(_.code=F.code,_.msg=F.msg):(R.code=F.code,R.message=F.msg),x=_||R,T.content=c.map(function(L){return{type:"info",body:L}}))}throw ws.printGroupLog(T),x}}:u.value=function(){for(var A=[],m=0;m<arguments.length;m++)A[m]=arguments[m];return gl(this,void 0,void 0,function(){var _,x,I,T,F,R;return yl(this,function(L){switch(L.label){case 0:_=Es({err:new Error,className:d,methodName:y,sourceLink:E}),L.label=1;case 1:return L.trys.push([1,3,,4]),[4,w.apply(this,A)];case 2:return[2,L.sent()];case 3:throw x=L.sent(),I=x,T=x.message,F={title:n||d+"."+y+" failed",content:[{type:"error",body:x}]},T&&/^\{.*\}$/.test(T)&&(R=JSON.parse(T),F.subtitle=R,R.code&&(_?(_.code=R.code,_.message=R.msg):(x.code=R.code,x.message=R.msg),I=_||x,F.content=c.map(function(k){return{type:"info",body:k}}))),ws.printGroupLog(F),I;case 4:return[2]}})})}}}}si.catchErrorsDecorator=_l;function wl(t){var e="",r=t.stack.split(`
`),i=r.findIndex(function(n){return ml.test(n)});if(i!==-1){var o=Fa.exec(r[i+1]||"");e=o?o[0]:""}return e}function Es(t){var e=t.err,r=t.className,i=t.methodName,o=t.sourceLink;if(!o)return null;var n=e.stack.split(`
`),a=sn?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp(r+"\\.descriptor.value\\s*\\[as\\s"+i+"\\]\\s*\\(.*\\)$"),c=sn?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp(r+"\\.descriptor.value\\s*\\[as\\s"+i+"\\]"),h=n.findIndex(function(d){return a.test(d)}),s;if(h!==-1){var u=n.filter(function(d,y){return y>h});u.unshift(n[h].replace(c,r+"."+i).replace(Fa,o)),s=new Error,s.stack=(sn?"@debugger":"Error")+`
`+u.join(`
`)}return s}(function(t){var e=U&&U.__createBinding||(Object.create?function(i,o,n,a){a===void 0&&(a=n),Object.defineProperty(i,a,{enumerable:!0,get:function(){return o[n]}})}:function(i,o,n,a){a===void 0&&(a=n),i[a]=o[n]}),r=U&&U.__exportStar||function(i,o){for(var n in i)n!=="default"&&!o.hasOwnProperty(n)&&e(o,i,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(si,t)})(Pa);var El=U&&U.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),bl=U&&U.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),br=U&&U.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.hasOwnProperty.call(t,r)&&El(e,t,r);return bl(e,t),e};Object.defineProperty(qe,"__esModule",{value:!0});var ot=qe.helpers=ie=qe.utils=Mo=qe.events=Ba=qe.cache=er=qe.adapters=ee=qe.constants=void 0,Sl=br(pn),ee=qe.constants=Sl,Al=br(Ia),er=qe.adapters=Al,Tl=br(oi),Ba=qe.cache=Tl,Il=br(ke),Mo=qe.events=Il,Ol=br(q),ie=qe.utils=Ol,xl=br(Pa);ot=qe.helpers=xl;var Nl=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Hn=globalThis&&globalThis.__assign||function(){return Hn=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Hn.apply(this,arguments)},Rl=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Cl=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function Pl(){if(typeof wx>"u"||typeof Page>"u"||!wx.getSystemInfoSync||!wx.getStorageSync||!wx.setStorageSync||!wx.connectSocket||!wx.request)return!1;try{if(!wx.getSystemInfoSync()||wx.getSystemInfoSync().AppPlatform==="qq")return!1}catch{return!1}return!0}function Fl(){return typeof App>"u"&&typeof getApp>"u"&&!wx.onAppHide&&!wx.offAppHide&&!wx.onAppShow&&!wx.offAppShow}var Bl=function(t){Nl(e,t);function e(r){r===void 0&&(r={});var i=t.call(this)||this,o=r.timeout,n=r.timeoutMsg,a=r.restrictedMethods;return i._timeout=o||0,i._timeoutMsg=n||"请求超时",i._restrictedMethods=a||["get","post","upload","download"],i}return e.prototype.post=function(r){var i=this;return new Promise(function(o,n){var a=r.url,c=r.data,h=r.headers,s=wx.request({url:mo("https:",a),data:c,timeout:i._timeout,method:"POST",header:h,success:function(u){o(u)},fail:function(u){n(u)},complete:function(u){if(!(!u||!u.errMsg)&&!(!i._timeout||i._restrictedMethods.indexOf("post")===-1)){var d=u.errMsg;if(d==="request:fail timeout"){console.warn(i._timeoutMsg);try{s.abort()}catch{}}}}})})},e.prototype.upload=function(r){var i=this,o=this;return new Promise(function(n){return Rl(i,void 0,void 0,function(){var a,c,h,s,u,d;return Cl(this,function(y){return a=r.url,c=r.file,h=r.data,s=r.headers,u=r.onUploadProgress,d=wx.uploadFile({url:a,filePath:c,name:"file",formData:Hn({},h),header:s,timeout:this._timeout,success:function(w){var E={statusCode:w.statusCode,data:w.data||{}};w.statusCode===200&&h.success_action_status&&(E.statusCode=parseInt(h.success_action_status,10)),n(E)},fail:function(w){n(w)},complete:function(w){if(!(!w||!w.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("upload")===-1)){var E=w.errMsg;if(E==="request:fail timeout"){console.warn(o._timeoutMsg);try{d.abort()}catch{}}}}}),u&&d.onProgressUpdate(function(w){u(w)}),[2]})})})},e.prototype.download=function(r){var i=this,o=this;return new Promise(function(n,a){var c=r.url,h=r.headers,s=wx.downloadFile({url:mo("https:",c),header:h,timeout:i._timeout,success:function(u){u.statusCode===200&&u.tempFilePath?n({statusCode:200,tempFilePath:u.tempFilePath}):n(u)},fail:function(u){a(u)},complete:function(u){if(!(!u||!u.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("download")===-1)){var d=u.errMsg;if(d==="request:fail timeout"){console.warn(o._timeoutMsg);try{s.abort()}catch{}}}}})})},e}(Oa),Dl={setItem:function(t,e){wx.setStorageSync(t,e)},getItem:function(t){return wx.getStorageSync(t)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}},Ll=function(){function t(e,r){r===void 0&&(r={});var i=wx.connectSocket(Hn({url:e},r)),o={set onopen(n){i.onOpen(n)},set onmessage(n){i.onMessage(n)},set onclose(n){i.onClose(n)},set onerror(n){i.onError(n)},send:function(n){return i.send({data:n})},close:function(n,a){return i.close({code:n,reason:a})},get readyState(){return i.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return o}return t}();function Ul(){var t={root:{},reqClass:Bl,wsClass:Ll,localStorage:Dl,primaryStorage:$n.local,getAppSign:function(){var e=wx.getAccountInfoSync();return Fl()?e&&e.plugin?e.plugin.appId:"":e&&e.miniProgram?e.miniProgram.appId:""}};return t}var Ml={genAdapter:Ul,isMatch:Pl,runtime:"wx_mp"},bo=globalThis&&globalThis.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<r;e++)for(var n=arguments[e],a=0,c=n.length;a<c;a++,o++)i[o]=n[a];return i},Gn=ee.ERRORS,bs={};function kl(t,e){var r=e.name,i=e.namespace,o=e.entity,n=e.injectEvents,a=e.IIFE,c=a===void 0?!1:a;if(bs[r]||i&&t[i])throw new Error(JSON.stringify({code:Gn.INVALID_OPERATION,msg:"Duplicate component "+r}));if(c){if(!o||typeof o!="function")throw new Error(JSON.stringify({code:Gn.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));o.call(t)}if(bs[r]=e,i?t.prototype[i]=o:Da(t.prototype,o),n){var h=n.bus,s=n.events;if(!h||!s||s.length===0)return;var u=t.prototype.fire||function(){};t.prototype.events||(t.prototype.events={});var d=t.prototype.events||{};d[r]?t.prototype.events[r].events=bo(t.prototype.events[r].events,s):t.prototype.events[r]={bus:h,events:s},t.prototype.fire=function(y,w){u(y,w);for(var E in this.events){var A=this.events[E],m=A.bus,_=A.events;if(_.includes(y)){m.fire(y,w);break}}}}}function Da(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:var r=e;return new Date(r.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(var i in e)e.hasOwnProperty(i)&&(t[i]=Da(t[i],e[i]));return t}function $l(t,e){var r=e.entity,i=e.target;if(!t.prototype.hasOwnProperty(i))throw new Error(JSON.stringify({code:Gn.INVALID_OPERATION,msg:"target:"+i+" is not exist"}));var o=t.prototype[i];if(typeof o!="function")throw new Error(JSON.stringify({code:Gn.INVALID_OPERATION,msg:"target:"+i+" is not a function which is the only type supports hook"}));t.prototype[i]=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return r.call.apply(r,bo([this],n)),o.call.apply(o,bo([this],n))}}var ze={},pr=globalThis&&globalThis.__assign||function(){return pr=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},pr.apply(this,arguments)},jl="access_token",Wl="access_token_expire",ql="refresh_token",Hl="anonymous_uuid",Gl="login_type",Kl="user_info",Ss=Ba.CloudbaseCache,Un={},So={};function As(t){var e=t.env,r=t.persistence,i=t.platformInfo,o=jl+"_"+e,n=Wl+"_"+e,a=ql+"_"+e,c=Hl+"_"+e,h=Gl+"_"+e,s=Kl+"_"+e,u={accessTokenKey:o,accessTokenExpireKey:n,refreshTokenKey:a,anonymousUuidKey:c,loginTypeKey:h,userInfoKey:s};Un[e]?Un[e].updatePersistence(r):Un[e]=new Ss(pr(pr({},t),{keys:u,platformInfo:i,alwaysLocalKeys:["anonymousUuidKey"]})),So[e]=So[e]||new Ss(pr(pr({},t),{keys:u,platformInfo:i,persistence:"local"}))}function La(t){return Un[t]}function Ua(t){return So[t]}var Vl=ee.setSdkName,Jl=ee.setProtocol,Ma="",ka="@cloudbase/js-sdk";function Yl(t){Ma=t}function Xl(){return Ma}function zl(t){ka=t,Vl(t)}function Ql(){return ka}var Zl="2020-01-10",$a=typeof location<"u"&&location.protocol==="http:"?"http:":"https:",ja=(typeof process<"u","//tcb-api.tencentcloudapi.com/web");function Wa(t,e){ja=t,e&&($a=e,Jl(e))}function eh(t,e,r){var i=e?"//"+t+"."+e+".tcb-api.tencentcloudapi.com/web":"//"+t+".ap-shanghai.tcb-api.tencentcloudapi.com/web";Wa(i,r)}function th(){return{BASE_URL:ja,PROTOCOL:$a}}var Ao;(function(t){t.ANONYMOUS="ANONYMOUS",t.WECHAT="WECHAT",t.CUSTOM="CUSTOM",t.NULL="NULL"})(Ao||(Ao={}));var Ts={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},rt=globalThis&&globalThis.__assign||function(){return rt=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},rt.apply(this,arguments)},Tt=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},It=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Mr=ee.ERRORS,rh=ie.genSeqId,nh=ie.isFormData,ih=ie.formatUrl,oh=ie.createSign,sh=er.RUNTIME,Is=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function Mi(t,e,r){var i=t[e];t[e]=function(o){var n={},a={};r.forEach(function(h){var s=h.call(t,o),u=s.data,d=s.headers;Object.assign(n,u),Object.assign(a,d)});var c=o.data;return c&&function(){if(nh(c)){for(var h in n)c.append(h,n[h]);return}o.data=rt(rt({},c),n)}(),o.headers=rt(rt({},o.headers||{}),a),i.call(t,o)}}function ki(){var t=rh();return{data:{seqId:t},headers:{"X-SDK-Version":"@cloudbase/js-sdk/"+Xl(),"x-seqid":t}}}var ah=function(){function t(e){this._throwWhenRequestFail=!1,this.config=e,this._reqClass=new ze.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断",restrictedMethods:["post"]}),this._throwWhenRequestFail=e.throw||!1,this._cache=La(this.config.env),this._localCache=Ua(this.config.env),Mi(this._reqClass,"post",[ki]),Mi(this._reqClass,"upload",[ki]),Mi(this._reqClass,"download",[ki])}return t.prototype.post=function(e){return Tt(this,void 0,void 0,function(){var r;return It(this,function(i){switch(i.label){case 0:return[4,this._reqClass.post(e)];case 1:return r=i.sent(),[2,r]}})})},t.prototype.upload=function(e){return Tt(this,void 0,void 0,function(){var r;return It(this,function(i){switch(i.label){case 0:return[4,this._reqClass.upload(e)];case 1:return r=i.sent(),[2,r]}})})},t.prototype.download=function(e){return Tt(this,void 0,void 0,function(){var r;return It(this,function(i){switch(i.label){case 0:return[4,this._reqClass.download(e)];case 1:return r=i.sent(),[2,r]}})})},t.prototype.refreshAccessToken=function(){return Tt(this,void 0,void 0,function(){var e,r,i;return It(this,function(o){switch(o.label){case 0:this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._refreshAccessTokenPromise];case 2:return e=o.sent(),[3,4];case 3:return i=o.sent(),r=i,[3,4];case 4:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,r)throw r;return[2,e]}})})},t.prototype.getAccessToken=function(){return Tt(this,void 0,void 0,function(){var e,r,i,o,n,a,c,h,s,u;return It(this,function(d){switch(d.label){case 0:return e=this._cache.keys,r=e.accessTokenKey,i=e.accessTokenExpireKey,o=e.refreshTokenKey,[4,this._cache.getStoreAsync(o)];case 1:if(n=d.sent(),!n)throw new Error(JSON.stringify({code:Mr.OPERATION_FAIL,msg:"refresh token is not exist, your local data might be messed up, please retry after clear localStorage or sessionStorage"}));return[4,this._cache.getStoreAsync(r)];case 2:return a=d.sent(),h=Number,[4,this._cache.getStoreAsync(i)];case 3:return c=h.apply(void 0,[d.sent()]),s=!0,u=this._shouldRefreshAccessTokenHook,u?[4,this._shouldRefreshAccessTokenHook(a,c)]:[3,5];case 4:u=!d.sent(),d.label=5;case 5:return u&&(s=!1),(!a||!c||c<Date.now())&&s?[4,this.refreshAccessToken()]:[3,7];case 6:return[2,d.sent()];case 7:return[2,{accessToken:a,accessTokenExpire:c}]}})})},t.prototype.request=function(e,r,i){return Tt(this,void 0,void 0,function(){var o,n,a,c,h,s,u,d,d,y,w,E,A,m,_,x,I,T,F,R,L,k,B,ue,fe,ye,Y,Ae;return It(this,function(Ne){switch(Ne.label){case 0:return o="x-tcb-trace_"+this.config.env,n="application/x-www-form-urlencoded",a=rt({action:e,dataVersion:Zl,env:this.config.env},r),Is.indexOf(e)!==-1?[3,3]:(c=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(c)]);case 1:return h=Ne.sent(),h?(s=a,[4,this.getAccessToken()]):[3,3];case 2:s.access_token=Ne.sent().accessToken,Ne.label=3;case 3:if(e==="storage.uploadFile"){u=new FormData;for(d in u)u.hasOwnProperty(d)&&u[d]!==void 0&&u.append(d,a[d]);n="multipart/form-data"}else{n="application/json;charset=UTF-8",u={};for(d in a)a[d]!==void 0&&(u[d]=a[d])}return y={headers:{"content-type":n}},i!=null&&i.onUploadProgress&&(y.onUploadProgress=i.onUploadProgress),this.config.region&&(y.headers["X-TCB-Region"]=this.config.region),w=this._localCache.getStore(o),w&&(y.headers["X-TCB-Trace"]=w),ze.runtime!==sh.WEB&&(E=this.config,A=E.appSign,m=E.appSecret,_=Date.now(),x=m.appAccessKey,I=m.appAccessKeyId,T=oh({data:{},timestamp:_,appAccessKeyId:I,appSign:A},x),y.headers["X-TCB-App-Source"]="timestamp="+_+";appAccessKeyId="+I+";appSign="+A+";sign="+T),F=r.parse,R=r.inQuery,L=r.search,k={env:this.config.env},F&&(k.parse=!0),R&&(k=rt(rt({},R),k)),B=th(),ue=B.BASE_URL,fe=B.PROTOCOL,ye=ih(fe,ue,k),L&&(ye+=L),[4,this.post(rt({url:ye,data:u},y))];case 4:if(Y=Ne.sent(),Ae=Y.header&&Y.header["x-tcb-trace"],Ae&&this._localCache.setStore(o,Ae),Number(Y.status)!==200&&Number(Y.statusCode)!==200||!Y.data)throw new Error("network request error");return[2,Y]}})})},t.prototype.send=function(e,r){return r===void 0&&(r={}),Tt(this,void 0,void 0,function(){var i;return It(this,function(o){switch(o.label){case 0:return[4,this.request(e,r,{onUploadProgress:r.onUploadProgress})];case 1:return i=o.sent(),i.data.code==="ACCESS_TOKEN_EXPIRED"&&Is.indexOf(e)===-1?[4,this.refreshAccessToken()]:[3,4];case 2:return o.sent(),[4,this.request(e,r,{onUploadProgress:r.onUploadProgress})];case 3:i=o.sent(),o.label=4;case 4:if(i.data.code&&this._throwWhenRequestFail)throw new Error(JSON.stringify({code:Mr.OPERATION_FAIL,msg:"["+i.data.code+"] "+i.data.message}));return[2,i.data]}})})},t.prototype._refreshAccessToken=function(e){return e===void 0&&(e=1),Tt(this,void 0,void 0,function(){var r,i,o,n,a,c,h,s,u,d,y,w,E,A;return It(this,function(m){switch(m.label){case 0:return r=this._cache.keys,i=r.accessTokenKey,o=r.accessTokenExpireKey,n=r.refreshTokenKey,a=r.loginTypeKey,c=r.anonymousUuidKey,[4,this._cache.removeStoreAsync(i)];case 1:return m.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return m.sent(),[4,this._cache.getStoreAsync(n)];case 3:if(h=m.sent(),!h)throw new Error(JSON.stringify({code:Mr.INVALID_OPERATION,msg:"not login"}));return s={refresh_token:h},[4,this.request("auth.fetchAccessTokenWithRefreshToken",s)];case 4:return u=m.sent(),u.data.code?(d=u.data.code,d==="SIGN_PARAM_INVALID"||d==="REFRESH_TOKEN_EXPIRED"||d==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(a)]:[3,11]):[3,12];case 5:return y=m.sent()===Ao.ANONYMOUS,y&&d==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(c)]:[3,9];case 6:return w=m.sent(),[4,this._cache.getStoreAsync(n)];case 7:return E=m.sent(),[4,this.send("auth.signInAnonymously",{anonymous_uuid:w,refresh_token:E})];case 8:if(A=m.sent(),this._setRefreshToken(A.refresh_token),e>=1)return[2,this._refreshAccessToken(--e)];throw new Error(JSON.stringify({code:Mr.OPERATION_FAIL,message:"重试获取 refresh token 失败"}));case 9:return tt.fire(Ts.LOGIN_STATE_EXPIRED),[4,this._cache.removeStoreAsync(n)];case 10:m.sent(),m.label=11;case 11:throw new Error(JSON.stringify({code:Mr.NETWORK_ERROR,msg:"refresh access_token failed："+u.data.code}));case 12:return u.data.access_token?(tt.fire(Ts.ACCESS_TOKEN_REFRESHD),[4,this._cache.setStoreAsync(i,u.data.access_token)]):[3,15];case 13:return m.sent(),[4,this._cache.setStoreAsync(o,u.data.access_token_expire+Date.now())];case 14:return m.sent(),[2,{accessToken:u.data.access_token,accessTokenExpire:u.data.access_token_expire}];case 15:return u.data.refresh_token?[4,this._cache.removeStoreAsync(n)]:[3,19];case 16:return m.sent(),[4,this._cache.setStoreAsync(n,u.data.refresh_token)];case 17:return m.sent(),[4,this._refreshAccessToken()];case 18:m.sent(),m.label=19;case 19:return[2]}})})},t.prototype._setRefreshToken=function(e){return Tt(this,void 0,void 0,function(){var r,i,o,n;return It(this,function(a){switch(a.label){case 0:return r=this._cache.keys,i=r.accessTokenKey,o=r.accessTokenExpireKey,n=r.refreshTokenKey,[4,this._cache.removeStoreAsync(i)];case 1:return a.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return a.sent(),[4,this._cache.setStoreAsync(n,e)];case 3:return a.sent(),[2]}})})},t}(),qa={};function uh(t){qa[t.env]=new ah(rt(rt({},t),{throw:!0}))}function ch(t){return qa[t]}var Kn=globalThis&&globalThis.__assign||function(){return Kn=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Kn.apply(this,arguments)},Os=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},ar=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},fh=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},lh=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},hh=er.useAdapters,dh=er.useDefaultAdapter,ph=er.RUNTIME,qt=ee.ERRORS,xs=ee.COMMUNITY_SITE_URL,Ns=ie.printWarn,Rs=ot.catchErrorsDecorator,gh={timeout:15e3,persistence:"local"},Cs=1e3*60*10,Ps=100,Fs={},yh=function(){function t(e){this._config=e||this._config,this.authInstance=null}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"platform",{get:function(){return ze},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cache",{get:function(){return La(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCache",{get:function(){return Ua(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return ch(this._config.env)},enumerable:!1,configurable:!0}),t.prototype.init=function(e){if(!e.env)throw new Error(JSON.stringify({code:qt.INVALID_PARAMS,msg:"env must not be specified"}));if(ze.adapter||this._useDefaultAdapter(),this.requestClient=new ze.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:"["+Ql()+"][REQUEST TIMEOUT] request had been abort since didn't finished within"+e.timeout/1e3+"s"}),ze.runtime!==ph.WEB){if(!e.appSecret)throw new Error(JSON.stringify({code:qt.INVALID_PARAMS,msg:"invalid appSecret"}));var r=ze.adapter.getAppSign?ze.adapter.getAppSign():"";if(e.appSign&&r&&e.appSign!==r)throw new Error(JSON.stringify({code:qt.INVALID_PARAMS,msg:"invalid appSign"}));if(r&&(e.appSign=r),!e.appSign)throw new Error(JSON.stringify({code:qt.INVALID_PARAMS,msg:"invalid appSign"}))}this._config=Kn(Kn({},gh),e),this._config.timeout=this._formatTimeout(this._config.timeout);var i=this._config,o=i.env,n=i.persistence,a=i.debug,c=i.timeout,h=i.appSecret,s=i.appSign;As({env:o,persistence:n,debug:a,platformInfo:this.platform}),uh({env:o,region:e.region||"",timeout:c,appSecret:h,appSign:s}),e.region&&eh(o,e.region||"");var u=new t(this._config);return u.requestClient=this.requestClient,u},t.prototype.updateConfig=function(e){var r=e.persistence,i=e.debug;this._config.persistence=r,this._config.debug=i,As({env:this._config.env,persistence:r,debug:i,platformInfo:this.platform})},t.prototype.registerExtension=function(e){Fs[e.name]=e},t.prototype.invokeExtension=function(e,r){return fh(this,void 0,void 0,function(){var i;return lh(this,function(o){switch(o.label){case 0:if(i=Fs[e],!i)throw new Error(JSON.stringify({code:qt.INVALID_PARAMS,msg:"extension:"+e+" must be registered before invoke"}));return[4,i.invoke(r,this)];case 1:return[2,o.sent()]}})})},t.prototype.useAdapters=function(e){var r=hh(e)||{},i=r.adapter,o=r.runtime;i&&(ze.adapter=i),o&&(ze.runtime=o)},t.prototype.registerHook=function(e){$l(t,e)},t.prototype.registerComponent=function(e){kl(t,e)},t.prototype.registerVersion=function(e){Yl(e)},t.prototype.registerSdkName=function(e){zl(e)},t.prototype.registerEndPoint=function(e,r){Wa(e,r)},t.prototype._useDefaultAdapter=function(){var e=dh(),r=e.adapter,i=e.runtime;ze.adapter=r,ze.runtime=i},t.prototype._formatTimeout=function(e){switch(!0){case e>Cs:return Ns(qt.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),Cs;case e<Ps:return Ns(qt.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),Ps;default:return e}},Os([Rs({mode:"sync",title:"Cloudbase 初始化失败",messages:["请确认以下各项：","  1 - 调用 cloudbase.init() 的语法或参数是否正确","  2 - 如果是非浏览器环境，是否配置了安全应用来源（https://docs.cloudbase.net/api-reference/webv2/adapter.html#jie-ru-liu-cheng）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xs]}),ar("design:type",Function),ar("design:paramtypes",[Object]),ar("design:returntype",t)],t.prototype,"init",null),Os([Rs({title:"调用扩展能力失败",messages:["请确认以下各项：","  1 - 调用 invokeExtension() 的语法或参数是否正确","  2 - 被调用的扩展能力是否已经安装并通过 registerExtension() 注册","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xs]}),ar("design:type",Function),ar("design:paramtypes",[String,Object]),ar("design:returntype",Promise)],t.prototype,"invokeExtension",null),t}(),tt=new yh;tt.useAdapters(Ml);var kr=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},$r=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Sr=function(){function t(e){this._config=e,this._cache=e.cache,this._request=e.request}return t.prototype.checkLocalLoginState=function(){return kr(this,void 0,void 0,function(){var e,r,i,o,n,a;return $r(this,function(c){switch(c.label){case 0:return e=this._cache.keys,r=e.accessTokenKey,i=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(r)];case 1:return o=c.sent(),[4,this._cache.getStoreAsync(i)];case 2:return n=c.sent(),o?n&&n>Date.now()?(a=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,a.checkLocalStateAsync()]):[3,4]:[3,7];case 3:return c.sent(),[2,a];case 4:return[4,this._cache.removeStoreAsync(r)];case 5:return c.sent(),[4,this._cache.removeStoreAsync(i)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.setRefreshToken=function(e){return kr(this,void 0,void 0,function(){var r,i,o,n;return $r(this,function(a){switch(a.label){case 0:return r=this._cache.keys,i=r.accessTokenKey,o=r.accessTokenExpireKey,n=r.refreshTokenKey,[4,this._cache.removeStoreAsync(i)];case 1:return a.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return a.sent(),[4,this._cache.setStoreAsync(n,e)];case 3:return a.sent(),[2]}})})},t.prototype.setAccessToken=function(e,r){return kr(this,void 0,void 0,function(){var i,o,n;return $r(this,function(a){switch(a.label){case 0:return i=this._cache.keys,o=i.accessTokenKey,n=i.accessTokenExpireKey,[4,this._cache.setStoreAsync(o,e)];case 1:return a.sent(),[4,this._cache.setStoreAsync(n,r)];case 2:return a.sent(),[2]}})})},t.prototype.refreshUserInfo=function(){return kr(this,void 0,void 0,function(){var e,r;return $r(this,function(i){switch(i.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=i.sent().data,[4,this.setLocalUserInfo(r)];case 2:return i.sent(),[2,r]}})})},t.prototype.setLocalUserInfo=function(e){return kr(this,void 0,void 0,function(){var r;return $r(this,function(i){switch(i.label){case 0:return r=this._cache.keys.userInfoKey,[4,this._cache.setStoreAsync(r,e)];case 1:return i.sent(),[2]}})})},t}(),pe;(function(t){t.ANONYMOUS="ANONYMOUS",t.WECHAT="WECHAT",t.WECHAT_PUBLIC="WECHAT-PUBLIC",t.WECHAT_OPEN="WECHAT-OPEN",t.CUSTOM="CUSTOM",t.EMAIL="EMAIL",t.USERNAME="USERNAME",t.NULL="NULL",t.PHONE="PHONE"})(pe||(pe={}));var vh=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),$i=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Ot=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},ur=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},cr=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ji=ee.getSdkName,Nn=ee.ERRORS,Wi=ee.COMMUNITY_SITE_URL,Bs=er.RUNTIME,mh=ie.getQuery,_h=ie.getHash,Ds=ie.removeParam,wh=ie.printWarn,qi=ot.catchErrorsDecorator,Eh=function(t){vh(e,t);function e(r,i,o,n){var a=t.call(this,r)||this;return a._runtime=r.runtime,a._appid=i,a._scope=o,a._state=n||"weixin",a}return e.prototype.signIn=function(){return ur(this,void 0,void 0,function(){return cr(this,function(r){return[2,wh(Nn.OPERATION_FAIL,"API signIn has been deprecated, please use signInWithRedirect insteed")]})})},e.prototype.signInWithRedirect=function(){return ur(this,void 0,void 0,function(){return cr(this,function(r){return[2,this._redirect()]})})},e.prototype.getRedirectResult=function(r){return ur(this,void 0,void 0,function(){var i;return cr(this,function(o){return i=Ls(),i?[2,this._signInWithCode(i,r)]:[2,null]})})},e.prototype.getLinkRedirectResult=function(r){return r===void 0&&(r={}),ur(this,void 0,void 0,function(){var i,o,n,a,c,h;return cr(this,function(s){return i=r.withUnionId,o=i===void 0?!1:i,n=Ls(),n?(a=this._appid,c=function(u){switch(u){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),h=this._runtime===Bs.WX_MP?"1":"0",[2,this._request.send("auth.linkWithWeixinCode",{payload:{appid:a,loginType:c,code:n,hybridMiniapp:h,withUnionId:o}})]):[2,null]})})},e.prototype._redirect=function(){var r=Ds("code",location.href);r=Ds("state",r),r=encodeURIComponent(r);var i="//open.weixin.qq.com/connect/oauth2/authorize";this._scope==="snsapi_login"&&(i="//open.weixin.qq.com/connect/qrconnect");try{location.href=i+"?appid="+this._appid+"&redirect_uri="+r+"&response_type=code&scope="+this._scope+"&state="+this._state+"#wechat_redirect"}catch(o){throw new Error("["+ji()+"]["+Nn.UNKOWN_ERROR+"]"+o)}},e.prototype._signInWithCode=function(r,i){return ur(this,void 0,void 0,function(){var o,n,a,c,h,s,u,d;return cr(this,function(y){switch(y.label){case 0:return o=this._cache.keys,n=o.accessTokenKey,a=o.accessTokenExpireKey,c=o.refreshTokenKey,h=function(w){switch(w){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),[4,this._getRefreshTokenByWXCode(this._appid,h,r,i)];case 1:return s=y.sent(),u=s.refreshToken,[4,this._cache.setStoreAsync(c,u)];case 2:return y.sent(),s.accessToken?[4,this._cache.setStoreAsync(n,s.accessToken)]:[3,4];case 3:y.sent(),y.label=4;case 4:return s.accessTokenExpire?[4,this._cache.setStoreAsync(a,String(s.accessTokenExpire+Date.now()))]:[3,6];case 5:y.sent(),y.label=6;case 6:return ae.fire(te.LOGIN_STATE_CHANGED),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.WECHAT,persistence:this._config.persistence}),[4,this.refreshUserInfo()];case 7:return y.sent(),d=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,d.checkLocalStateAsync()];case 8:return y.sent(),[2,d]}})})},e.prototype._getRefreshTokenByWXCode=function(r,i,o,n){return n===void 0&&(n={}),ur(this,void 0,void 0,function(){var a,c,h,s,u,d,y;return cr(this,function(w){return a=n.withUnionId,c=a===void 0?!1:a,h=n.createUser,s=h===void 0?!0:h,u=this._scope==="snsapi_base"?!1:n.syncUserInfo||!1,d="auth.signIn",y=this._runtime===Bs.WX_MP?"1":"0",[2,this._request.send(d,{appid:r,loginType:i,hybridMiniapp:y,syncUserInfo:u,loginCredential:o,withUnionId:c,createUser:s}).then(function(E){if(E.code)throw new Error("["+ji()+"]["+Nn.OPERATION_FAIL+"] failed login via wechat: "+E.code);if(E.refresh_token)return{refreshToken:E.refresh_token,accessToken:E.access_token,accessTokenExpire:E.access_token_expire};throw new Error("["+ji()+"]["+Nn.OPERATION_FAIL+"] action:getJwt not return refreshToken")})]})})},$i([qi({title:"跳转微信公众号授权失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().signInWithRedirect() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),Ot("design:type",Function),Ot("design:paramtypes",[]),Ot("design:returntype",Promise)],e.prototype,"signInWithRedirect",null),$i([qi({title:"微信公众号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),Ot("design:type",Function),Ot("design:paramtypes",[Object]),Ot("design:returntype",Promise)],e.prototype,"getRedirectResult",null),$i([qi({title:"获取微信重定向绑定结果",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getLinkRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),Ot("design:type",Function),Ot("design:paramtypes",[Object]),Ot("design:returntype",Promise)],e.prototype,"getLinkRedirectResult",null),e}(Sr);function Ls(){return mh("code")||_h("code")}var bh=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Sh=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Hi=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},jr=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Wr=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Gi=ee.ERRORS,Ah=ee.COMMUNITY_SITE_URL,Us=ie.throwError,Th=ie.isString,Ih=Mo.addEventListener,Oh=ot.catchErrorsDecorator,xh=function(t){bh(e,t);function e(r){var i=t.call(this,r)||this;return i._onConverted=i._onConverted.bind(i),Ih(te.ANONYMOUS_CONVERTED,i._onConverted),i}return e.prototype.signIn=function(){return jr(this,void 0,void 0,function(){var r,i,o,n,a,c,h;return Wr(this,function(s){switch(s.label){case 0:return[4,this._cache.updatePersistenceAsync("local")];case 1:return s.sent(),r=this._cache.keys,i=r.anonymousUuidKey,o=r.refreshTokenKey,[4,this._cache.getStoreAsync(i)];case 2:return n=s.sent(),[4,this._cache.getStoreAsync(o)];case 3:return a=s.sent(),[4,this._request.send("auth.signInAnonymously",{anonymous_uuid:n,refresh_token:a})];case 4:return c=s.sent(),c.uuid&&c.refresh_token?[4,this._setAnonymousUUID(c.uuid)]:[3,10];case 5:return s.sent(),[4,this.setRefreshToken(c.refresh_token)];case 6:return s.sent(),[4,this._request.refreshAccessToken()];case 7:return s.sent(),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.ANONYMOUS,persistence:"local"}),ae.fire(te.LOGIN_STATE_CHANGED),h=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,h.checkLocalStateAsync()];case 8:return s.sent(),[4,h.user.refresh()];case 9:return s.sent(),[2,h];case 10:throw new Error(JSON.stringify({code:Gi.OPERATION_FAIL,msg:JSON.stringify(c)||"anonymous signIn failed"}))}})})},e.prototype.linkAndRetrieveDataWithTicket=function(r){return jr(this,void 0,void 0,function(){var i,o,n,a,c,h,s;return Wr(this,function(u){switch(u.label){case 0:return Th(r)||Us(Gi.INVALID_PARAMS,"ticket must be a string"),i=this._cache.keys,o=i.anonymousUuidKey,n=i.refreshTokenKey,[4,this._cache.getStoreAsync(o)];case 1:return a=u.sent(),[4,this._cache.getStoreAsync(n)];case 2:return c=u.sent(),[4,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:a,refresh_token:c,ticket:r})];case 3:return h=u.sent(),h.refresh_token?[4,this._clearAnonymousUUID()]:[3,8];case 4:return u.sent(),[4,this.setRefreshToken(h.refresh_token)];case 5:return u.sent(),[4,this._request.refreshAccessToken()];case 6:return u.sent(),ae.fire(te.ANONYMOUS_CONVERTED,{env:this._config.env}),ae.fire(te.LOGIN_TYPE_CHANGED,{loginType:pe.CUSTOM,persistence:"local"}),s=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,s.checkLocalStateAsync()];case 7:return u.sent(),[2,s];case 8:Us(Gi.OPERATION_FAIL,JSON.stringify(h)||"linkAndRetrieveDataWithTicket failed"),u.label=9;case 9:return[2]}})})},e.prototype._setAnonymousUUID=function(r){return jr(this,void 0,void 0,function(){var i,o,n;return Wr(this,function(a){switch(a.label){case 0:return i=this._cache.keys,o=i.anonymousUuidKey,n=i.loginTypeKey,[4,this._cache.removeStoreAsync(o)];case 1:return a.sent(),[4,this._cache.setStoreAsync(o,r)];case 2:return a.sent(),[4,this._cache.setStoreAsync(n,pe.ANONYMOUS)];case 3:return a.sent(),[2]}})})},e.prototype._clearAnonymousUUID=function(){return jr(this,void 0,void 0,function(){return Wr(this,function(r){switch(r.label){case 0:return[4,this._cache.removeStoreAsync(this._cache.keys.anonymousUuidKey)];case 1:return r.sent(),[2]}})})},e.prototype._onConverted=function(r){return jr(this,void 0,void 0,function(){var i;return Wr(this,function(o){switch(o.label){case 0:return i=r.data.env,i!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(this._config.persistence)];case 1:return o.sent(),[2]}})})},Sh([Oh({title:"匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().anonymouseProvider().signIn() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ah]}),Hi("design:type",Function),Hi("design:paramtypes",[]),Hi("design:returntype",Promise)],e.prototype,"signIn",null),e}(Sr),Nh=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Rh=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Ki=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Ch=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Ph=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ms=ee.ERRORS,Fh=ee.COMMUNITY_SITE_URL,Bh=ie.isString,Dh=ot.catchErrorsDecorator,Lh=function(t){Nh(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r){return Ch(this,void 0,void 0,function(){var i,o,n,a,c,h,s;return Ph(this,function(u){switch(u.label){case 0:if(!Bh(r))throw new Error(JSON.stringify({code:Ms.INVALID_PARAMS,msg:"ticket must be a string"}));return i=this._cache.keys.refreshTokenKey,a=(n=this._request).send,c=["auth.signInWithTicket"],h={ticket:r},[4,this._cache.getStoreAsync(i)];case 1:return[4,a.apply(n,c.concat([(h.refresh_token=u.sent()||"",h)]))];case 2:return o=u.sent(),o.refresh_token?[4,this.setRefreshToken(o.refresh_token)]:[3,7];case 3:return u.sent(),[4,this._request.refreshAccessToken()];case 4:return u.sent(),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.CUSTOM,persistence:this._config.persistence}),ae.fire(te.LOGIN_STATE_CHANGED),[4,this.refreshUserInfo()];case 5:return u.sent(),s=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,s.checkLocalStateAsync()];case 6:return u.sent(),[2,s];case 7:throw new Error(JSON.stringify({code:Ms.OPERATION_FAIL,msg:"custom signIn failed"}))}})})},Rh([Dh({title:"自定义登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了自定义登录","  2 - 调用 auth().customAuthProvider().signIn() 的语法或参数是否正确","  3 - ticket 是否归属于当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Fh]}),Ki("design:type",Function),Ki("design:paramtypes",[String]),Ki("design:returntype",Promise)],e.prototype,"signIn",null),e}(Sr),Uh=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),qr=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Pe=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Hr=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Gr=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Vi=ie.throwError,Mh=ie.isString,Ji=ee.ERRORS,Kr=ee.COMMUNITY_SITE_URL,Vr=ot.catchErrorsDecorator,kh=function(t){Uh(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r,i){return Hr(this,void 0,void 0,function(){var o,n,a,c,h;return Gr(this,function(s){switch(s.label){case 0:return Mh(r)||Vi(Ji.INVALID_PARAMS,"email must be a string"),o=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:"EMAIL",email:r,password:i,refresh_token:this._cache.getStore(o)||""})];case 1:return n=s.sent(),a=n.refresh_token,c=n.access_token,h=n.access_token_expire,a?[4,this.setRefreshToken(a)]:[3,8];case 2:return s.sent(),c&&h?[4,this.setAccessToken(c,h)]:[3,4];case 3:return s.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:s.sent(),s.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return s.sent(),ae.fire(te.LOGIN_STATE_CHANGED),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.EMAIL,persistence:this._config.persistence}),[2,new wt({envId:this._config.env,cache:this._cache,request:this._request})];case 8:n.code?Vi(Ji.OPERATION_FAIL,"Email login fail["+n.code+"] "+n.message):Vi(Ji.OPERATION_FAIL,"Email login fail"),s.label=9;case 9:return[2]}})})},e.prototype.signUp=function(r,i){return Hr(this,void 0,void 0,function(){return Gr(this,function(o){return[2,this._request.send("auth.signUpWithEmailAndPassword",{email:r,password:i})]})})},e.prototype.resetPassword=function(r){return Hr(this,void 0,void 0,function(){return Gr(this,function(i){return[2,this._request.send("auth.sendPasswordResetEmail",{email:r})]})})},e.prototype.resetPasswordWithToken=function(r,i){return Hr(this,void 0,void 0,function(){return Gr(this,function(o){return[2,this._request.send("auth.resetPasswordWithToken",{token:r,newPassword:i})]})})},e.prototype.activate=function(r){return Hr(this,void 0,void 0,function(){return Gr(this,function(i){return[2,this._request.send("auth.activateEndUserMail",{token:r})]})})},qr([Vr({title:"邮箱密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().emailAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 邮箱地址与密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Kr]}),Pe("design:type",Function),Pe("design:paramtypes",[String,String]),Pe("design:returntype",Promise)],e.prototype,"signIn",null),qr([Vr({title:"邮箱注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithEmailAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Kr]}),Pe("design:type",Function),Pe("design:paramtypes",[String,String]),Pe("design:returntype",Promise)],e.prototype,"signUp",null),qr([Vr({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用 auth().sendPasswordResetEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经与当前用户绑定","  4 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Kr]}),Pe("design:type",Function),Pe("design:paramtypes",[String]),Pe("design:returntype",Promise)],e.prototype,"resetPassword",null),qr([Vr({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Kr]}),Pe("design:type",Function),Pe("design:paramtypes",[String,String]),Pe("design:returntype",Promise)],e.prototype,"resetPasswordWithToken",null),qr([Vr({title:"邮箱激活失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Kr]}),Pe("design:type",Function),Pe("design:paramtypes",[String]),Pe("design:returntype",Promise)],e.prototype,"activate",null),e}(Sr),$h=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),jh=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Yi=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Wh=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},qh=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Hh=ie.printWarn,Rn=ee.ERRORS,Gh=ee.COMMUNITY_SITE_URL,Kh=ot.catchErrorsDecorator,Vh=function(t){$h(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r,i){return Wh(this,void 0,void 0,function(){var o,n,a,c,h,s,u,d,y;return qh(this,function(w){switch(w.label){case 0:if(typeof r!="string")throw new Error(JSON.stringify({code:Rn.INVALID_PARAMS,msg:"username must be a string"}));return typeof i!="string"&&(i="",Hh(Rn.INVALID_PARAMS,"password is empty")),o=this._cache.keys.refreshTokenKey,c=(a=this._request).send,h=["auth.signIn"],s={loginType:pe.USERNAME,username:r,password:i},[4,this._cache.getStoreAsync(o)];case 1:return[4,c.apply(a,h.concat([(s.refresh_token=w.sent()||"",s)]))];case 2:return n=w.sent(),u=n.refresh_token,d=n.access_token_expire,y=n.access_token,u?[4,this.setRefreshToken(u)]:[3,9];case 3:return w.sent(),y&&d?[4,this.setAccessToken(y,d)]:[3,5];case 4:return w.sent(),[3,7];case 5:return[4,this._request.refreshAccessToken()];case 6:w.sent(),w.label=7;case 7:return[4,this.refreshUserInfo()];case 8:return w.sent(),ae.fire(te.LOGIN_STATE_CHANGED),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.USERNAME,persistence:this._config.persistence}),[2,new wt({envId:this._config.env,cache:this._cache,request:this._request})];case 9:throw n.code?new Error(JSON.stringify({code:Rn.OPERATION_FAIL,msg:"login by username failed:["+n.code+"] "+n.message})):new Error(JSON.stringify({code:Rn.OPERATION_FAIL,msg:"login by username failed"}));case 10:return[2]}})})},jh([Kh({title:"用户名密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().signInWithUsernameAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","  3 - 用户名密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Gh]}),Yi("design:type",Function),Yi("design:paramtypes",[String,String]),Yi("design:returntype",Promise)],e.prototype,"signIn",null),e}(Sr),Jh=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Xi=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},xt=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},zi=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Qi=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Cn=ie.throwError,Zi=ie.isString,Yh=ie.transformPhone,Pn=ee.ERRORS,eo=ee.COMMUNITY_SITE_URL,to=ot.catchErrorsDecorator,Mn={SIGNIN:"SIGNIN",SIGNUP:"SIGNUP",FORCERESETPWD:"FORCERESETPWD"},Xh=function(t){Jh(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r){return zi(this,void 0,void 0,function(){var i,o,n,a,c,h,s,u,d;return Qi(this,function(y){switch(y.label){case 0:return i=r.phoneNumber,o=r.phoneCode,n=r.password,a=r.signMethod,Zi(i)||Cn(Pn.INVALID_PARAMS,"phoneNumber must be a string"),!Zi(o)&&!Zi(n)&&Cn(Pn.INVALID_PARAMS,"phoneCode or password must be a string"),a||(a=Mn.SIGNIN),c=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:pe.PHONE,phoneNumber:Yh(i),phoneCode:o,password:n,refresh_token:this._cache.getStore(c)||"",signMethod:a})];case 1:return h=y.sent(),s=h.refresh_token,u=h.access_token,d=h.access_token_expire,s?[4,this.setRefreshToken(s)]:[3,8];case 2:return y.sent(),u&&d?[4,this.setAccessToken(u,d)]:[3,4];case 3:return y.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:y.sent(),y.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return y.sent(),ae.fire(te.LOGIN_STATE_CHANGED),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.PHONE,persistence:this._config.persistence}),[2,new wt({envId:this._config.env,cache:this._cache,request:this._request})];case 8:h.code?Cn(Pn.OPERATION_FAIL,"Phone login fail["+h.code+"] "+h.message):Cn(Pn.OPERATION_FAIL,"Phone login fail"),y.label=9;case 9:return[2]}})})},e.prototype.signUp=function(r,i,o){return zi(this,void 0,void 0,function(){return Qi(this,function(n){return[2,this.signIn({phoneNumber:r,phoneCode:i,password:o,signMethod:Mn.SIGNUP})]})})},e.prototype.forceResetPwd=function(r,i,o){return zi(this,void 0,void 0,function(){return Qi(this,function(n){return[2,this.signIn({phoneNumber:r,phoneCode:i,password:o,signMethod:Mn.FORCERESETPWD})]})})},Xi([to({title:"手机号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().SmsAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","  3 - 短信验证码/密码是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+eo]}),xt("design:type",Function),xt("design:paramtypes",[Object]),xt("design:returntype",Promise)],e.prototype,"signIn",null),Xi([to({title:"手机短信注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithPhoneCode() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+eo]}),xt("design:type",Function),xt("design:paramtypes",[String,String,String]),xt("design:returntype",Promise)],e.prototype,"signUp",null),Xi([to({title:"手机密码重置失败",messages:["请确认以下各项：","  1 - 调用 auth().forceResetPwd() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+eo]}),xt("design:type",Function),xt("design:paramtypes",[String,String,String]),xt("design:returntype",Promise)],e.prototype,"forceResetPwd",null),e}(Sr),_e=globalThis&&globalThis.__assign||function(){return _e=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},_e.apply(this,arguments)},Ee=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},j=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Q=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Z=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},zh=Mo.CloudbaseEventEmitter,Qh=er.RUNTIME,To=ie.printWarn,ko=ie.throwError,Io=ie.transformPhone,mr=ee.ERRORS,be=ee.COMMUNITY_SITE_URL,Se=ot.catchErrorsDecorator,Zh="auth",ae=new zh,ed=function(){function t(e){var r=e.cache,i=e.request;this._cache=r,this._request=i,this._setUserInfo()}return t.prototype.checkLocalInfo=function(){return Q(this,void 0,void 0,function(){return Z(this,function(e){return this.uid=this._getLocalUserInfo("uid"),this.loginType=this._getLocalUserInfo("loginType"),this.openid=this._getLocalUserInfo("wxOpenId"),this.wxOpenId=this._getLocalUserInfo("wxOpenId"),this.wxPublicId=this._getLocalUserInfo("wxPublicId"),this.unionId=this._getLocalUserInfo("wxUnionId"),this.qqMiniOpenId=this._getLocalUserInfo("qqMiniOpenId"),this.customUserId=this._getLocalUserInfo("customUserId"),this.nickName=this._getLocalUserInfo("nickName"),this.gender=this._getLocalUserInfo("gender"),this.avatarUrl=this._getLocalUserInfo("avatarUrl"),this.email=this._getLocalUserInfo("email"),this.hasPassword=Boolean(this._getLocalUserInfo("hasPassword")),this.phone=this._getLocalUserInfo("phone"),this.username=this._getLocalUserInfo("username"),this.location={country:this._getLocalUserInfo("country"),province:this._getLocalUserInfo("province"),city:this._getLocalUserInfo("city")},[2]})})},t.prototype.checkLocalInfoAsync=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n,a,c,h,s,u,d,y,w,E,A,m,_,x;return Z(this,function(I){switch(I.label){case 0:return e=this,[4,this._getLocalUserInfoAsync("uid")];case 1:return e.uid=I.sent(),r=this,[4,this._getLocalUserInfoAsync("loginType")];case 2:return r.loginType=I.sent(),i=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 3:return i.openid=I.sent(),o=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 4:return o.wxOpenId=I.sent(),n=this,[4,this._getLocalUserInfoAsync("wxPublicId")];case 5:return n.wxPublicId=I.sent(),a=this,[4,this._getLocalUserInfoAsync("wxUnionId")];case 6:return a.unionId=I.sent(),c=this,[4,this._getLocalUserInfoAsync("qqMiniOpenId")];case 7:return c.qqMiniOpenId=I.sent(),h=this,[4,this._getLocalUserInfoAsync("customUserId")];case 8:return h.customUserId=I.sent(),s=this,[4,this._getLocalUserInfoAsync("nickName")];case 9:return s.nickName=I.sent(),u=this,[4,this._getLocalUserInfoAsync("gender")];case 10:return u.gender=I.sent(),d=this,[4,this._getLocalUserInfoAsync("avatarUrl")];case 11:return d.avatarUrl=I.sent(),y=this,[4,this._getLocalUserInfoAsync("email")];case 12:return y.email=I.sent(),w=this,E=Boolean,[4,this._getLocalUserInfoAsync("hasPassword")];case 13:return w.hasPassword=E.apply(void 0,[I.sent()]),A=this,[4,this._getLocalUserInfoAsync("phone")];case 14:return A.phone=I.sent(),m=this,[4,this._getLocalUserInfoAsync("username")];case 15:return m.username=I.sent(),_=this,x={},[4,this._getLocalUserInfoAsync("country")];case 16:return x.country=I.sent(),[4,this._getLocalUserInfoAsync("province")];case 17:return x.province=I.sent(),[4,this._getLocalUserInfoAsync("city")];case 18:return _.location=(x.city=I.sent(),x),[2]}})})},t.prototype.linkWithTicket=function(e){if(typeof e!="string")throw new Error("ticket must be string");return this._request.send("auth.linkWithTicket",{ticket:e})},t.prototype.linkWithRedirect=function(e){e.signInWithRedirect()},t.prototype.getLinkedUidList=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n,a;return Z(this,function(c){switch(c.label){case 0:return[4,this._request.send("auth.getLinkedUidList",{})];case 1:for(e=c.sent().data,r=!1,i=e.users,o=0,n=i;o<n.length;o++)if(a=n[o],a.wxOpenId&&a.wxPublicId){r=!0;break}return[2,{users:i,hasPrimaryUid:r}]}})})},t.prototype.setPrimaryUid=function(e){return this._request.send("auth.setPrimaryUid",{uid:e})},t.prototype.unlink=function(e){return this._request.send("auth.unlink",{platform:e})},t.prototype.update=function(e){return Q(this,void 0,void 0,function(){var r,i,o,n,a,c,h;return Z(this,function(s){switch(s.label){case 0:return r=e.nickName,i=e.gender,o=e.avatarUrl,n=e.province,a=e.country,c=e.city,[4,this._request.send("auth.updateUserInfo",{nickName:r,gender:i,avatarUrl:o,province:n,country:a,city:c})];case 1:return h=s.sent().data,this._setLocalUserInfo(h),[2]}})})},t.prototype.updatePassword=function(e,r){return this._request.send("auth.updatePassword",{oldPassword:r,newPassword:e})},t.prototype.updateEmail=function(e,r){return this._request.send("auth.updateEmail",{newEmail:e,password:r})},t.prototype.updateUsername=function(e){return typeof e!="string"&&ko(mr.INVALID_PARAMS,"username must be a string"),this._request.send("auth.updateUsername",{username:e})},t.prototype.refresh=function(){return Q(this,void 0,void 0,function(){var e,r;return Z(this,function(i){switch(i.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=i.sent().data,this._setLocalUserInfo(r),[2,r]}})})},t.prototype.linkWithPhoneNumber=function(e,r){return Q(this,void 0,void 0,function(){return Z(this,function(i){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:Io(e),phoneCode:r})]})})},t.prototype.updatePhoneNumber=function(e,r){return Q(this,void 0,void 0,function(){return Z(this,function(i){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:Io(e),phoneCode:r})]})})},t.prototype._getLocalUserInfo=function(e){var r=this._cache.keys.userInfoKey,i=this._cache.getStore(r);return i[e]},t.prototype._getLocalUserInfoAsync=function(e){return Q(this,void 0,void 0,function(){var r,i;return Z(this,function(o){switch(o.label){case 0:return r=this._cache.keys.userInfoKey,[4,this._cache.getStoreAsync(r)];case 1:return i=o.sent(),[2,i[e]]}})})},t.prototype._setUserInfo=function(){var e=this,r=this._cache.keys.userInfoKey,i=this._cache.getStore(r);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl","phone","username"].forEach(function(o){e[o]=i[o]}),this.location={country:i.country,province:i.province,city:i.city}},t.prototype._setLocalUserInfo=function(e){var r=this._cache.keys.userInfoKey;this._cache.setStore(r,e),this._setUserInfo()},Ee([Se({title:"绑定自定义登录失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithTicket() 的语法或参数是否正确","  2 - 此账户是否已经绑定自定义登录","  3 - ticket 参数是否归属当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",Promise)],t.prototype,"linkWithTicket",null),Ee([Se({title:"绑定第三方登录方式失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithRedirect() 的语法或参数是否正确","  2 - 此账户是否已经绑定此第三方","  3 - 此第三方是否已经授权","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",void 0)],t.prototype,"linkWithRedirect",null),Ee([Se({title:"获取账户列表失败",messages:["请确认以下各项：","  1 - 调用 User.getLinkedUidList() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getLinkedUidList",null),Ee([Se({title:"设置微信主账号失败",messages:["请确认以下各项：","  1 - 调用 User.setPrimaryUid() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",void 0)],t.prototype,"setPrimaryUid",null),Ee([Se({title:"接触绑定失败",messages:["请确认以下各项：","  1 - 调用 User.unlink() 的语法或参数是否正确","  2 - 当前账户是否已经与此登录方式解绑","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",void 0)],t.prototype,"unlink",null),Ee([Se({title:"更新用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.update() 的语法或参数是否正确","  2 - 用户信息中是否包含非法值","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",Promise)],t.prototype,"update",null),Ee([Se({title:"更新密码失败",messages:["请确认以下各项：","  1 - 调用 User.updatePassword() 的语法或参数是否正确","  3 - 新密码中是否包含非法字符","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String,String]),j("design:returntype",void 0)],t.prototype,"updatePassword",null),Ee([Se({title:"更新邮箱地址失败",messages:["请确认以下各项：","  1 - 调用 User.updateEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String,String]),j("design:returntype",void 0)],t.prototype,"updateEmail",null),Ee([Se({title:"更新用户名失败",messages:["请确认以下各项：","  1 - 调用 User.updateUsername() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",void 0)],t.prototype,"updateUsername",null),Ee([Se({title:"刷新本地用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.refresh() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"refresh",null),Ee([Se({title:"绑定手机号失败",messages:["请确认以下各项：","  1 - 调用 auth().linkWithPhoneNumber() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String,String]),j("design:returntype",Promise)],t.prototype,"linkWithPhoneNumber",null),Ee([Se({title:"更新手机号失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String,String]),j("design:returntype",Promise)],t.prototype,"updatePhoneNumber",null),t}(),wt=function(){function t(e){var r=e.envId,i=e.cache,o=e.request;r||ko(mr.INVALID_PARAMS,"envId is not defined"),this._cache=i,this.user=new ed({cache:i,request:o})}return t.prototype.checkLocalState=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n,a,c;return Z(this,function(h){return e=this._cache.keys,r=e.refreshTokenKey,i=e.accessTokenKey,o=e.accessTokenExpireKey,n=this._cache.getStore(r),a=this._cache.getStore(i),c=this._cache.getStore(o),this.credential={refreshToken:n,accessToken:a,accessTokenExpire:c},this._loginType=this._cache.getStore(this._cache.keys.loginTypeKey),this.user.checkLocalInfo(),[2]})})},t.prototype.checkLocalStateAsync=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n,a,c,h;return Z(this,function(s){switch(s.label){case 0:return e=this._cache.keys,r=e.refreshTokenKey,i=e.accessTokenKey,o=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(r)];case 1:return n=s.sent(),[4,this._cache.getStoreAsync(i)];case 2:return a=s.sent(),[4,this._cache.getStoreAsync(o)];case 3:return c=s.sent(),this.credential={refreshToken:n,accessToken:a,accessTokenExpire:c},h=this,[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 4:return h._loginType=s.sent(),[4,this.user.checkLocalInfoAsync()];case 5:return s.sent(),[2]}})})},Object.defineProperty(t.prototype,"isAnonymousAuth",{get:function(){return this.loginType===pe.ANONYMOUS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCustomAuth",{get:function(){return this.loginType===pe.CUSTOM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isWeixinAuth",{get:function(){return this.loginType===pe.WECHAT||this.loginType===pe.WECHAT_OPEN||this.loginType===pe.WECHAT_PUBLIC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUsernameAuth",{get:function(){return this.loginType===pe.USERNAME},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._loginType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPhoneAuth",{get:function(){return this.loginType===pe.PHONE},enumerable:!1,configurable:!0}),t}(),td=function(){function t(e){this._config=e,this._cache=e.cache,this._request=e.request,this._runtime=e.runtime||Qh.WEB,ae.on(te.LOGIN_TYPE_CHANGED,this._onLoginTypeChanged.bind(this))}return Object.defineProperty(t.prototype,"currentUser",{get:function(){if(this._cache.mode==="async"){To(mr.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrenUser insteed");return}var e=this.hasLoginState();return e&&e.user||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)},enumerable:!1,configurable:!0}),t.prototype.getCurrenUser=function(){return Q(this,void 0,void 0,function(){var e;return Z(this,function(r){switch(r.label){case 0:return[4,this.getLoginState()];case 1:return e=r.sent(),e?[4,e.user.checkLocalInfoAsync()]:[3,3];case 2:return r.sent(),[2,e.user||null];case 3:return[2,null]}})})},t.prototype.getLoginType=function(){return Q(this,void 0,void 0,function(){return Z(this,function(e){switch(e.label){case 0:return[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 1:return[2,e.sent()]}})})},t.prototype.getAccessToken=function(){return Q(this,void 0,void 0,function(){var e;return Z(this,function(r){switch(r.label){case 0:return e={},[4,this._request.getAccessToken()];case 1:return[2,(e.accessToken=r.sent().accessToken,e.env=this._config.env,e)]}})})},t.prototype.weixinAuthProvider=function(e){var r=e.appid,i=e.scope,o=e.state;return this._weixinAuthProvider||(this._weixinAuthProvider=new Eh(_e(_e({},this._config),{cache:this._cache,request:this._request,runtime:this._runtime}),r,i,o)),this._weixinAuthProvider},t.prototype.anonymousAuthProvider=function(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new xh(_e(_e({},this._config),{cache:this._cache,request:this._request}))),this._anonymousAuthProvider},t.prototype.customAuthProvider=function(){return this._customAuthProvider||(this._customAuthProvider=new Lh(_e(_e({},this._config),{cache:this._cache,request:this._request}))),this._customAuthProvider},t.prototype.emailAuthProvider=function(){return this._emailAuthProvider||(this._emailAuthProvider=new kh(_e(_e({},this._config),{cache:this._cache,request:this._request}))),this._emailAuthProvider},t.prototype.usernameAuthProvider=function(){return this._usernameAuthProvider||(this._usernameAuthProvider=new Vh(_e(_e({},this._config),{cache:this._cache,request:this._request}))),this._usernameAuthProvider},t.prototype.phoneAuthProvider=function(){return this._phoneAuthProvider||(this._phoneAuthProvider=new Xh(_e(_e({},this._config),{cache:this._cache,request:this._request}))),this._phoneAuthProvider},t.prototype.signInWithUsernameAndPassword=function(e,r){return Q(this,void 0,void 0,function(){return Z(this,function(i){return[2,this.usernameAuthProvider().signIn(e,r)]})})},t.prototype.isUsernameRegistered=function(e){return Q(this,void 0,void 0,function(){var r;return Z(this,function(i){switch(i.label){case 0:return typeof e!="string"&&ko(mr.INVALID_PARAMS,"username must be a string"),[4,this._request.send("auth.isUsernameRegistered",{username:e})];case 1:return r=i.sent().data,[2,r==null?void 0:r.isRegistered]}})})},t.prototype.signInWithEmailAndPassword=function(e,r){return Q(this,void 0,void 0,function(){return Z(this,function(i){return[2,this.emailAuthProvider().signIn(e,r)]})})},t.prototype.signUpWithEmailAndPassword=function(e,r){return Q(this,void 0,void 0,function(){return Z(this,function(i){return[2,this.emailAuthProvider().signUp(e,r)]})})},t.prototype.sendPasswordResetEmail=function(e){return Q(this,void 0,void 0,function(){return Z(this,function(r){return[2,this.emailAuthProvider().resetPassword(e)]})})},t.prototype.signOut=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n,a,c;return Z(this,function(h){switch(h.label){case 0:return e=this._cache.keys,r=e.refreshTokenKey,i=e.accessTokenKey,o=e.accessTokenExpireKey,n="auth.logout",[4,this._cache.getStoreAsync(r)];case 1:return a=h.sent(),a?[4,this._request.send(n,{refresh_token:a})]:[2];case 2:return c=h.sent(),this._cache.removeStoreAsync(r),this._cache.removeStoreAsync(i),this._cache.removeStoreAsync(o),ae.fire(te.LOGIN_STATE_CHANGED),ae.fire(te.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.NULL,persistence:this._config.persistence}),[2,c]}})})},t.prototype.onLoginStateChanged=function(e){return Q(this,void 0,void 0,function(){var r,i=this;return Z(this,function(o){switch(o.label){case 0:return ae.on(te.LOGIN_STATE_CHANGED,function(){return Q(i,void 0,void 0,function(){var n;return Z(this,function(a){switch(a.label){case 0:return[4,this.getLoginState()];case 1:return n=a.sent(),e.call(this,n),[2]}})})}),[4,this.getLoginState()];case 1:return r=o.sent(),e.call(this,r),[2]}})})},t.prototype.onLoginStateExpired=function(e){ae.on(te.LOGIN_STATE_EXPIRED,e.bind(this))},t.prototype.onAccessTokenRefreshed=function(e){ae.on(te.ACCESS_TOKEN_REFRESHD,e.bind(this))},t.prototype.onAnonymousConverted=function(e){ae.on(te.ANONYMOUS_CONVERTED,e.bind(this))},t.prototype.onLoginTypeChanged=function(e){var r=this;ae.on(te.LOGIN_TYPE_CHANGED,function(){return Q(r,void 0,void 0,function(){var i;return Z(this,function(o){switch(o.label){case 0:return[4,this.getLoginState()];case 1:return i=o.sent(),e.call(this,i),[2]}})})})},t.prototype.hasLoginState=function(){if(this._cache.mode==="async"){To(mr.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed");return}var e=this._cache.keys.refreshTokenKey,r=this._cache.getStore(e);if(r){var i=new wt({envId:this._config.env,cache:this._cache,request:this._request});return i.checkLocalState(),i}else return null},t.prototype.getLoginState=function(){return Q(this,void 0,void 0,function(){var e,r,i;return Z(this,function(o){switch(o.label){case 0:return e=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(e)];case 1:return r=o.sent(),r?(i=new wt({envId:this._config.env,cache:this._cache,request:this._request}),[4,i.checkLocalStateAsync()]):[3,3];case 2:return o.sent(),[2,i];case 3:return[2,null]}})})},t.prototype.shouldRefreshAccessToken=function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)},t.prototype.getUserInfo=function(){return Q(this,void 0,void 0,function(){var e,r;return Z(this,function(i){switch(i.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=i.sent(),r.code?[2,r]:[2,_e(_e({},r.data),{requestId:r.seqId})]}})})},t.prototype.getAuthHeader=function(){var e=this._cache.keys,r=e.refreshTokenKey,i=e.accessTokenKey,o=this._cache.getStore(r),n=this._cache.getStore(i);return{"x-cloudbase-credentials":n+"/@@/"+o}},t.prototype.getAuthHeaderAsync=function(){return Q(this,void 0,void 0,function(){var e,r,i,o,n;return Z(this,function(a){switch(a.label){case 0:return[4,this._request.refreshAccessToken()];case 1:return a.sent(),e=this._cache.keys,r=e.refreshTokenKey,i=e.accessTokenKey,[4,this._cache.getStoreAsync(r)];case 2:return o=a.sent(),[4,this._cache.getStoreAsync(i)];case 3:return n=a.sent(),[2,{"x-cloudbase-credentials":n+"/@@/"+o}]}})})},t.prototype.sendPhoneCode=function(e){return Q(this,void 0,void 0,function(){var r;return Z(this,function(i){switch(i.label){case 0:return[4,this._request.send("auth.sendPhoneCode",{phoneNumber:Io(e)})];case 1:return r=i.sent().data,[2,r.SendStatus==="Ok"]}})})},t.prototype.signUpWithPhoneCode=function(e,r,i){return Q(this,void 0,void 0,function(){return Z(this,function(o){return[2,this.phoneAuthProvider().signUp(e,r,i)]})})},t.prototype.signInWithPhoneCodeOrPassword=function(e){return Q(this,void 0,void 0,function(){return Z(this,function(r){return[2,this.phoneAuthProvider().signIn(e)]})})},t.prototype.forceResetPwdByPhoneCode=function(e){return Q(this,void 0,void 0,function(){return Z(this,function(r){return[2,this.phoneAuthProvider().signIn(_e(_e({},e),{signMethod:Mn.FORCERESETPWD}))]})})},t.prototype._onLoginTypeChanged=function(e){return Q(this,void 0,void 0,function(){var r,i,o,n;return Z(this,function(a){switch(a.label){case 0:return r=e.data,i=r.loginType,o=r.persistence,n=r.env,n!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(o)];case 1:return a.sent(),[4,this._cache.setStoreAsync(this._cache.keys.loginTypeKey,i)];case 2:return a.sent(),[2]}})})},Ee([Se({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 调用 auth().getCurrenUser() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getCurrenUser",null),Ee([Se({title:"获取用户是否被占用失败",messages:["请确认以下各项：","  1 - 调用 auth().isUsernameRegistered() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",Promise)],t.prototype,"isUsernameRegistered",null),Ee([Se({title:"用户登出失败",messages:["请确认以下各项：","  1 - 调用 auth().signOut() 的语法或参数是否正确","  2 - 当前用户是否为匿名登录（匿名登录不支持signOut）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"signOut",null),Ee([Se({title:"获取本地登录态失败",messages:["请确认以下各项：","  1 - 调用 auth().getLoginState() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getLoginState",null),Ee([Se({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",Promise)],t.prototype,"getUserInfo",null),Ee([Se({title:"发送短信验证码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+be]}),j("design:type",Function),j("design:paramtypes",[String]),j("design:returntype",Promise)],t.prototype,"sendPhoneCode",null),t}(),te={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},Ha={name:Zh,namespace:"auth",injectEvents:{bus:ae,events:[te.LOGIN_TYPE_CHANGED,te.LOGIN_STATE_EXPIRED,te.LOGIN_STATE_CHANGED,te.ACCESS_TOKEN_REFRESHD,te.ANONYMOUS_CONVERTED]},entity:function(t){if(t===void 0&&(t={region:"",persistence:"local"}),this.authInstance)return To(mr.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var e=this.platform,r=e.adapter,i=e.runtime,o=t.persistence||r.primaryStorage;o&&o!==this.config.persistence&&this.updateConfig({persistence:o});var n=this.config,a=n.env,c=n.persistence,h=n.debug;return this.authInstance=new td({env:a,region:t.region,persistence:c,debug:h,cache:this.cache,request:this.request,runtime:i}),this.authInstance}};try{cloudbase.registerComponent(Ha)}catch{}function rd(t){try{t.registerComponent(Ha)}catch(e){console.warn(e)}}var nd=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},ro=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},id=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},od=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},sd=ee.getSdkName,no=ee.ERRORS,ad=ee.COMMUNITY_SITE_URL,Jr=ie.execCallback,ud=ot.catchErrorsDecorator,kn="functions",cd=function(){function t(){}return t.prototype.callFunction=function(e,r){return id(this,void 0,void 0,function(){var i,o,n,a,c,h,s,u,d,y,w,E;return od(this,function(A){switch(A.label){case 0:if(i=e.name,o=e.data,n=e.query,a=e.parse,c=e.search,!i)throw new Error(JSON.stringify({code:no.INVALID_PARAMS,msg:"["+kn+".callFunction] invalid function name"}));try{h=o?JSON.stringify(o):""}catch{throw new Error(JSON.stringify({code:no.INVALID_PARAMS,msg:"["+kn+".callFunction] invalid data"}))}s="functions.invokeFunction",u={inQuery:n,parse:a,search:c,function_name:i,request_data:h},d=this.request,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,d.send(s,u)];case 2:if(y=A.sent(),y.code)return[2,Jr(r,null,y)];if(w=y.data.response_data,a)return[2,Jr(r,null,{result:w,requestId:y.requestId})];try{return w=JSON.parse(y.data.response_data),[2,Jr(r,null,{result:w,requestId:y.requestId})]}catch{Jr(r,new Error("["+sd()+"]["+no.INVALID_PARAMS+"]["+kn+".callFunction] response data must be json"))}return[3,4];case 3:return E=A.sent(),Jr(r,E),[3,4];case 4:return[2]}})})},nd([ud({customInfo:{className:"Cloudbase",methodName:"callFunction"},title:"函数调用失败",messages:["请确认以下各项：","  1 - 调用 callFunction() 的语法或参数是否正确","  2 - 当前环境下是否存在此函数","  3 - 函数安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ad]}),ro("design:type",Function),ro("design:paramtypes",[Object,Function]),ro("design:returntype",Promise)],t.prototype,"callFunction",null),t}(),fd=new cd,Ga={name:kn,entity:{callFunction:fd.callFunction}};try{cloudbase.registerComponent(Ga)}catch{}function ld(t){try{t.registerComponent(Ga)}catch(e){console.warn(e)}}var Yr=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},Fe=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Xr=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},zr=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},hd=ee.getSdkName,Nt=ee.ERRORS,Qr=ee.COMMUNITY_SITE_URL,ks=ie.isArray,Zr=ie.isString,dd=ie.isPalinObject,ht=ie.execCallback,en=ot.catchErrorsDecorator,pt="storage",pd=function(){function t(){}return t.prototype.uploadFile=function(e,r){return Xr(this,void 0,void 0,function(){var i,o,n,a,c,h,s,u,d,y,w,E,A,m,_,x;return zr(this,function(I){switch(I.label){case 0:if(i=e.cloudPath,o=e.filePath,n=e.onUploadProgress,!Zr(i)||!o)throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".uploadFile] invalid params"}));return a="storage.getUploadMetadata",c=this.request,[4,c.send(a,{path:i})];case 1:return h=I.sent(),s=h.data,u=s.url,d=s.authorization,y=s.token,w=s.fileId,E=s.cosFileId,A=s.download_url,m=h.requestId,_={key:i,signature:d,"x-cos-meta-fileid":E,success_action_status:"201","x-cos-security-token":y},[4,c.upload({url:u,data:_,file:o,name:i,onUploadProgress:n})];case 2:return x=I.sent(),x.statusCode===201?[2,ht(r,null,{fileID:w,download_url:A,requestId:m})]:[2,ht(r,new Error("["+hd()+"]["+Nt.OPERATION_FAIL+"]["+pt+"]:"+x.data))]}})})},t.prototype.getUploadMetadata=function(e,r){return Xr(this,void 0,void 0,function(){var i,o,n,a,c;return zr(this,function(h){switch(h.label){case 0:if(i=e.cloudPath,!Zr(i))throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".getUploadMetadata] invalid cloudPath"}));o=this.request,n="storage.getUploadMetadata",h.label=1;case 1:return h.trys.push([1,3,,4]),[4,o.send(n,{path:i})];case 2:return a=h.sent(),[2,ht(r,null,a)];case 3:return c=h.sent(),[2,ht(r,c)];case 4:return[2]}})})},t.prototype.deleteFile=function(e,r){return Xr(this,void 0,void 0,function(){var i,o,n,a,c,h,s,u;return zr(this,function(d){switch(d.label){case 0:if(i=e.fileList,!i||!ks(i)||i.length===0)throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".deleteFile] fileList must not be empty"}));for(o=0,n=i;o<n.length;o++)if(a=n[o],!a||!Zr(a))throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".deleteFile] fileID must be string"}));return c="storage.batchDeleteFile",h=this.request,[4,h.send(c,{fileid_list:i})];case 1:return s=d.sent(),s.code?[2,ht(r,null,s)]:(u={fileList:s.data.delete_list,requestId:s.requestId},[2,ht(r,null,u)])}})})},t.prototype.getTempFileURL=function(e,r){return Xr(this,void 0,void 0,function(){var i,o,n,a,c,h,s,u;return zr(this,function(d){switch(d.label){case 0:if(i=e.fileList,!i||!ks(i)||i.length===0)throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".getTempFileURL] fileList must not be empty"}));for(o=[],n=0,a=i;n<a.length;n++)if(c=a[n],dd(c)){if(!c.hasOwnProperty("fileID")||!c.hasOwnProperty("maxAge"))throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".getTempFileURL] file info must include fileID and maxAge"}));o.push({fileid:c.fileID,max_age:c.maxAge})}else if(Zr(c))o.push({fileid:c});else throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".getTempFileURL] invalid fileList"}));return h="storage.batchGetDownloadUrl",s=this.request,[4,s.send(h,{file_list:o})];case 1:return u=d.sent(),u.code?[2,ht(r,null,u)]:[2,ht(r,null,{fileList:u.data.download_list,requestId:u.requestId})]}})})},t.prototype.downloadFile=function(e,r){return Xr(this,void 0,void 0,function(){var i,o,n,a,c,h;return zr(this,function(s){switch(s.label){case 0:if(i=e.fileID,!Zr(i))throw new Error(JSON.stringify({code:Nt.INVALID_PARAMS,msg:"["+pt+".getTempFileURL] fileID must be string"}));return[4,this.getTempFileURL.call(this,{fileList:[{fileID:i,maxAge:600}]})];case 1:return o=s.sent(),n=o.fileList[0],n.code!=="SUCCESS"?[2,ht(r,n)]:(a=this.request,c=encodeURI(n.download_url),[4,a.download({url:c})]);case 2:return h=s.sent(),[2,ht(r,null,h)]}})})},Yr([en({customInfo:{className:"Cloudbase",methodName:"uploadFile"},title:"上传文件失败",messages:["请确认以下各项：","  1 - 调用 uploadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Qr]}),Fe("design:type",Function),Fe("design:paramtypes",[Object,Function]),Fe("design:returntype",Promise)],t.prototype,"uploadFile",null),Yr([en({customInfo:{className:"Cloudbase",methodName:"getUploadMetadata"},title:"获取上传元信息失败",messages:["请确认以下各项：","  1 - 调用 getUploadMetadata() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Qr]}),Fe("design:type",Function),Fe("design:paramtypes",[Object,Function]),Fe("design:returntype",Promise)],t.prototype,"getUploadMetadata",null),Yr([en({customInfo:{className:"Cloudbase",methodName:"deleteFile"},title:"删除文件失败",messages:["请确认以下各项：","  1 - 调用 deleteFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Qr]}),Fe("design:type",Function),Fe("design:paramtypes",[Object,Function]),Fe("design:returntype",Promise)],t.prototype,"deleteFile",null),Yr([en({customInfo:{className:"Cloudbase",methodName:"getTempFileURL"},title:"获取文件下载链接",messages:["请确认以下各项：","  1 - 调用 getTempFileURL() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Qr]}),Fe("design:type",Function),Fe("design:paramtypes",[Object,Function]),Fe("design:returntype",Promise)],t.prototype,"getTempFileURL",null),Yr([en({customInfo:{className:"Cloudbase",methodName:"downloadFile"},title:"下载文件失败",messages:["请确认以下各项：","  1 - 调用 downloadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Qr]}),Fe("design:type",Function),Fe("design:paramtypes",[Object,Function]),Fe("design:returntype",Promise)],t.prototype,"downloadFile",null),t}(),tn=new pd,Ka={name:pt,entity:{uploadFile:tn.uploadFile,deleteFile:tn.deleteFile,getTempFileURL:tn.getTempFileURL,downloadFile:tn.downloadFile,getUploadMetadata:tn.getUploadMetadata}};try{cloudbase.registerComponent(Ka)}catch{}function gd(t){try{t.registerComponent(Ka)}catch(e){console.warn(e)}}var yd="Expected a function",Va="__lodash_hash_undefined__",Ja=1/0,vd=9007199254740991,md="[object Function]",_d="[object GeneratorFunction]",wd="[object Symbol]",Ed=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bd=/^\w*$/,Sd=/^\./,Ad=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Td=/[\\^$.*+?()[\]{}|]/g,Id=/\\(\\)?/g,Od=/^\[object .+?Constructor\]$/,xd=/^(?:0|[1-9]\d*)$/,Nd=typeof U=="object"&&U&&U.Object===Object&&U,Rd=typeof self=="object"&&self&&self.Object===Object&&self,$o=Nd||Rd||Function("return this")();function Cd(t,e){return t==null?void 0:t[e]}function Pd(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var Fd=Array.prototype,Bd=Function.prototype,Ya=Object.prototype,io=$o["__core-js_shared__"],$s=function(){var t=/[^.]+$/.exec(io&&io.keys&&io.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Xa=Bd.toString,ai=Ya.hasOwnProperty,za=Ya.toString,Dd=RegExp("^"+Xa.call(ai).replace(Td,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),js=$o.Symbol,Ld=Fd.splice,Ud=Qa($o,"Map"),an=Qa(Object,"create"),Ws=js?js.prototype:void 0,qs=Ws?Ws.toString:void 0;function Qt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Md(){this.__data__=an?an(null):{}}function kd(t){return this.has(t)&&delete this.__data__[t]}function $d(t){var e=this.__data__;if(an){var r=e[t];return r===Va?void 0:r}return ai.call(e,t)?e[t]:void 0}function jd(t){var e=this.__data__;return an?e[t]!==void 0:ai.call(e,t)}function Wd(t,e){var r=this.__data__;return r[t]=an&&e===void 0?Va:e,this}Qt.prototype.clear=Md;Qt.prototype.delete=kd;Qt.prototype.get=$d;Qt.prototype.has=jd;Qt.prototype.set=Wd;function Ar(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function qd(){this.__data__=[]}function Hd(t){var e=this.__data__,r=ui(e,t);if(r<0)return!1;var i=e.length-1;return r==i?e.pop():Ld.call(e,r,1),!0}function Gd(t){var e=this.__data__,r=ui(e,t);return r<0?void 0:e[r][1]}function Kd(t){return ui(this.__data__,t)>-1}function Vd(t,e){var r=this.__data__,i=ui(r,t);return i<0?r.push([t,e]):r[i][1]=e,this}Ar.prototype.clear=qd;Ar.prototype.delete=Hd;Ar.prototype.get=Gd;Ar.prototype.has=Kd;Ar.prototype.set=Vd;function tr(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Jd(){this.__data__={hash:new Qt,map:new(Ud||Ar),string:new Qt}}function Yd(t){return ci(this,t).delete(t)}function Xd(t){return ci(this,t).get(t)}function zd(t){return ci(this,t).has(t)}function Qd(t,e){return ci(this,t).set(t,e),this}tr.prototype.clear=Jd;tr.prototype.delete=Yd;tr.prototype.get=Xd;tr.prototype.has=zd;tr.prototype.set=Qd;function Zd(t,e,r){var i=t[e];(!(ai.call(t,e)&&Za(i,r))||r===void 0&&!(e in t))&&(t[e]=r)}function ui(t,e){for(var r=t.length;r--;)if(Za(t[r][0],e))return r;return-1}function ep(t){if(!Vn(t)||ap(t))return!1;var e=lp(t)||Pd(t)?Dd:Od;return e.test(fp(t))}function tp(t,e,r,i){if(!Vn(t))return t;e=op(e,t)?[e]:np(e);for(var o=-1,n=e.length,a=n-1,c=t;c!=null&&++o<n;){var h=cp(e[o]),s=r;if(o!=a){var u=c[h];s=i?i(u,h,c):void 0,s===void 0&&(s=Vn(u)?u:ip(e[o+1])?[]:{})}Zd(c,h,s),c=c[h]}return t}function rp(t){if(typeof t=="string")return t;if(Wo(t))return qs?qs.call(t):"";var e=t+"";return e=="0"&&1/t==-Ja?"-0":e}function np(t){return eu(t)?t:up(t)}function ci(t,e){var r=t.__data__;return sp(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Qa(t,e){var r=Cd(t,e);return ep(r)?r:void 0}function ip(t,e){return e=e??vd,!!e&&(typeof t=="number"||xd.test(t))&&t>-1&&t%1==0&&t<e}function op(t,e){if(eu(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Wo(t)?!0:bd.test(t)||!Ed.test(t)||e!=null&&t in Object(e)}function sp(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ap(t){return!!$s&&$s in t}var up=jo(function(t){t=dp(t);var e=[];return Sd.test(t)&&e.push(""),t.replace(Ad,function(r,i,o,n){e.push(o?n.replace(Id,"$1"):i||r)}),e});function cp(t){if(typeof t=="string"||Wo(t))return t;var e=t+"";return e=="0"&&1/t==-Ja?"-0":e}function fp(t){if(t!=null){try{return Xa.call(t)}catch{}try{return t+""}catch{}}return""}function jo(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(yd);var r=function(){var i=arguments,o=e?e.apply(this,i):i[0],n=r.cache;if(n.has(o))return n.get(o);var a=t.apply(this,i);return r.cache=n.set(o,a),a};return r.cache=new(jo.Cache||tr),r}jo.Cache=tr;function Za(t,e){return t===e||t!==t&&e!==e}var eu=Array.isArray;function lp(t){var e=Vn(t)?za.call(t):"";return e==md||e==_d}function Vn(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function hp(t){return!!t&&typeof t=="object"}function Wo(t){return typeof t=="symbol"||hp(t)&&za.call(t)==wd}function dp(t){return t==null?"":rp(t)}function pp(t,e,r){return t==null?t:tp(t,e,r)}var gp=pp,yp="Expected a function",tu="__lodash_hash_undefined__",ru=1/0,vp="[object Function]",mp="[object GeneratorFunction]",_p="[object Symbol]",wp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ep=/^\w*$/,bp=/^\./,Sp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ap=/[\\^$.*+?()[\]{}|]/g,Tp=/\\(\\)?/g,Ip=/^\[object .+?Constructor\]$/,Op=typeof U=="object"&&U&&U.Object===Object&&U,xp=typeof self=="object"&&self&&self.Object===Object&&self,qo=Op||xp||Function("return this")();function Np(t,e){return t==null?void 0:t[e]}function Rp(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var Cp=Array.prototype,Pp=Function.prototype,nu=Object.prototype,oo=qo["__core-js_shared__"],Hs=function(){var t=/[^.]+$/.exec(oo&&oo.keys&&oo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),iu=Pp.toString,fi=nu.hasOwnProperty,ou=nu.toString,Fp=RegExp("^"+iu.call(fi).replace(Ap,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gs=qo.Symbol,Bp=Cp.splice,Dp=au(qo,"Map"),un=au(Object,"create"),Ks=Gs?Gs.prototype:void 0,Vs=Ks?Ks.toString:void 0;function Zt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Lp(){this.__data__=un?un(null):{}}function Up(t){return this.has(t)&&delete this.__data__[t]}function Mp(t){var e=this.__data__;if(un){var r=e[t];return r===tu?void 0:r}return fi.call(e,t)?e[t]:void 0}function kp(t){var e=this.__data__;return un?e[t]!==void 0:fi.call(e,t)}function $p(t,e){var r=this.__data__;return r[t]=un&&e===void 0?tu:e,this}Zt.prototype.clear=Lp;Zt.prototype.delete=Up;Zt.prototype.get=Mp;Zt.prototype.has=kp;Zt.prototype.set=$p;function Tr(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function jp(){this.__data__=[]}function Wp(t){var e=this.__data__,r=li(e,t);if(r<0)return!1;var i=e.length-1;return r==i?e.pop():Bp.call(e,r,1),!0}function qp(t){var e=this.__data__,r=li(e,t);return r<0?void 0:e[r][1]}function Hp(t){return li(this.__data__,t)>-1}function Gp(t,e){var r=this.__data__,i=li(r,t);return i<0?r.push([t,e]):r[i][1]=e,this}Tr.prototype.clear=jp;Tr.prototype.delete=Wp;Tr.prototype.get=qp;Tr.prototype.has=Hp;Tr.prototype.set=Gp;function rr(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Kp(){this.__data__={hash:new Zt,map:new(Dp||Tr),string:new Zt}}function Vp(t){return hi(this,t).delete(t)}function Jp(t){return hi(this,t).get(t)}function Yp(t){return hi(this,t).has(t)}function Xp(t,e){return hi(this,t).set(t,e),this}rr.prototype.clear=Kp;rr.prototype.delete=Vp;rr.prototype.get=Jp;rr.prototype.has=Yp;rr.prototype.set=Xp;function li(t,e){for(var r=t.length;r--;)if(ug(t[r][0],e))return r;return-1}function zp(t,e){e=uu(e,t)?[e]:su(e);for(var r=0,i=e.length;t!=null&&r<i;)t=t[cu(e[r++])];return r&&r==i?t:void 0}function Qp(t){if(!lu(t)||ng(t))return!1;var e=cg(t)||Rp(t)?Fp:Ip;return e.test(sg(t))}function Zp(t,e,r){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),r=r>o?o:r,r<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var n=Array(o);++i<o;)n[i]=t[i+e];return n}function eg(t){if(typeof t=="string")return t;if(Go(t))return Vs?Vs.call(t):"";var e=t+"";return e=="0"&&1/t==-ru?"-0":e}function tg(t,e){e=uu(e,t)?[e]:su(e),t=ig(t,e);var r=cu(ag(e));return!(t!=null&&fi.call(t,r))||delete t[r]}function su(t){return fu(t)?t:og(t)}function hi(t,e){var r=t.__data__;return rg(e)?r[typeof e=="string"?"string":"hash"]:r.map}function au(t,e){var r=Np(t,e);return Qp(r)?r:void 0}function uu(t,e){if(fu(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Go(t)?!0:Ep.test(t)||!wp.test(t)||e!=null&&t in Object(e)}function rg(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ng(t){return!!Hs&&Hs in t}function ig(t,e){return e.length==1?t:zp(t,Zp(e,0,-1))}var og=Ho(function(t){t=lg(t);var e=[];return bp.test(t)&&e.push(""),t.replace(Sp,function(r,i,o,n){e.push(o?n.replace(Tp,"$1"):i||r)}),e});function cu(t){if(typeof t=="string"||Go(t))return t;var e=t+"";return e=="0"&&1/t==-ru?"-0":e}function sg(t){if(t!=null){try{return iu.call(t)}catch{}try{return t+""}catch{}}return""}function ag(t){var e=t?t.length:0;return e?t[e-1]:void 0}function Ho(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(yp);var r=function(){var i=arguments,o=e?e.apply(this,i):i[0],n=r.cache;if(n.has(o))return n.get(o);var a=t.apply(this,i);return r.cache=n.set(o,a),a};return r.cache=new(Ho.Cache||rr),r}Ho.Cache=rr;function ug(t,e){return t===e||t!==t&&e!==e}var fu=Array.isArray;function cg(t){var e=lu(t)?ou.call(t):"";return e==vp||e==mp}function lu(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function fg(t){return!!t&&typeof t=="object"}function Go(t){return typeof t=="symbol"||fg(t)&&ou.call(t)==_p}function lg(t){return t==null?"":eg(t)}function hg(t,e){return t==null?!0:tg(t,e)}var dg=hg,Jn={},pg={get exports(){return Jn},set exports(t){Jn=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",o=9007199254740991,n="[object Arguments]",a="[object Array]",c="[object Boolean]",h="[object Date]",s="[object Error]",u="[object Function]",d="[object GeneratorFunction]",y="[object Map]",w="[object Number]",E="[object Object]",A="[object Promise]",m="[object RegExp]",_="[object Set]",x="[object String]",I="[object Symbol]",T="[object WeakMap]",F="[object ArrayBuffer]",R="[object DataView]",L="[object Float32Array]",k="[object Float64Array]",B="[object Int8Array]",ue="[object Int16Array]",fe="[object Int32Array]",ye="[object Uint8Array]",Y="[object Uint8ClampedArray]",Ae="[object Uint16Array]",Ne="[object Uint32Array]",ft=/[\\^$.*+?()[\]{}|]/g,re=/\w*$/,Re=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,D={};D[n]=D[a]=D[F]=D[R]=D[c]=D[h]=D[L]=D[k]=D[B]=D[ue]=D[fe]=D[y]=D[w]=D[E]=D[m]=D[_]=D[x]=D[I]=D[ye]=D[Y]=D[Ae]=D[Ne]=!0,D[s]=D[u]=D[T]=!1;var Ie=typeof U=="object"&&U&&U.Object===Object&&U,vn=typeof self=="object"&&self&&self.Object===Object&&self,Ge=Ie||vn||Function("return this")(),Ir=e&&!e.nodeType&&e,mn=Ir&&!0&&t&&!t.nodeType&&t,Ei=mn&&mn.exports===Ir;function Or(p,S){return p.set(S[0],S[1]),p}function bi(p,S){return p.add(S),p}function Si(p,S){for(var O=-1,M=p?p.length:0;++O<M&&S(p[O],O,p)!==!1;);return p}function _n(p,S){for(var O=-1,M=S.length,ve=p.length;++O<M;)p[ve+O]=S[O];return p}function Mt(p,S,O,M){var ve=-1,Ce=p?p.length:0;for(M&&Ce&&(O=p[++ve]);++ve<Ce;)O=S(O,p[ve],ve,p);return O}function Ke(p,S){for(var O=-1,M=Array(p);++O<p;)M[O]=S(O);return M}function xr(p,S){return p==null?void 0:p[S]}function wn(p){var S=!1;if(p!=null&&typeof p.toString!="function")try{S=!!(p+"")}catch{}return S}function g(p){var S=-1,O=Array(p.size);return p.forEach(function(M,ve){O[++S]=[ve,M]}),O}function f(p,S){return function(O){return p(S(O))}}function l(p){var S=-1,O=Array(p.size);return p.forEach(function(M){O[++S]=M}),O}var v=Array.prototype,b=Function.prototype,N=Object.prototype,C=Ge["__core-js_shared__"],G=function(){var p=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),z=b.toString,J=N.hasOwnProperty,le=N.toString,se=RegExp("^"+z.call(J).replace(ft,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=Ei?Ge.Buffer:void 0,Nr=Ge.Symbol,Rr=Ge.Uint8Array,Xu=f(Object.getPrototypeOf,Object),zu=Object.create,Qu=N.propertyIsEnumerable,Zu=v.splice,es=Object.getOwnPropertySymbols,ec=kt?kt.isBuffer:void 0,tc=f(Object.keys,Object),Ai=or(Ge,"DataView"),Cr=or(Ge,"Map"),Ti=or(Ge,"Promise"),Ii=or(Ge,"Set"),Oi=or(Ge,"WeakMap"),Pr=or(Object,"create"),rc=Wt(Ai),nc=Wt(Cr),ic=Wt(Ti),oc=Wt(Ii),sc=Wt(Oi),ts=Nr?Nr.prototype:void 0,rs=ts?ts.valueOf:void 0;function $t(p){var S=-1,O=p?p.length:0;for(this.clear();++S<O;){var M=p[S];this.set(M[0],M[1])}}function ac(){this.__data__=Pr?Pr(null):{}}function uc(p){return this.has(p)&&delete this.__data__[p]}function cc(p){var S=this.__data__;if(Pr){var O=S[p];return O===i?void 0:O}return J.call(S,p)?S[p]:void 0}function fc(p){var S=this.__data__;return Pr?S[p]!==void 0:J.call(S,p)}function lc(p,S){var O=this.__data__;return O[p]=Pr&&S===void 0?i:S,this}$t.prototype.clear=ac,$t.prototype.delete=uc,$t.prototype.get=cc,$t.prototype.has=fc,$t.prototype.set=lc;function bt(p){var S=-1,O=p?p.length:0;for(this.clear();++S<O;){var M=p[S];this.set(M[0],M[1])}}function hc(){this.__data__=[]}function dc(p){var S=this.__data__,O=En(S,p);if(O<0)return!1;var M=S.length-1;return O==M?S.pop():Zu.call(S,O,1),!0}function pc(p){var S=this.__data__,O=En(S,p);return O<0?void 0:S[O][1]}function gc(p){return En(this.__data__,p)>-1}function yc(p,S){var O=this.__data__,M=En(O,p);return M<0?O.push([p,S]):O[M][1]=S,this}bt.prototype.clear=hc,bt.prototype.delete=dc,bt.prototype.get=pc,bt.prototype.has=gc,bt.prototype.set=yc;function nr(p){var S=-1,O=p?p.length:0;for(this.clear();++S<O;){var M=p[S];this.set(M[0],M[1])}}function vc(){this.__data__={hash:new $t,map:new(Cr||bt),string:new $t}}function mc(p){return bn(this,p).delete(p)}function _c(p){return bn(this,p).get(p)}function wc(p){return bn(this,p).has(p)}function Ec(p,S){return bn(this,p).set(p,S),this}nr.prototype.clear=vc,nr.prototype.delete=mc,nr.prototype.get=_c,nr.prototype.has=wc,nr.prototype.set=Ec;function ir(p){this.__data__=new bt(p)}function bc(){this.__data__=new bt}function Sc(p){return this.__data__.delete(p)}function Ac(p){return this.__data__.get(p)}function Tc(p){return this.__data__.has(p)}function Ic(p,S){var O=this.__data__;if(O instanceof bt){var M=O.__data__;if(!Cr||M.length<r-1)return M.push([p,S]),this;O=this.__data__=new nr(M)}return O.set(p,S),this}ir.prototype.clear=bc,ir.prototype.delete=Sc,ir.prototype.get=Ac,ir.prototype.has=Tc,ir.prototype.set=Ic;function Oc(p,S){var O=Ri(p)||zc(p)?Ke(p.length,String):[],M=O.length,ve=!!M;for(var Ce in p)(S||J.call(p,Ce))&&!(ve&&(Ce=="length"||Vc(Ce,M)))&&O.push(Ce);return O}function ns(p,S,O){var M=p[S];(!(J.call(p,S)&&as(M,O))||O===void 0&&!(S in p))&&(p[S]=O)}function En(p,S){for(var O=p.length;O--;)if(as(p[O][0],S))return O;return-1}function xc(p,S){return p&&is(S,Ci(S),p)}function xi(p,S,O,M,ve,Ce,Ve){var Le;if(M&&(Le=Ce?M(p,ve,Ce,Ve):M(p)),Le!==void 0)return Le;if(!Sn(p))return p;var fs=Ri(p);if(fs){if(Le=Hc(p),!S)return jc(p,Le)}else{var sr=jt(p),ls=sr==u||sr==d;if(Zc(p))return Bc(p,S);if(sr==E||sr==n||ls&&!Ce){if(wn(p))return Ce?p:{};if(Le=Gc(ls?{}:p),!S)return Wc(p,xc(Le,p))}else{if(!D[sr])return Ce?p:{};Le=Kc(p,sr,xi,S)}}Ve||(Ve=new ir);var hs=Ve.get(p);if(hs)return hs;if(Ve.set(p,Le),!fs)var ds=O?qc(p):Ci(p);return Si(ds||p,function(Pi,An){ds&&(An=Pi,Pi=p[An]),ns(Le,An,xi(Pi,S,O,M,An,p,Ve))}),Le}function Nc(p){return Sn(p)?zu(p):{}}function Rc(p,S,O){var M=S(p);return Ri(p)?M:_n(M,O(p))}function Cc(p){return le.call(p)}function Pc(p){if(!Sn(p)||Yc(p))return!1;var S=cs(p)||wn(p)?se:Re;return S.test(Wt(p))}function Fc(p){if(!ss(p))return tc(p);var S=[];for(var O in Object(p))J.call(p,O)&&O!="constructor"&&S.push(O);return S}function Bc(p,S){if(S)return p.slice();var O=new p.constructor(p.length);return p.copy(O),O}function Ni(p){var S=new p.constructor(p.byteLength);return new Rr(S).set(new Rr(p)),S}function Dc(p,S){var O=S?Ni(p.buffer):p.buffer;return new p.constructor(O,p.byteOffset,p.byteLength)}function Lc(p,S,O){var M=S?O(g(p),!0):g(p);return Mt(M,Or,new p.constructor)}function Uc(p){var S=new p.constructor(p.source,re.exec(p));return S.lastIndex=p.lastIndex,S}function Mc(p,S,O){var M=S?O(l(p),!0):l(p);return Mt(M,bi,new p.constructor)}function kc(p){return rs?Object(rs.call(p)):{}}function $c(p,S){var O=S?Ni(p.buffer):p.buffer;return new p.constructor(O,p.byteOffset,p.length)}function jc(p,S){var O=-1,M=p.length;for(S||(S=Array(M));++O<M;)S[O]=p[O];return S}function is(p,S,O,M){O||(O={});for(var ve=-1,Ce=S.length;++ve<Ce;){var Ve=S[ve],Le=M?M(O[Ve],p[Ve],Ve,O,p):void 0;ns(O,Ve,Le===void 0?p[Ve]:Le)}return O}function Wc(p,S){return is(p,os(p),S)}function qc(p){return Rc(p,Ci,os)}function bn(p,S){var O=p.__data__;return Jc(S)?O[typeof S=="string"?"string":"hash"]:O.map}function or(p,S){var O=xr(p,S);return Pc(O)?O:void 0}var os=es?f(es,Object):rf,jt=Cc;(Ai&&jt(new Ai(new ArrayBuffer(1)))!=R||Cr&&jt(new Cr)!=y||Ti&&jt(Ti.resolve())!=A||Ii&&jt(new Ii)!=_||Oi&&jt(new Oi)!=T)&&(jt=function(p){var S=le.call(p),O=S==E?p.constructor:void 0,M=O?Wt(O):void 0;if(M)switch(M){case rc:return R;case nc:return y;case ic:return A;case oc:return _;case sc:return T}return S});function Hc(p){var S=p.length,O=p.constructor(S);return S&&typeof p[0]=="string"&&J.call(p,"index")&&(O.index=p.index,O.input=p.input),O}function Gc(p){return typeof p.constructor=="function"&&!ss(p)?Nc(Xu(p)):{}}function Kc(p,S,O,M){var ve=p.constructor;switch(S){case F:return Ni(p);case c:case h:return new ve(+p);case R:return Dc(p,M);case L:case k:case B:case ue:case fe:case ye:case Y:case Ae:case Ne:return $c(p,M);case y:return Lc(p,M,O);case w:case x:return new ve(p);case m:return Uc(p);case _:return Mc(p,M,O);case I:return kc(p)}}function Vc(p,S){return S=S??o,!!S&&(typeof p=="number"||V.test(p))&&p>-1&&p%1==0&&p<S}function Jc(p){var S=typeof p;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?p!=="__proto__":p===null}function Yc(p){return!!G&&G in p}function ss(p){var S=p&&p.constructor,O=typeof S=="function"&&S.prototype||N;return p===O}function Wt(p){if(p!=null){try{return z.call(p)}catch{}try{return p+""}catch{}}return""}function Xc(p){return xi(p,!0,!0)}function as(p,S){return p===S||p!==p&&S!==S}function zc(p){return Qc(p)&&J.call(p,"callee")&&(!Qu.call(p,"callee")||le.call(p)==n)}var Ri=Array.isArray;function us(p){return p!=null&&ef(p.length)&&!cs(p)}function Qc(p){return tf(p)&&us(p)}var Zc=ec||nf;function cs(p){var S=Sn(p)?le.call(p):"";return S==u||S==d}function ef(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=o}function Sn(p){var S=typeof p;return!!p&&(S=="object"||S=="function")}function tf(p){return!!p&&typeof p=="object"}function Ci(p){return us(p)?Oc(p):Fc(p)}function rf(){return[]}function nf(){return!1}t.exports=Xc})(pg,Jn);const gg=Jn;function gr(t){return t===void 0&&(t=""),(t?t+"_":"")+ +new Date+"_"+Math.random()}var yg=function(){function t(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}return t}(),Js=function(){function t(e){var r=e.id,i=e.docChanges,o=e.docs,n=e.msgType,a=e.type,c,h;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return c||(c=JSON.parse(JSON.stringify(i))),c},enumerable:!0},docs:{get:function(){return h||(h=JSON.parse(JSON.stringify(o))),h},enumerable:!0},msgType:{get:function(){return n},enumerable:!0},type:{get:function(){return a},enumerable:!0}})}return t}(),di=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),vg=function(t){di(e,t);function e(r){var i=t.call(this,"Watch Error "+JSON.stringify(r.msgData)+" (requestid: "+r.requestId+")")||this;return i.isRealtimeErrorMessageError=!0,i.payload=r,i}return e}(Error),Ys=function(t){return t==null?void 0:t.isRealtimeErrorMessageError},mg=function(t){di(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="timeout",r.payload=null,r.generic=!0,r}return e}(Error),_g=function(t){return t.type==="timeout"},wg=function(t){di(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="cancelled",r.payload=null,r.generic=!0,r}return e}(Error),Eg=function(t){return t.type==="cancelled"},Ze=function(t){di(e,t);function e(r){var i=t.call(this,r.errMsg)||this;return i.errCode="UNKNOWN_ERROR",Object.defineProperties(i,{message:{get:function(){return"errCode: "+this.errCode+" "+(Me[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(o){this.errMsg=o}}}),i.errCode=r.errCode||"UNKNOWN_ERROR",i.errMsg=r.errMsg,i}return Object.defineProperty(e.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(r){this.errMsg=r},enumerable:!1,configurable:!0}),e}(Error),Me={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"},Oo=function(t){return t===void 0&&(t=0),new Promise(function(e){return setTimeout(e,t)})},$e=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},Ue=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Xs=globalThis&&globalThis.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<r;e++)for(var n=arguments[e],a=0,c=n.length;a<c;a++,o++)i[o]=n[a];return i},ne;(function(t){t.LOGGINGIN="LOGGINGIN",t.INITING="INITING",t.REBUILDING="REBUILDING",t.ACTIVE="ACTIVE",t.ERRORED="ERRORED",t.CLOSING="CLOSING",t.CLOSED="CLOSED",t.PAUSED="PAUSED",t.RESUMING="RESUMING"})(ne||(ne={}));var bg=100,Fn=2,Sg=2,Ag=10*1e3,Tg=10*1e3,Ig=10*1e3,Og=function(){function t(e){var r=this;this.watchStatus=ne.INITING,this._login=function(i,o){return $e(r,void 0,void 0,function(){var n;return Ue(this,function(a){switch(a.label){case 0:return this.watchStatus=ne.LOGGINGIN,[4,this.login(i,o)];case 1:return n=a.sent(),this.envId||(this.envId=n.envId),[2,n]}})})},this.initWatch=function(i){return $e(r,void 0,void 0,function(){var o,n=this;return Ue(this,function(a){switch(a.label){case 0:if(this._initWatchPromise)return[2,this._initWatchPromise];this._initWatchPromise=new Promise(function(c,h){return $e(n,void 0,void 0,function(){var s,u,d,y,w,E,A,m,_,x,I;return Ue(this,function(T){switch(T.label){case 0:return T.trys.push([0,3,,4]),this.watchStatus===ne.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,c()]):[4,this._login(this.envId,i)];case 1:return s=T.sent().envId,this.watchStatus===ne.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,c()]):(this.watchStatus=ne.INITING,u={watchId:this.watchId,requestId:gr(),msgType:"INIT_WATCH",msgData:{envId:s,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:u,waitResponse:!0,skipOnMessage:!0,timeout:Tg})]);case 2:if(d=T.sent(),y=d.msgData,w=y.events,E=y.currEvent,this.sessionInfo={queryID:d.msgData.queryID,currentEventId:E-1,currentDocs:[]},w.length>0){for(A=0,m=w;A<m.length;A++)_=m[A],_.ID=E;this.handleServerEvents(d)}else this.sessionInfo.currentEventId=E,x=new Js({id:E,docChanges:[],docs:[],type:"init"}),this.listener.onChange(x),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=ne.ACTIVE,this._availableRetries.INIT_WATCH=Fn,c(),[3,4];case 3:return I=T.sent(),this.handleWatchEstablishmentError(I,{operationName:"INIT_WATCH",resolve:c,reject:h}),[3,4];case 4:return[2]}})})}),o=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._initWatchPromise];case 2:return a.sent(),o=!0,[3,4];case 3:return this._initWatchPromise=void 0,[7];case 4:return console.log("[realtime] initWatch "+(o?"success":"fail")),[2]}})})},this.rebuildWatch=function(i){return $e(r,void 0,void 0,function(){var o,n=this;return Ue(this,function(a){switch(a.label){case 0:if(this._rebuildWatchPromise)return[2,this._rebuildWatchPromise];this._rebuildWatchPromise=new Promise(function(c,h){return $e(n,void 0,void 0,function(){var s,u,d,y;return Ue(this,function(w){switch(w.label){case 0:return w.trys.push([0,3,,4]),this.watchStatus===ne.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,c()]):[4,this._login(this.envId,i)];case 1:if(s=w.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===ne.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,c()]):(this.watchStatus=ne.REBUILDING,u={watchId:this.watchId,requestId:gr(),msgType:"REBUILD_WATCH",msgData:{envId:s,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:u,waitResponse:!0,skipOnMessage:!1,timeout:Ig})]);case 2:return d=w.sent(),this.handleServerEvents(d),this.watchStatus=ne.ACTIVE,this._availableRetries.REBUILD_WATCH=Fn,c(),[3,4];case 3:return y=w.sent(),this.handleWatchEstablishmentError(y,{operationName:"REBUILD_WATCH",resolve:c,reject:h}),[3,4];case 4:return[2]}})})}),o=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._rebuildWatchPromise];case 2:return a.sent(),o=!0,[3,4];case 3:return this._rebuildWatchPromise=void 0,[7];case 4:return console.log("[realtime] rebuildWatch "+(o?"success":"fail")),[2]}})})},this.handleWatchEstablishmentError=function(i,o){return $e(r,void 0,void 0,function(){var n,a,c,h=this;return Ue(this,function(s){return n=o.operationName==="INIT_WATCH",a=function(){h.closeWithError(new Ze({errCode:n?Me.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:Me.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:i})),o.reject(i)},c=function(u){h.useRetryTicket(o.operationName)?n?(h._initWatchPromise=void 0,o.resolve(h.initWatch(u))):(h._rebuildWatchPromise=void 0,o.resolve(h.rebuildWatch(u))):a()},this.handleCommonError(i,{onSignError:function(){return c(!0)},onTimeoutError:function(){return c(!1)},onNotRetryableError:a,onCancelledError:o.reject,onUnknownError:function(){return $e(h,void 0,void 0,function(){var u,d=this;return Ue(this,function(y){switch(y.label){case 0:return y.trys.push([0,8,,9]),u=function(){return $e(d,void 0,void 0,function(){return Ue(this,function(w){switch(w.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return w.sent(),c(!0),[2]}})})},this.isWSConnected()?[3,2]:[4,u()];case 1:return y.sent(),[3,7];case 2:return[4,Oo(bg)];case 3:return y.sent(),this.watchStatus!==ne.PAUSED?[3,4]:(o.reject(new wg(o.operationName+" cancelled due to pause after unknownError")),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,u()];case 5:return y.sent(),[3,7];case 6:c(!1),y.label=7;case 7:return[3,9];case 8:return y.sent(),c(!0),[3,9];case 9:return[2]}})})}}),[2]})})},this.closeWatch=function(){return $e(r,void 0,void 0,function(){var i,o,n;return Ue(this,function(a){switch(a.label){case 0:if(i=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==ne.ACTIVE)return this.watchStatus=ne.CLOSED,this.onWatchClose(this,i),[2];a.label=1;case 1:return a.trys.push([1,3,4,5]),this.watchStatus=ne.CLOSING,o={watchId:this.watchId,requestId:gr(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:o})];case 2:return a.sent(),this.sessionInfo=void 0,this.watchStatus=ne.CLOSED,[3,5];case 3:return n=a.sent(),this.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:n})),[3,5];case 4:return this.onWatchClose(this,i),[7];case 5:return[2]}})})},this.scheduleSendACK=function(){r.clearACKSchedule(),r._ackTimeoutId=setTimeout(function(){r._waitExpectedTimeoutId?r.scheduleSendACK():r.sendACK()},Ag)},this.clearACKSchedule=function(){r._ackTimeoutId&&clearTimeout(r._ackTimeoutId)},this.sendACK=function(){return $e(r,void 0,void 0,function(){var i,o,n;return Ue(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),this.watchStatus!==ne.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(i={watchId:this.watchId,requestId:gr(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:i})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return a.sent(),this.scheduleSendACK(),[3,3];case 2:if(o=a.sent(),Ys(o))switch(n=o.payload,n.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:n.msgData.code})),[2]}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:o})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(i,o){if(Ys(i)){var n=i.payload;switch(n.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":{o.onSignError(i);return}case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":{o.onNotRetryableError(i);return}default:{o.onNotRetryableError(i);return}}}else if(_g(i)){o.onTimeoutError(i);return}else if(Eg(i)){o.onCancelledError(i);return}o.onUnknownError(i)},this.watchId="watchid_"+ +new Date+"_"+Math.random(),this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.onceWSConnected=e.onceWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.debug=e.debug,this._availableRetries={INIT_WATCH:Fn,REBUILD_WATCH:Fn,CHECK_LAST:Sg},this.listener=new yg({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return t.prototype.onMessage=function(e){var r=this;switch(this.watchStatus){case ne.PAUSED:{if(e.msgType!=="ERROR")return;break}case ne.LOGGINGIN:case ne.INITING:case ne.REBUILDING:{console.warn("[realtime listener] internal non-fatal error: unexpected message received while "+this.watchStatus);return}case ne.CLOSED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");return}case ne.ERRORED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error");return}}if(!this.sessionInfo){console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.");return}switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":{console.warn("nextevent "+e.msgData.currEvent+" ignored",e),this.handleServerEvents(e);break}case"CHECK_EVENT":{this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(function(){r.rebuildWatch()},this.getWaitExpectedTimeoutLength()),console.log("[realtime] waitExpectedTimeoutLength "+this.getWaitExpectedTimeoutLength()));break}case"ERROR":{this.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:e.msgData.code+" - "+e.msgData.message}));break}default:{console.warn("[realtime listener] virtual client receive unexpected msg "+e.msgType+": ",e);break}}},t.prototype.closeWithError=function(e){this.watchStatus=ne.ERRORED,this.clearACKSchedule(),this.listener.onError(e),this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),console.log("[realtime] client closed ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},t.prototype.pause=function(){this.watchStatus=ne.PAUSED,console.log("[realtime] client paused ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},t.prototype.resume=function(){return $e(this,void 0,void 0,function(){var e;return Ue(this,function(r){switch(r.label){case 0:this.watchStatus=ne.RESUMING,console.log("[realtime] client resuming with "+(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH")+" ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return r.sent(),console.log("[realtime] client successfully resumed ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),[3,4];case 3:return e=r.sent(),console.error("[realtime] client resume failed ("+this.collectionName+" "+this.query+") ("+this.watchId+")",e),[3,4];case 4:return[2]}})})},t.prototype.useRetryTicket=function(e){return this._availableRetries[e]&&this._availableRetries[e]>0?(this._availableRetries[e]--,console.log("[realtime] "+e+" use a retry ticket, now only "+this._availableRetries[e]+" retry left"),!0):!1},t.prototype.handleServerEvents=function(e){return $e(this,void 0,void 0,function(){var r;return Ue(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(e)];case 1:return i.sent(),this._postHandleServerEventsValidityCheck(e),[3,3];case 2:throw r=i.sent(),console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",r),r;case 3:return[2]}})})},t.prototype._handleServerEvents=function(e){return $e(this,void 0,void 0,function(){var r,i,o,n,a,c,h,s,u,d,y,w;return Ue(this,function(E){switch(E.label){case 0:if(r=e.requestId,i=e.msgData.events,o=e.msgType,!i.length||!this.sessionInfo)return[2];n=this.sessionInfo;try{a=i.map(xg)}catch(A){return this.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:A})),[2]}c=Xs(n.currentDocs),h=!1,s=function(A,m){var _,x,R,F,I,T,F,L,L,R,R,L,k,k,B,ue,fe;return Ue(this,function(ye){switch(ye.label){case 0:return _=a[A],n.currentEventId>=_.id?(!a[A-1]||_.id>a[A-1].id?console.warn("[realtime] duplicate event received, cur "+n.currentEventId+" but got "+_.id):console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId "+r+")"),[2,"continue"]):[3,1];case 1:if(n.currentEventId!==_.id-1)return[3,2];switch(_.dataType){case"update":{if(!_.doc)switch(_.queueType){case"update":case"dequeue":{if(x=c.find(function(Y){return Y._id===_.docId}),x){if(R=gg(x),_.updatedFields)for(F in _.updatedFields)gp(R,F,_.updatedFields[F]);if(_.removedFields)for(I=0,T=_.removedFields;I<T.length;I++)F=T[I],dg(R,F);_.doc=R}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break}case"enqueue":throw L=new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '+e.requestId+")"}),u.closeWithError(L),L}break}case"replace":{if(!_.doc)throw L=new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '+e.requestId+")"}),u.closeWithError(L),L;break}case"remove":{R=c.find(function(Y){return Y._id===_.docId}),R?_.doc=R:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break}case"limit":{if(!_.doc)switch(_.queueType){case"dequeue":{R=c.find(function(Y){return Y._id===_.docId}),R?_.doc=R:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");break}case"enqueue":throw L=new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '+e.requestId+")"}),u.closeWithError(L),L}break}}switch(_.queueType){case"init":{h?c.push(_.doc):(h=!0,c=[_.doc]);break}case"enqueue":{c.push(_.doc);break}case"dequeue":{k=c.findIndex(function(Y){return Y._id===_.docId}),k>-1?c.splice(k,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break}case"update":{k=c.findIndex(function(Y){return Y._id===_.docId}),k>-1?c[k]=_.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}}return(A===m-1||a[A+1]&&a[A+1].id!==_.id)&&(B=Xs(c),ue=a.slice(0,A+1).filter(function(Y){return Y.id===_.id}),u.sessionInfo.currentEventId=_.id,u.sessionInfo.currentDocs=c,fe=new Js({id:_.id,docChanges:ue,docs:B,msgType:o}),u.listener.onChange(fe)),[3,4];case 2:return console.warn("[realtime listener] event received is out of order, cur "+u.sessionInfo.currentEventId+" but got "+_.id),[4,u.rebuildWatch()];case 3:return ye.sent(),[2,{value:void 0}];case 4:return[2]}})},u=this,d=0,y=a.length,E.label=1;case 1:return d<y?[5,s(d,y)]:[3,4];case 2:if(w=E.sent(),typeof w=="object")return[2,w.value];E.label=3;case 3:return d++,[3,1];case 4:return[2]}})})},t.prototype._postHandleServerEventsValidityCheck=function(e){if(!this.sessionInfo){console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur");return}if(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent){console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling");return}},t.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},t}();function xg(t){var e={id:t.ID,dataType:t.DataType,queueType:t.QueueType,docId:t.DocID,doc:t.Doc&&t.Doc!=="{}"?JSON.parse(t.Doc):void 0};return t.DataType==="update"&&(t.UpdatedFields&&(e.updatedFields=JSON.parse(t.UpdatedFields)),(t.removedFields||t.RemovedFields)&&(e.removedFields=JSON.parse(t.removedFields))),e}var hu={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}},Qe;(function(t){t[t.NormalClosure=1e3]="NormalClosure",t[t.GoingAway=1001]="GoingAway",t[t.ProtocolError=1002]="ProtocolError",t[t.UnsupportedData=1003]="UnsupportedData",t[t.NoStatusReceived=1005]="NoStatusReceived",t[t.AbnormalClosure=1006]="AbnormalClosure",t[t.InvalidFramePayloadData=1007]="InvalidFramePayloadData",t[t.PolicyViolation=1008]="PolicyViolation",t[t.MessageTooBig=1009]="MessageTooBig",t[t.MissingExtension=1010]="MissingExtension",t[t.InternalError=1011]="InternalError",t[t.ServiceRestart=1012]="ServiceRestart",t[t.TryAgainLater=1013]="TryAgainLater",t[t.BadGateway=1014]="BadGateway",t[t.TLSHandshake=1015]="TLSHandshake",t[t.ReconnectWebSocket=3e3]="ReconnectWebSocket",t[t.NoRealtimeListeners=3001]="NoRealtimeListeners",t[t.HeartbeatPingError=3002]="HeartbeatPingError",t[t.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",t[t.NoAuthentication=3050]="NoAuthentication"})(Qe||(Qe={}));var so=function(t,e){var r=hu[t],i=r?r.name+", code "+t+", reason "+(e||r.description):"code "+t;return new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:i})},du=null,pu="web";function Ng(){return du}function Rg(t){du=t}function zs(){return pu}function Cg(t){pu=t}var Yn=globalThis&&globalThis.__assign||function(){return Yn=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Yn.apply(this,arguments)},at=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},ut=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ao={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},Qs=3,Pg=5e3,Fg=1e4,Bg=5,Dg=1e4,Lg=2,Ug=2,Mg=5e3,kg=function(){function t(e){var r=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._wsReadySubsribers=[],this._wsResponseWait=new Map,this._rttObserved=[],this.send=function(i){return at(r,void 0,void 0,function(){var o=this;return ut(this,function(n){return[2,new Promise(function(a,c){return at(o,void 0,void 0,function(){var h,s,u,d,y,w,E,A=this;return ut(this,function(m){switch(m.label){case 0:s=!1,u=!1,d=function(_){s=!0,h&&clearTimeout(h),a(_)},y=function(_){u=!0,h&&clearTimeout(h),c(_)},i.timeout&&(h=setTimeout(function(){return at(A,void 0,void 0,function(){return ut(this,function(_){switch(_.label){case 0:return!s||!u?[4,Oo(0)]:[3,2];case 1:_.sent(),(!s||!u)&&y(new mg("wsclient.send timedout")),_.label=2;case 2:return[2]}})})},i.timeout)),m.label=1;case 1:return m.trys.push([1,8,,9]),this._wsInitPromise?[4,this._wsInitPromise]:[3,3];case 2:m.sent(),m.label=3;case 3:if(!this._ws)return y(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==ao.OPEN)return y(new Error("ws readyState invalid: "+this._ws.readyState+", can not send message")),[2];i.waitResponse&&this._wsResponseWait.set(i.msg.requestId,{resolve:d,reject:y,skipOnMessage:i.skipOnMessage}),m.label=4;case 4:return m.trys.push([4,6,,7]),[4,this._ws.send(JSON.stringify(i.msg))];case 5:return m.sent(),i.waitResponse||d(),[3,7];case 6:return w=m.sent(),w&&(y(w),i.waitResponse&&this._wsResponseWait.delete(i.msg.requestId)),[3,7];case 7:return[3,9];case 8:return E=m.sent(),y(E),[3,9];case 9:return[2]}})})})]})})},this.closeAllClients=function(i){r._virtualWSClient.forEach(function(o){o.closeWithError(i)})},this.pauseClients=function(i){(i||r._virtualWSClient).forEach(function(o){o.pause()})},this.resumeClients=function(i){(i||r._virtualWSClient).forEach(function(o){o.resume()})},this.initWebSocketConnection=function(i,o){return o===void 0&&(o=r._maxReconnect),at(r,void 0,void 0,function(){var n=this;return ut(this,function(a){switch(a.label){case 0:if(i&&this._reconnectState)return[2];if(i&&(this._reconnectState=!0),this._wsInitPromise)return[2,this._wsInitPromise];i&&this.pauseClients(),this.close(Qe.ReconnectWebSocket),this._wsInitPromise=new Promise(function(c,h){return at(n,void 0,void 0,function(){var s,u,d,y=this;return ut(this,function(w){switch(w.label){case 0:return w.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return s=w.sent(),[4,new Promise(function(E){var A=s.wsUrl||"wss://tcb-ws.tencentcloudapi.com",m=Ng();y._ws=m?new m(A):new WebSocket(A),E()})];case 2:return w.sent(),this._ws.connect?[4,this._ws.connect()]:[3,4];case 3:w.sent(),w.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return w.sent(),c(),i&&(this.resumeClients(),this._reconnectState=!1),[3,11];case 6:return u=w.sent(),console.error("[realtime] initWebSocketConnection connect fail",u),o>0?(d=!0,this._wsInitPromise=void 0,d?[4,Oo(this._reconnectInterval)]:[3,8]):[3,9];case 7:w.sent(),i&&(this._reconnectState=!1),w.label=8;case 8:return c(this.initWebSocketConnection(i,o-1)),[3,10];case 9:h(u),i&&this.closeAllClients(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:u})),w.label=10;case 10:return[3,11];case 11:return[2]}})})}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this._wsInitPromise];case 2:return a.sent(),this._wsReadySubsribers.forEach(function(c){var h=c.resolve;return h()}),[3,5];case 3:return a.sent(),this._wsReadySubsribers.forEach(function(c){var h=c.reject;return h()}),[3,5];case 4:return this._wsInitPromise=void 0,this._wsReadySubsribers=[],[7];case 5:return[2]}})})},this.initWebSocketEvent=function(){return new Promise(function(i,o){if(!r._ws)throw new Error("can not initWebSocketEvent, ws not exists");var n=!1;r._ws.onopen=function(a){console.warn("[realtime] ws event: open",a),n=!0,i()},r._ws.onerror=function(a){r._logins=new Map,n?(console.error("[realtime] ws event: error",a),r.clearHeartbeat(),r._virtualWSClient.forEach(function(c){return c.closeWithError(new Ze({errCode:Me.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:a}))})):(console.error("[realtime] ws open failed with ws event: error",a),o(a))},r._ws.onclose=function(a){switch(console.warn("[realtime] ws event: close",a),r._logins=new Map,r.clearHeartbeat(),a.code){case Qe.ReconnectWebSocket:break;case Qe.NoRealtimeListeners:break;case Qe.HeartbeatPingError:case Qe.HeartbeatPongTimeoutError:case Qe.NormalClosure:case Qe.AbnormalClosure:{r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(so(a.code));break}case Qe.NoAuthentication:{r.closeAllClients(so(a.code,a.reason));break}default:r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(so(a.code))}},r._ws.onmessage=function(a){var c=a.data;r.heartbeat();var h;try{h=JSON.parse(c)}catch(_){throw new Error("[realtime] onMessage parse res.data error: "+_)}if(h.msgType==="ERROR"){var s=null;r._virtualWSClient.forEach(function(_){_.watchId===h.watchId&&(s=_)}),s&&s.listener.onError(h)}var u=r._wsResponseWait.get(h.requestId);if(u){try{h.msgType==="ERROR"?u.reject(new vg(h)):u.resolve(h)}catch(_){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",_)}finally{r._wsResponseWait.delete(h.requestId)}if(u.skipOnMessage)return}if(h.msgType==="PONG"){if(r._lastPingSendTS){var d=Date.now()-r._lastPingSendTS;if(d>Fg){console.warn("[realtime] untrusted rtt observed: "+d);return}r._rttObserved.length>=Qs&&r._rttObserved.splice(0,r._rttObserved.length-Qs+1),r._rttObserved.push(d)}return}var y=h.watchId&&r._watchIdClientMap.get(h.watchId);if(y)y.onMessage(h);else switch(console.error("[realtime] no realtime listener found responsible for watchId "+h.watchId+": ",h),h.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":{y=r._queryIdClientMap.get(h.msgData.queryID),y&&y.onMessage(h);break}default:for(var w=0,E=Array.from(r._watchIdClientMap.entries());w<E.length;w++){var A=E[w],m=A[1];m.onMessage(h);break}}},r.heartbeat()})},this.isWSConnected=function(){return Boolean(r._ws&&r._ws.readyState===ao.OPEN)},this.onceWSConnected=function(){return at(r,void 0,void 0,function(){var i=this;return ut(this,function(o){return this.isWSConnected()?[2]:this._wsInitPromise?[2,this._wsInitPromise]:[2,new Promise(function(n,a){i._wsReadySubsribers.push({resolve:n,reject:a})})]})})},this.webLogin=function(i,o){return at(r,void 0,void 0,function(){var n,a,c,h,s,u,d,y,w=this;return ut(this,function(E){switch(E.label){case 0:if(!o){if(i){if(n=this._logins.get(i),n){if(n.loggedIn&&n.loginResult)return[2,n.loginResult];if(n.loggingInPromise)return[2,n.loggingInPromise]}}else if(a=this._logins.get(""),a!=null&&a.loggingInPromise)return[2,a.loggingInPromise]}c=new Promise(function(A,m){return at(w,void 0,void 0,function(){var _,x,I,T,F;return ut(this,function(R){switch(R.label){case 0:return R.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return _=R.sent(),x={envId:_.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},I={watchId:void 0,requestId:gr(),msgType:"LOGIN",msgData:x,exMsgData:{runtime:zs(),signStr:_.signStr,secretVersion:_.secretVersion}},[4,this.send({msg:I,waitResponse:!0,skipOnMessage:!0,timeout:Mg})];case 2:return T=R.sent(),T.msgData.code?m(new Error(T.msgData.code+" "+T.msgData.message)):A({envId:_.envId}),[3,4];case 3:return F=R.sent(),m(F),[3,4];case 4:return[2]}})})}),h=i&&this._logins.get(i),s=Date.now(),h?(h.loggedIn=!1,h.loggingInPromise=c,h.loginStartTS=s):(h={loggedIn:!1,loggingInPromise:c,loginStartTS:s},this._logins.set(i||"",h)),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,c];case 2:if(u=E.sent(),d=i&&this._logins.get(i),d&&d===h&&d.loginStartTS===s)return h.loggedIn=!0,h.loggingInPromise=void 0,h.loginStartTS=void 0,h.loginResult=u,[2,u];if(d){if(d.loggedIn&&d.loginResult)return[2,d.loginResult];if(d.loggingInPromise)return[2,d.loggingInPromise];throw new Error("ws unexpected login info")}else throw new Error("ws login info reset");case 3:throw y=E.sent(),h.loggedIn=!1,h.loggingInPromise=void 0,h.loginStartTS=void 0,h.loginResult=void 0,y;case 4:return[2]}})})},this.getWsSign=function(){return at(r,void 0,void 0,function(){var i,o,n,a,c,h,s;return ut(this,function(u){switch(u.label){case 0:return this._wsSign&&this._wsSign.expiredTs>Date.now()?[2,this._wsSign]:(i=Date.now()+6e4,[4,this._context.appConfig.request.send("auth.wsWebSign",{runtime:zs()})]);case 1:if(o=u.sent(),o.code)throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败: "+o.code);if(o.data)return n=o.data,a=n.signStr,c=n.wsUrl,h=n.secretVersion,s=n.envId,[2,{signStr:a,wsUrl:c,secretVersion:h,envId:s,expiredTs:i}];throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败")}})})},this.getWaitExpectedTimeoutLength=function(){return r._rttObserved.length?r._rttObserved.reduce(function(i,o){return i+o})/r._rttObserved.length*1.5:Pg},this.ping=function(){return at(r,void 0,void 0,function(){var i;return ut(this,function(o){switch(o.label){case 0:return i={watchId:void 0,requestId:gr(),msgType:"PING",msgData:null},[4,this.send({msg:i})];case 1:return o.sent(),[2]}})})},this.onWatchStart=function(i,o){r._queryIdClientMap.set(o,i)},this.onWatchClose=function(i,o){o&&r._queryIdClientMap.delete(o),r._watchIdClientMap.delete(i.watchId),r._virtualWSClient.delete(i),r._virtualWSClient.size||r.close(Qe.NoRealtimeListeners)},this._maxReconnect=e.maxReconnect||Bg,this._reconnectInterval=e.reconnectInterval||Dg,this._context=e.context}return t.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},t.prototype.close=function(e){this.clearHeartbeat(),this._ws&&(this._ws.close(e,hu[e].name),this._ws=void 0)},t.prototype.watch=function(e){!this._ws&&!this._wsInitPromise&&this.initWebSocketConnection(!1);var r=new Og(Yn(Yn({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this._virtualWSClient.add(r),this._watchIdClientMap.set(r.watchId,r),r.listener},t.prototype.heartbeat=function(e){var r=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(function(){return at(r,void 0,void 0,function(){var i=this;return ut(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),!this._ws||this._ws.readyState!==ao.OPEN?[2]:(this._lastPingSendTS=Date.now(),[4,this.ping()]);case 1:return o.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout(function(){console.error("pong timed out"),i._pongMissed<Ug?(i._pongMissed++,i.heartbeat(!0)):i.initWebSocketConnection(!0)},this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return o.sent(),this._pingFailed<Lg?(this._pingFailed++,this.heartbeat()):this.close(Qe.HeartbeatPingError),[3,3];case 3:return[2]}})})},e?0:this._context.appConfig.realtimePingInterval)},t}(),gu={target:"database",entity:function(){var t=this.platform,e=t.adapter,r=t.runtime;Rg(e.wsClass),Cg(r)}},yu={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=kg}};try{cloudbase.registerComponent(yu),cloudbase.registerHook(gu)}catch{}function $g(t){try{t.registerComponent(yu),t.registerHook(gu)}catch(e){console.warn(e)}}var jg=globalThis&&globalThis.__decorate||function(t,e,r,i){var o=arguments.length,n=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(e,r,n):a(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},uo=globalThis&&globalThis.__metadata||function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Wg=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},qg=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Hg=ee.ERRORS,Gg=ee.COMMUNITY_SITE_URL,Kg=ot.catchErrorsDecorator,vu="analytics",Vg=["mall"];function Jg(t){if(Object.prototype.toString.call(t).slice(8,-1)!=="Object")return!1;var e=t.report_data,r=t.report_type;return!(Vg.includes(r)===!1||Object.prototype.toString.call(e).slice(8,-1)!=="Object"||e.action_time!==void 0&&!Number.isInteger(e.action_time)||typeof e.action_type!="string")}var Yg=function(){function t(){}return t.prototype.analytics=function(e){return Wg(this,void 0,void 0,function(){var r,i,o,n,a;return qg(this,function(c){if(!Jg(e))throw new Error(JSON.stringify({code:Hg.INVALID_PARAMS,msg:"["+vu+".analytics] invalid report data"}));return r="analytics.report",i=e.report_data.action_time===void 0?Math.floor(Date.now()/1e3):e.report_data.action_time,o={analytics_scene:e.report_type,analytics_data:Object.assign({},e.report_data,{action_time:i})},n={requestData:o},a=this.request,a.send(r,n),[2]})})},jg([Kg({customInfo:{className:"Cloudbase",methodName:"analytics"},title:"上报调用失败",messages:["请确认以下各项：","  1 - 调用 analytics() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Gg]}),uo("design:type",Function),uo("design:paramtypes",[Object]),uo("design:returntype",Promise)],t.prototype,"analytics",null),t}(),Xg=new Yg,mu={name:vu,entity:{analytics:Xg.analytics}};try{cloudbase.registerComponent(mu)}catch{}function zg(t){try{t.registerComponent(mu)}catch(e){console.warn(e)}}var Ht,Rt;(function(t){t.DocIDError="文档ID不合法",t.CollNameError="集合名称不合法",t.OpStrError="操作符不合法",t.DirectionError="排序字符不合法",t.IntergerError="must be integer",t.QueryParamTypeError="查询参数必须为对象",t.QueryParamValueError="查询参数对象值不能均为undefined"})(Rt||(Rt={}));var oe={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"},Qg=["desc","asc"],Zg=["<","<=","==",">=",">"],Kt;(function(t){t.lt="<",t.gt=">",t.lte="<=",t.gte=">=",t.eq="=="})(Kt||(Kt={}));Ht={},Ht[Kt.eq]="$eq",Ht[Kt.lt]="$lt",Ht[Kt.lte]="$lte",Ht[Kt.gt]="$gt",Ht[Kt.gte]="$gte";var _t;(function(t){t.WHERE="WHERE",t.DOC="DOC"})(_t||(_t={}));var ey=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),Bn=[],Zs={},ty=function(){function t(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}return t}(),_u=function(t){ey(e,t);function e(r,i){var o=this;if(i!==Zs)throw new TypeError("InternalSymbol cannot be constructed with new operator");return o=t.call(this,r)||this,o}return e.for=function(r){for(var i=0,o=Bn.length;i<o;i++)if(Bn[i].target===r)return Bn[i].instance;var n=new e(r,Zs);return Bn.push({target:r,instance:n}),n},e}(ty);const st=_u;var cn=st.for("UNSET_FIELD_NAME"),wu=st.for("UPDATE_COMMAND"),Eu=st.for("QUERY_COMMAND"),bu=st.for("LOGIC_COMMAND"),Su=st.for("GEO_POINT"),ry=st.for("SYMBOL_GEO_LINE_STRING"),ny=st.for("SYMBOL_GEO_POLYGON"),iy=st.for("SYMBOL_GEO_MULTI_POINT"),oy=st.for("SYMBOL_GEO_MULTI_LINE_STRING"),sy=st.for("SYMBOL_GEO_MULTI_POLYGON"),Au=st.for("SERVER_DATE"),Tu=st.for("REGEXP"),Iu=function(){function t(e){var r=(e===void 0?{}:e).offset,i=r===void 0?0:r;this.offset=i}return Object.defineProperty(t.prototype,"_internalType",{get:function(){return Au},enumerable:!0,configurable:!0}),t.prototype.parse=function(){return{$date:{offset:this.offset}}},t}();function ay(t){return new Iu(t)}var co=globalThis&&globalThis.__read||function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),o,n=[],a;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n},pi=function(){function t(){}return t.formatResDocumentData=function(e){return e.map(function(r){return t.formatField(r)})},t.formatField=function(e){var r=Object.keys(e),i={};return Array.isArray(e)&&(i=[]),r.forEach(function(o){var n=e[o],a=t.whichType(n),c;switch(a){case oe.GeoPoint:c=new We(n.coordinates[0],n.coordinates[1]);break;case oe.GeoLineString:c=new vt(n.coordinates.map(function(h){return new We(h[0],h[1])}));break;case oe.GeoPolygon:c=new Yt(n.coordinates.map(function(h){return new vt(h.map(function(s){var u=co(s,2),d=u[0],y=u[1];return new We(d,y)}))}));break;case oe.GeoMultiPoint:c=new Xn(n.coordinates.map(function(h){return new We(h[0],h[1])}));break;case oe.GeoMultiLineString:c=new zn(n.coordinates.map(function(h){return new vt(h.map(function(s){var u=co(s,2),d=u[0],y=u[1];return new We(d,y)}))}));break;case oe.GeoMultiPolygon:c=new fn(n.coordinates.map(function(h){return new Yt(h.map(function(s){return new vt(s.map(function(u){var d=co(u,2),y=d[0],w=d[1];return new We(y,w)}))}))}));break;case oe.Timestamp:c=new Date(n.$timestamp*1e3);break;case oe.Object:case oe.Array:c=t.formatField(n);break;case oe.ServerDate:c=new Date(n.$date);break;default:c=n}Array.isArray(i)?i.push(c):i[o]=c}),i},t.whichType=function(e){var r=Object.prototype.toString.call(e).slice(8,-1);if(r===oe.Timestamp)return oe.BsonDate;if(r===oe.Object){if(e instanceof We)return oe.GeoPoint;if(e instanceof Date)return oe.Timestamp;if(e instanceof Iu)return oe.ServerDate;e.$timestamp?r=oe.Timestamp:e.$date?r=oe.ServerDate:We.validate(e)?r=oe.GeoPoint:vt.validate(e)?r=oe.GeoLineString:Yt.validate(e)?r=oe.GeoPolygon:Xn.validate(e)?r=oe.GeoMultiPoint:zn.validate(e)?r=oe.GeoMultiLineString:fn.validate(e)&&(r=oe.GeoMultiPolygon)}return r},t.generateDocId=function(){for(var e="ABCDEFabcdef0123456789",r="",i=0;i<24;i++)r+=e.charAt(Math.floor(Math.random()*e.length));return r},t}(),Ft=function(){function t(){}return t.isGeopoint=function(e,r){if(pi.whichType(r)!==oe.Number)throw new Error("Geo Point must be number type");var i=Math.abs(r);if(e==="latitude"&&i>90)throw new Error("latitude should be a number ranges from -90 to 90");if(e==="longitude"&&i>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},t.isInteger=function(e,r){if(!Number.isInteger(r))throw new Error(e+Rt.IntergerError);return!0},t.isFieldOrder=function(e){if(Qg.indexOf(e)===-1)throw new Error(Rt.DirectionError);return!0},t.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},t.isOperator=function(e){if(Zg.indexOf(e)===-1)throw new Error(Rt.OpStrError);return!0},t.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(Rt.CollNameError);return!0},t.isDocID=function(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(Rt.DocIDError);return!0},t}(),Et=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},Dt=function(t){return Et(t)==="object"},uy=function(t){return Et(t)==="string"},nt=function(t){return Et(t)==="number"},de=function(t){return Array.isArray(t)},Ou=function(t){return Et(t)==="date"},Ko=function(t){return Et(t)==="regexp"},xu=function(t){return t&&t._internalType instanceof _u},We=function(){function t(e,r){Ft.isGeopoint("longitude",e),Ft.isGeopoint("latitude",r),this.longitude=e,this.latitude=r}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Point",coordinates:[this.longitude,this.latitude]},r},t.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},t.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},t.validate=function(e){return e.type==="Point"&&de(e.coordinates)&&Ft.isGeopoint("longitude",e.coordinates[0])&&Ft.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return Su},enumerable:!0,configurable:!0}),t}(),cy=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vt=function(){function t(e){if(!de(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach(function(r){if(!(r instanceof We))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"LineString",coordinates:this.points.map(function(i){return i.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,i;if(e.type!=="LineString"||!de(e.coordinates))return!1;try{for(var o=cy(e.coordinates),n=o.next();!n.done;n=o.next()){var a=n.value;if(!nt(a[0])||!nt(a[1]))return!1}}catch(c){r={error:c}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return!0},t.isClosed=function(e){var r=e.points[0],i=e.points[e.points.length-1];if(r.latitude===i.latitude&&r.longitude===i.longitude)return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return ry},enumerable:!0,configurable:!0}),t}(),ea=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Yt=function(){function t(e){if(!de(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof vt))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]");if(!vt.isClosed(r))throw new Error("LineString "+r.points.map(function(i){return i.toReadableString()})+" is not a closed cycle")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Polygon",coordinates:this.lines.map(function(i){return i.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,i,o,n;if(e.type!=="Polygon"||!de(e.coordinates))return!1;try{for(var a=ea(e.coordinates),c=a.next();!c.done;c=a.next()){var h=c.value;if(!this.isCloseLineString(h))return!1;try{for(var s=(o=void 0,ea(h)),u=s.next();!u.done;u=s.next()){var d=u.value;if(!nt(d[0])||!nt(d[1]))return!1}}catch(y){o={error:y}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}}}catch(y){r={error:y}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return!0},t.isCloseLineString=function(e){var r=e[0],i=e[e.length-1];return!(r[0]!==i[0]||r[1]!==i[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return sy},enumerable:!0,configurable:!0}),t}(),fy=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Xn=function(){function t(e){if(!de(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length===0)throw new Error('"points" must contain 1 point at least');e.forEach(function(r){if(!(r instanceof We))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPoint",coordinates:this.points.map(function(i){return i.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,i;if(e.type!=="MultiPoint"||!de(e.coordinates))return!1;try{for(var o=fy(e.coordinates),n=o.next();!n.done;n=o.next()){var a=n.value;if(!nt(a[0])||!nt(a[1]))return!1}}catch(c){r={error:c}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return iy},enumerable:!0,configurable:!0}),t}(),ta=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zn=function(){function t(e){if(!de(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof vt))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiLineString",coordinates:this.lines.map(function(i){return i.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,i,o,n;if(e.type!=="MultiLineString"||!de(e.coordinates))return!1;try{for(var a=ta(e.coordinates),c=a.next();!c.done;c=a.next()){var h=c.value;try{for(var s=(o=void 0,ta(h)),u=s.next();!u.done;u=s.next()){var d=u.value;if(!nt(d[0])||!nt(d[1]))return!1}}catch(y){o={error:y}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}}}catch(y){r={error:y}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return oy},enumerable:!0,configurable:!0}),t}(),Dn=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},fn=function(){function t(e){var r,i;if(!de(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof e);if(e.length===0)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var o=Dn(e),n=o.next();!n.done;n=o.next()){var a=n.value;if(!(a instanceof Yt))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof a+"[]")}}catch(c){r={error:c}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}this.polygons=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPolygon",coordinates:this.polygons.map(function(i){return i.lines.map(function(o){return o.points.map(function(n){return[n.longitude,n.latitude]})})})},r},t.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map(function(e){return e.lines.map(function(r){return r.points.map(function(i){return[i.longitude,i.latitude]})})})}},t.validate=function(e){var r,i,o,n,a,c;if(e.type!=="MultiPolygon"||!de(e.coordinates))return!1;try{for(var h=Dn(e.coordinates),s=h.next();!s.done;s=h.next()){var u=s.value;try{for(var d=(o=void 0,Dn(u)),y=d.next();!y.done;y=d.next()){var w=y.value;try{for(var E=(a=void 0,Dn(w)),A=E.next();!A.done;A=E.next()){var m=A.value;if(!nt(m[0])||!nt(m[1]))return!1}}catch(_){a={error:_}}finally{try{A&&!A.done&&(c=E.return)&&c.call(E)}finally{if(a)throw a.error}}}}catch(_){o={error:_}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(o)throw o.error}}}}catch(_){r={error:_}}finally{try{s&&!s.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return ny},enumerable:!0,configurable:!0}),t}();const ly=Object.freeze(Object.defineProperty({__proto__:null,LineString:vt,MultiLineString:zn,MultiPoint:Xn,MultiPolygon:fn,Point:We,Polygon:Yt},Symbol.toStringTag,{value:"Module"}));var Ct=function(){var t;if(!Promise){t=function(){},t.promise={};var e=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(t.promise,"then",{get:e}),Object.defineProperty(t.promise,"catch",{get:e}),t}var r=new Promise(function(i,o){t=function(n,a){return n?o(n):i(a)}});return t.promise=r,t},K;(function(t){t.SET="set",t.REMOVE="remove",t.INC="inc",t.MUL="mul",t.PUSH="push",t.PULL="pull",t.PULL_ALL="pullAll",t.POP="pop",t.SHIFT="shift",t.UNSHIFT="unshift",t.ADD_TO_SET="addToSet",t.BIT="bit",t.RENAME="rename",t.MAX="max",t.MIN="min"})(K||(K={}));var ge=function(){function t(e,r,i){this._internalType=wu,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=i||cn}return t.prototype._setFieldName=function(e){var r=new t(this.operator,this.operands,e);return r},t}();function ra(t){return t&&t instanceof ge&&t._internalType===wu}var He;(function(t){t.AND="and",t.OR="or",t.NOT="not",t.NOR="nor"})(He||(He={}));var Jt=function(){function t(e,r,i){if(this._internalType=bu,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=i||cn,this.fieldName!==cn)if(Array.isArray(r)){r=r.slice(),this.operands=r;for(var o=0,n=r.length;o<n;o++){var a=r[o];(Qn(a)||Zn(a))&&(r[o]=a._setFieldName(this.fieldName))}}else{var a=r;(Qn(a)||Zn(a))&&(r=a._setFieldName(this.fieldName))}}return t.prototype._setFieldName=function(e){var r=this.operands.map(function(o){return o instanceof t?o._setFieldName(e):o}),i=new t(this.operator,r,e);return i},t.prototype.and=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(He.AND,e,this.fieldName)},t.prototype.or=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(He.OR,e,this.fieldName)},t}();function Qn(t){return t&&t instanceof Jt&&t._internalType===bu}var hy=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),H;(function(t){t.EQ="eq",t.NEQ="neq",t.GT="gt",t.GTE="gte",t.LT="lt",t.LTE="lte",t.IN="in",t.NIN="nin",t.ALL="all",t.ELEM_MATCH="elemMatch",t.EXISTS="exists",t.SIZE="size",t.MOD="mod",t.GEO_NEAR="geoNear",t.GEO_WITHIN="geoWithin",t.GEO_INTERSECTS="geoIntersects"})(H||(H={}));var we=function(t){hy(e,t);function e(r,i,o){var n=t.call(this,r,i,o)||this;return n.operator=r,n._internalType=Eu,n}return e.prototype.toJSON=function(){var r,i;switch(this.operator){case H.IN:case H.NIN:return r={},r["$"+this.operator]=this.operands,r;default:return i={},i["$"+this.operator]=this.operands[0],i}},e.prototype._setFieldName=function(r){var i=new e(this.operator,this.operands,r);return i},e.prototype.eq=function(r){var i=new e(H.EQ,[r],this.fieldName);return this.and(i)},e.prototype.neq=function(r){var i=new e(H.NEQ,[r],this.fieldName);return this.and(i)},e.prototype.gt=function(r){var i=new e(H.GT,[r],this.fieldName);return this.and(i)},e.prototype.gte=function(r){var i=new e(H.GTE,[r],this.fieldName);return this.and(i)},e.prototype.lt=function(r){var i=new e(H.LT,[r],this.fieldName);return this.and(i)},e.prototype.lte=function(r){var i=new e(H.LTE,[r],this.fieldName);return this.and(i)},e.prototype.in=function(r){var i=new e(H.IN,r,this.fieldName);return this.and(i)},e.prototype.nin=function(r){var i=new e(H.NIN,r,this.fieldName);return this.and(i)},e.prototype.geoNear=function(r){if(!(r.geometry instanceof We))throw new TypeError('"geometry" must be of type Point. Received type '+typeof r.geometry);if(r.maxDistance!==void 0&&!nt(r.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof r.maxDistance);if(r.minDistance!==void 0&&!nt(r.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof r.minDistance);var i=new e(H.GEO_NEAR,[r],this.fieldName);return this.and(i)},e.prototype.geoWithin=function(r){if(!(r.geometry instanceof fn)&&!(r.geometry instanceof Yt))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof r.geometry);var i=new e(H.GEO_WITHIN,[r],this.fieldName);return this.and(i)},e.prototype.geoIntersects=function(r){if(!(r.geometry instanceof We)&&!(r.geometry instanceof vt)&&!(r.geometry instanceof Yt)&&!(r.geometry instanceof Xn)&&!(r.geometry instanceof zn)&&!(r.geometry instanceof fn))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof r.geometry);var i=new e(H.GEO_INTERSECTS,[r],this.fieldName);return this.and(i)},e}(Jt);function Zn(t){return t&&t instanceof we&&t._internalType===Eu}function na(t){return Zn(t)}var Ut={};for(var Lt in H)Ut[Lt]="$"+Lt;for(var Lt in He)Ut[Lt]="$"+Lt;for(var Lt in K)Ut[Lt]="$"+Lt;Ut[H.NEQ]="$ne";Ut[K.REMOVE]="$unset";Ut[K.SHIFT]="$pop";Ut[K.UNSHIFT]="$push";function yr(t){return Ut[t]||"$"+t}var xo=globalThis&&globalThis.__assign||function(){return xo=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},xo.apply(this,arguments)},dy=globalThis&&globalThis.__read||function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),o,n=[],a;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n},ia=globalThis&&globalThis.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(dy(arguments[e]));return t};function ln(t){return No(t,[t])}function No(t,e){if(xu(t))switch(t._internalType){case Su:return t.toJSON();case Au:return t.parse();case Tu:return t.parse();default:return t.toJSON?t.toJSON():t}else{if(Ou(t))return{$date:+t};if(Ko(t))return{$regex:t.source,$options:t.flags};if(de(t))return t.map(function(o){if(e.indexOf(o)>-1)throw new Error("Cannot convert circular structure to JSON");return No(o,ia(e,[o]))});if(Dt(t)){var r=xo({},t);for(var i in r){if(e.indexOf(r[i])>-1)throw new Error("Cannot convert circular structure to JSON");r[i]=No(r[i],ia(e,[r[i]]))}return r}else return t}}var Ro=globalThis&&globalThis.__assign||function(){return Ro=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ro.apply(this,arguments)},py=globalThis&&globalThis.__read||function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),o,n=[],a;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n},oa=globalThis&&globalThis.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(py(arguments[e]));return t};function Nu(t,e,r,i){var o=Ro({},t);for(var n in t)if(!/^\$/.test(n)){var a=t[n];if(a&&Dt(a)&&!e(a)){if(i.indexOf(a)>-1)throw new Error("Cannot convert circular structure to JSON");var c=oa(r,[n]),h=oa(i,[a]),s=Nu(a,e,c,h);o[n]=s;var u=!1;for(var d in s)/^\$/.test(d)?u=!0:(o[n+"."+d]=s[d],delete o[n][d]);u||delete o[n]}}return o}function Ru(t){return Nu(t,Co,[],[t])}function sa(t,e,r){e[r]||delete t[r];for(var i in e)t[i]?de(t[i])?t[i].push(e[i]):Dt(t[i])?Dt(e[i])?Object.assign(t[i],e[i]):(console.warn("unmergable condition, query is object but condition is "+Et(e)+", can only overwrite",e,r),t[i]=e[i]):(console.warn("to-merge query is of type "+Et(t)+", can only overwrite",t,e,r),t[i]=e[i]):t[i]=e[i]}function Co(t){return xu(t)||Ou(t)||Ko(t)}function Bt(t){return ln(t)}var Vo=function(){function t(){}return t.encode=function(e){var r=new t;return r.encodeUpdate(e)},t.prototype.encodeUpdate=function(e){return ra(e)?this.encodeUpdateCommand(e):Et(e)==="object"?this.encodeUpdateObject(e):e},t.prototype.encodeUpdateCommand=function(e){if(e.fieldName===cn)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case K.PUSH:case K.PULL:case K.PULL_ALL:case K.POP:case K.SHIFT:case K.UNSHIFT:case K.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},t.prototype.encodeFieldUpdateCommand=function(e){var r,i,o,n,a=yr(e.operator);switch(e.operator){case K.REMOVE:return r={},r[a]=(i={},i[e.fieldName]="",i),r;default:return o={},o[a]=(n={},n[e.fieldName]=e.operands[0],n),o}},t.prototype.encodeArrayUpdateCommand=function(e){var r,i,o,n,a,c,h,s,u,d,y=yr(e.operator);switch(e.operator){case K.PUSH:{var w=void 0;return de(e.operands)?w={$each:e.operands.map(Bt)}:w=e.operands,r={},r[y]=(i={},i[e.fieldName]=w,i),r}case K.UNSHIFT:{var w={$each:e.operands.map(Bt),$position:0};return o={},o[y]=(n={},n[e.fieldName]=w,n),o}case K.POP:return a={},a[y]=(c={},c[e.fieldName]=1,c),a;case K.SHIFT:return h={},h[y]=(s={},s[e.fieldName]=-1,s),h;default:return u={},u[y]=(d={},d[e.fieldName]=Bt(e.operands),d),u}},t.prototype.encodeUpdateObject=function(e){var r=Ru(e);for(var i in r)if(!/^\$/.test(i)){var o=r[i];if(ra(o)){r[i]=o._setFieldName(i);var n=this.encodeUpdateCommand(r[i]);sa(r,n,i)}else{r[i]=o=Bt(o);var a=new ge(K.SET,[o],i),n=this.encodeUpdateCommand(a);sa(r,n,i)}}return r},t}(),fo={};function Cu(t){if(!Be.wsClientClass)throw new Error("to use realtime you must import realtime module first");var e=t.config.env;return fo[e]||(fo[e]=new Be.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new Be.reqClass(t.config)}}})),fo[e]}var ei=globalThis&&globalThis.__assign||function(){return ei=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ei.apply(this,arguments)},aa=function(){function t(e,r,i,o){var n=this;o===void 0&&(o={}),this.watch=function(a){var c=Cu(n._db);return c.watch(ei(ei({},a),{envId:n._db.config.env,collectionName:n._coll,query:JSON.stringify({_id:n.id})}))},this._db=e,this._coll=r,this.id=i,this.request=new Be.reqClass(this._db.config),this.projection=o}return t.prototype.create=function(e,r){r=r||Ct();var i={collectionName:this._coll,data:ln(e)};return this.id&&(i._id=this.id),this.request.send("database.addDocument",i).then(function(o){o.code?r(0,o):r(0,{id:o.data._id,requestId:o.requestId})}).catch(function(o){r(o)}),r.promise},t.prototype.set=function(e,r){if(r=r||Ct(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var i=!1,o=function(c){if(typeof c=="object")for(var h in c)c[h]instanceof ge?i=!0:typeof c[h]=="object"&&o(c[h])};if(o(e),i)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var n=!1,a={collectionName:this._coll,queryType:_t.DOC,data:ln(e),multi:!1,merge:n,upsert:!0};return this.id&&(a.query={_id:this.id}),this.request.send("database.updateDocument",a).then(function(c){c.code?r(0,c):r(0,{updated:c.data.updated,upsertedId:c.data.upserted_id,requestId:c.requestId})}).catch(function(c){r(c)}),r.promise},t.prototype.update=function(e,r){if(r=r||Ct(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var i={_id:this.id},o=!0,n={collectionName:this._coll,data:Vo.encode(e),query:i,queryType:_t.DOC,multi:!1,merge:o,upsert:!1};return this.request.send("database.updateDocument",n).then(function(a){a.code?r(0,a):r(0,{updated:a.data.updated,upsertedId:a.data.upserted_id,requestId:a.requestId})}).catch(function(a){r(a)}),r.promise},t.prototype.remove=function(e){e=e||Ct();var r={_id:this.id},i={collectionName:this._coll,query:r,queryType:_t.DOC,multi:!1};return this.request.send("database.deleteDocument",i).then(function(o){o.code?e(0,o):e(0,{deleted:o.data.deleted,requestId:o.requestId})}).catch(function(o){e(o)}),e.promise},t.prototype.get=function(e){e=e||Ct();var r={_id:this.id},i={collectionName:this._coll,query:r,queryType:_t.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",i).then(function(o){if(o.code)e(0,o);else{var n=pi.formatResDocumentData(o.data.list);e(0,{data:n,requestId:o.requestId,total:o.TotalCount,limit:o.Limit,offset:o.Offset})}}).catch(function(o){e(o)}),e.promise},t.prototype.field=function(e){for(var r in e)e[r]?e[r]=1:e[r]=0;return new t(this._db,this._coll,this.id,e)},t}(),Po=function(){function t(){}return t.encode=function(e){var r=new gy;return r.encodeQuery(e)},t}(),gy=function(){function t(){}return t.prototype.encodeQuery=function(e,r){var i;return Co(e)?Qn(e)?this.encodeLogicCommand(e):Zn(e)?this.encodeQueryCommand(e):(i={},i[r]=this.encodeQueryObject(e),i):Dt(e)?this.encodeQueryObject(e):e},t.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},t.prototype.encodeLogicCommand=function(e){var r,i,o,n,a,c,h,s=this;switch(e.operator){case He.NOR:case He.AND:case He.OR:{var u=yr(e.operator),d=e.operands.map(function(E){return s.encodeQuery(E,e.fieldName)});return r={},r[u]=d,r}case He.NOT:{var u=yr(e.operator),y=e.operands[0];if(Ko(y))return i={},i[e.fieldName]=(o={},o[u]=this.encodeRegExp(y),o),i;var d=this.encodeQuery(y)[e.fieldName];return n={},n[e.fieldName]=(a={},a[u]=d,a),n}default:{var u=yr(e.operator);if(e.operands.length===1){var w=this.encodeQuery(e.operands[0]);return c={},c[u]=w,c}else{var d=e.operands.map(this.encodeQuery.bind(this));return h={},h[u]=d,h}}}},t.prototype.encodeQueryCommand=function(e){return na(e)?this.encodeComparisonCommand(e):this.encodeComparisonCommand(e)},t.prototype.encodeComparisonCommand=function(e){var r,i,o,n,a,c,h,s,u;if(e.fieldName===cn)throw new Error("Cannot encode a comparison command with unset field name");var d=yr(e.operator);switch(e.operator){case H.EQ:case H.NEQ:case H.LT:case H.LTE:case H.GT:case H.GTE:case H.ELEM_MATCH:case H.EXISTS:case H.SIZE:case H.MOD:return r={},r[e.fieldName]=(i={},i[d]=Bt(e.operands[0]),i),r;case H.IN:case H.NIN:case H.ALL:return o={},o[e.fieldName]=(n={},n[d]=Bt(e.operands),n),o;case H.GEO_NEAR:{var y=e.operands[0];return a={},a[e.fieldName]={$nearSphere:{$geometry:y.geometry.toJSON(),$maxDistance:y.maxDistance,$minDistance:y.minDistance}},a}case H.GEO_WITHIN:{var y=e.operands[0];return c={},c[e.fieldName]={$geoWithin:{$geometry:y.geometry.toJSON()}},c}case H.GEO_INTERSECTS:{var y=e.operands[0];return h={},h[e.fieldName]={$geoIntersects:{$geometry:y.geometry.toJSON()}},h}default:return s={},s[e.fieldName]=(u={},u[d]=Bt(e.operands[0]),u),s}},t.prototype.encodeQueryObject=function(e){var r=Ru(e);for(var i in r){var o=r[i];if(Qn(o)){r[i]=o._setFieldName(i);var n=this.encodeLogicCommand(r[i]);this.mergeConditionAfterEncode(r,n,i)}else if(na(o)){r[i]=o._setFieldName(i);var n=this.encodeComparisonCommand(r[i]);this.mergeConditionAfterEncode(r,n,i)}else Co(o)&&(r[i]=Bt(o))}return r},t.prototype.mergeConditionAfterEncode=function(e,r,i){r[i]||delete e[i];for(var o in r)e[o]?de(e[o])?e[o]=e[o].concat(r[o]):Dt(e[o])?Dt(r[o])?Object.assign(e,r):(console.warn("unmergable condition, query is object but condition is "+Et(r)+", can only overwrite",r,i),e[o]=r[o]):(console.warn("to-merge query is of type "+Et(e)+", can only overwrite",e,r,i),e[o]=r[o]):e[o]=r[o]},t}(),Vt=globalThis&&globalThis.__assign||function(){return Vt=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Vt.apply(this,arguments)},yy=function(){function t(e,r,i,o,n){var a=this;this.watch=function(c){var h=Cu(a._db);return h.watch(Vt(Vt({},c),{envId:a._db.config.env,collectionName:a._coll,query:JSON.stringify(a._fieldFilters||{}),limit:a._queryOptions.limit,orderBy:a._fieldOrders?a._fieldOrders.reduce(function(s,u){return s[u.field]=u.direction,s},{}):void 0}))},this._db=e,this._coll=r,this._fieldFilters=i,this._fieldOrders=o||[],this._queryOptions=n||{},this._request=new Be.reqClass(this._db.config)}return t.prototype.get=function(e){e=e||Ct();var r=[];this._fieldOrders&&this._fieldOrders.forEach(function(o){r.push(o)});var i={collectionName:this._coll,queryType:_t.WHERE};return this._fieldFilters&&(i.query=this._fieldFilters),r.length>0&&(i.order=r),this._queryOptions.offset&&(i.offset=this._queryOptions.offset),this._queryOptions.limit?i.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:i.limit=100,this._queryOptions.projection&&(i.projection=this._queryOptions.projection),this._request.send("database.queryDocument",i).then(function(o){if(o.code)e(0,o);else{var n=pi.formatResDocumentData(o.data.list),a={data:n,requestId:o.requestId};o.TotalCount&&(a.total=o.TotalCount),o.Limit&&(a.limit=o.Limit),o.Offset&&(a.offset=o.Offset),e(0,a)}}).catch(function(o){e(o)}),e.promise},t.prototype.count=function(e){e=e||Ct();var r={collectionName:this._coll,queryType:_t.WHERE};return this._fieldFilters&&(r.query=this._fieldFilters),this._request.send("database.countDocument",r).then(function(i){i.code?e(0,i):e(0,{requestId:i.requestId,total:i.data.total})}).catch(function(i){e(i)}),e.promise},t.prototype.where=function(e){if(Object.prototype.toString.call(e).slice(8,-1)!=="Object")throw Error(Rt.QueryParamTypeError);var r=Object.keys(e),i=r.some(function(o){return e[o]!==void 0});if(r.length&&!i)throw Error(Rt.QueryParamValueError);return new t(this._db,this._coll,Po.encode(e),this._fieldOrders,this._queryOptions)},t.prototype.orderBy=function(e,r){Ft.isFieldPath(e),Ft.isFieldOrder(r);var i={field:e,direction:r},o=this._fieldOrders.concat(i);return new t(this._db,this._coll,this._fieldFilters,o,this._queryOptions)},t.prototype.limit=function(e){Ft.isInteger("limit",e);var r=Vt({},this._queryOptions);return r.limit=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.skip=function(e){Ft.isInteger("offset",e);var r=Vt({},this._queryOptions);return r.offset=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.update=function(e,r){if(r=r||Ct(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var i={collectionName:this._coll,query:this._fieldFilters,queryType:_t.WHERE,multi:!0,merge:!0,upsert:!1,data:Vo.encode(e)};return this._request.send("database.updateDocument",i).then(function(o){o.code?r(0,o):r(0,{requestId:o.requestId,updated:o.data.updated,upsertId:o.data.upsert_id})}).catch(function(o){r(o)}),r.promise},t.prototype.field=function(e){for(var r in e)e[r]?typeof e[r]!="object"&&(e[r]=1):e[r]=0;var i=Vt({},this._queryOptions);return i.projection=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,i)},t.prototype.remove=function(e){e=e||Ct(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");var r={collectionName:this._coll,query:Po.encode(this._fieldFilters),queryType:_t.WHERE,multi:!0};return this._request.send("database.deleteDocument",r).then(function(i){i.code?e(0,i):e(0,{requestId:i.requestId,deleted:i.data.deleted})}).catch(function(i){e(i)}),e.promise},t}();function vy(t,e){return e={exports:{}},t(e,e.exports),e.exports}var my=Sy,_y=Ty,wy=xy,mt=[],et=[],Ey=typeof Uint8Array<"u"?Uint8Array:Array,lo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var fr=0,by=lo.length;fr<by;++fr)mt[fr]=lo[fr],et[lo.charCodeAt(fr)]=fr;et["-".charCodeAt(0)]=62;et["_".charCodeAt(0)]=63;function Pu(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var i=r===e?0:4-r%4;return[r,i]}function Sy(t){var e=Pu(t),r=e[0],i=e[1];return(r+i)*3/4-i}function Ay(t,e,r){return(e+r)*3/4-r}function Ty(t){var e,r=Pu(t),i=r[0],o=r[1],n=new Ey(Ay(t,i,o)),a=0,c=o>0?i-4:i,h;for(h=0;h<c;h+=4)e=et[t.charCodeAt(h)]<<18|et[t.charCodeAt(h+1)]<<12|et[t.charCodeAt(h+2)]<<6|et[t.charCodeAt(h+3)],n[a++]=e>>16&255,n[a++]=e>>8&255,n[a++]=e&255;return o===2&&(e=et[t.charCodeAt(h)]<<2|et[t.charCodeAt(h+1)]>>4,n[a++]=e&255),o===1&&(e=et[t.charCodeAt(h)]<<10|et[t.charCodeAt(h+1)]<<4|et[t.charCodeAt(h+2)]>>2,n[a++]=e>>8&255,n[a++]=e&255),n}function Iy(t){return mt[t>>18&63]+mt[t>>12&63]+mt[t>>6&63]+mt[t&63]}function Oy(t,e,r){for(var i,o=[],n=e;n<r;n+=3)i=(t[n]<<16&16711680)+(t[n+1]<<8&65280)+(t[n+2]&255),o.push(Iy(i));return o.join("")}function xy(t){for(var e,r=t.length,i=r%3,o=[],n=16383,a=0,c=r-i;a<c;a+=n)o.push(Oy(t,a,a+n>c?c:a+n));return i===1?(e=t[r-1],o.push(mt[e>>2]+mt[e<<4&63]+"==")):i===2&&(e=(t[r-2]<<8)+t[r-1],o.push(mt[e>>10]+mt[e>>4&63]+mt[e<<2&63]+"=")),o.join("")}var ho={byteLength:my,toByteArray:_y,fromByteArray:wy};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Ny=function(e,r,i,o,n){var a,c,h=n*8-o-1,s=(1<<h)-1,u=s>>1,d=-7,y=i?n-1:0,w=i?-1:1,E=e[r+y];for(y+=w,a=E&(1<<-d)-1,E>>=-d,d+=h;d>0;a=a*256+e[r+y],y+=w,d-=8);for(c=a&(1<<-d)-1,a>>=-d,d+=o;d>0;c=c*256+e[r+y],y+=w,d-=8);if(a===0)a=1-u;else{if(a===s)return c?NaN:(E?-1:1)*(1/0);c=c+Math.pow(2,o),a=a-u}return(E?-1:1)*c*Math.pow(2,a-o)},Ry=function(e,r,i,o,n,a){var c,h,s,u=a*8-n-1,d=(1<<u)-1,y=d>>1,w=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=o?0:a-1,A=o?1:-1,m=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(h=isNaN(r)?1:0,c=d):(c=Math.floor(Math.log(r)/Math.LN2),r*(s=Math.pow(2,-c))<1&&(c--,s*=2),c+y>=1?r+=w/s:r+=w*Math.pow(2,1-y),r*s>=2&&(c++,s/=2),c+y>=d?(h=0,c=d):c+y>=1?(h=(r*s-1)*Math.pow(2,n),c=c+y):(h=r*Math.pow(2,y-1)*Math.pow(2,n),c=0));n>=8;e[i+E]=h&255,E+=A,h/=256,n-=8);for(c=c<<n|h,u+=n;u>0;e[i+E]=c&255,E+=A,c/=256,u-=8);e[i+E-A]|=m*128},lr={read:Ny,write:Ry},gi=vy(function(t,e){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=_,e.INSPECT_MAX_BYTES=50;var i=2147483647;e.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{var g=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(g,f),g.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function n(g){if(g>i)throw new RangeError('The value "'+g+'" is invalid for option "size"');var f=new Uint8Array(g);return Object.setPrototypeOf(f,a.prototype),f}function a(g,f,l){if(typeof g=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return u(g)}return c(g,f,l)}a.poolSize=8192;function c(g,f,l){if(typeof g=="string")return d(g,f);if(ArrayBuffer.isView(g))return w(g);if(g==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(g));if(Ke(g,ArrayBuffer)||g&&Ke(g.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ke(g,SharedArrayBuffer)||g&&Ke(g.buffer,SharedArrayBuffer)))return E(g,f,l);if(typeof g=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var v=g.valueOf&&g.valueOf();if(v!=null&&v!==g)return a.from(v,f,l);var b=A(g);if(b)return b;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof g[Symbol.toPrimitive]=="function")return a.from(g[Symbol.toPrimitive]("string"),f,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(g))}a.from=function(g,f,l){return c(g,f,l)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function h(g){if(typeof g!="number")throw new TypeError('"size" argument must be of type number');if(g<0)throw new RangeError('The value "'+g+'" is invalid for option "size"')}function s(g,f,l){return h(g),g<=0?n(g):f!==void 0?typeof l=="string"?n(g).fill(f,l):n(g).fill(f):n(g)}a.alloc=function(g,f,l){return s(g,f,l)};function u(g){return h(g),n(g<0?0:m(g)|0)}a.allocUnsafe=function(g){return u(g)},a.allocUnsafeSlow=function(g){return u(g)};function d(g,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError("Unknown encoding: "+f);var l=x(g,f)|0,v=n(l),b=v.write(g,f);return b!==l&&(v=v.slice(0,b)),v}function y(g){for(var f=g.length<0?0:m(g.length)|0,l=n(f),v=0;v<f;v+=1)l[v]=g[v]&255;return l}function w(g){if(Ke(g,Uint8Array)){var f=new Uint8Array(g);return E(f.buffer,f.byteOffset,f.byteLength)}return y(g)}function E(g,f,l){if(f<0||g.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(g.byteLength<f+(l||0))throw new RangeError('"length" is outside of buffer bounds');var v;return f===void 0&&l===void 0?v=new Uint8Array(g):l===void 0?v=new Uint8Array(g,f):v=new Uint8Array(g,f,l),Object.setPrototypeOf(v,a.prototype),v}function A(g){if(a.isBuffer(g)){var f=m(g.length)|0,l=n(f);return l.length===0||g.copy(l,0,0,f),l}if(g.length!==void 0)return typeof g.length!="number"||xr(g.length)?n(0):y(g);if(g.type==="Buffer"&&Array.isArray(g.data))return y(g.data)}function m(g){if(g>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return g|0}function _(g){return+g!=g&&(g=0),a.alloc(+g)}a.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==a.prototype},a.compare=function(f,l){if(Ke(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),Ke(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),!a.isBuffer(f)||!a.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===l)return 0;for(var v=f.length,b=l.length,N=0,C=Math.min(v,b);N<C;++N)if(f[N]!==l[N]){v=f[N],b=l[N];break}return v<b?-1:b<v?1:0},a.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(f,l){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return a.alloc(0);var v;if(l===void 0)for(l=0,v=0;v<f.length;++v)l+=f[v].length;var b=a.allocUnsafe(l),N=0;for(v=0;v<f.length;++v){var C=f[v];if(Ke(C,Uint8Array))N+C.length>b.length?a.from(C).copy(b,N):Uint8Array.prototype.set.call(b,C,N);else if(a.isBuffer(C))C.copy(b,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=C.length}return b};function x(g,f){if(a.isBuffer(g))return g.length;if(ArrayBuffer.isView(g)||Ke(g,ArrayBuffer))return g.byteLength;if(typeof g!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(g));var l=g.length,v=arguments.length>2&&arguments[2]===!0;if(!v&&l===0)return 0;for(var b=!1;;)switch(f){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return Or(g).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return _n(g).length;default:if(b)return v?-1:Or(g).length;f=(""+f).toLowerCase(),b=!0}}a.byteLength=x;function I(g,f,l){var v=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,f>>>=0,l<=f))return"";for(g||(g="utf8");;)switch(g){case"hex":return Re(this,f,l);case"utf8":case"utf-8":return Y(this,f,l);case"ascii":return ft(this,f,l);case"latin1":case"binary":return re(this,f,l);case"base64":return ye(this,f,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,f,l);default:if(v)throw new TypeError("Unknown encoding: "+g);g=(g+"").toLowerCase(),v=!0}}a.prototype._isBuffer=!0;function T(g,f,l){var v=g[f];g[f]=g[l],g[l]=v}a.prototype.swap16=function(){var f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var l=0;l<f;l+=2)T(this,l,l+1);return this},a.prototype.swap32=function(){var f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var l=0;l<f;l+=4)T(this,l,l+3),T(this,l+1,l+2);return this},a.prototype.swap64=function(){var f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var l=0;l<f;l+=8)T(this,l,l+7),T(this,l+1,l+6),T(this,l+2,l+5),T(this,l+3,l+4);return this},a.prototype.toString=function(){var f=this.length;return f===0?"":arguments.length===0?Y(this,0,f):I.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(f){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:a.compare(this,f)===0},a.prototype.inspect=function(){var f="",l=e.INSPECT_MAX_BYTES;return f=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(f+=" ... "),"<Buffer "+f+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(f,l,v,b,N){if(Ke(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(f));if(l===void 0&&(l=0),v===void 0&&(v=f?f.length:0),b===void 0&&(b=0),N===void 0&&(N=this.length),l<0||v>f.length||b<0||N>this.length)throw new RangeError("out of range index");if(b>=N&&l>=v)return 0;if(b>=N)return-1;if(l>=v)return 1;if(l>>>=0,v>>>=0,b>>>=0,N>>>=0,this===f)return 0;for(var C=N-b,G=v-l,z=Math.min(C,G),J=this.slice(b,N),le=f.slice(l,v),se=0;se<z;++se)if(J[se]!==le[se]){C=J[se],G=le[se];break}return C<G?-1:G<C?1:0};function F(g,f,l,v,b){if(g.length===0)return-1;if(typeof l=="string"?(v=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,xr(l)&&(l=b?0:g.length-1),l<0&&(l=g.length+l),l>=g.length){if(b)return-1;l=g.length-1}else if(l<0)if(b)l=0;else return-1;if(typeof f=="string"&&(f=a.from(f,v)),a.isBuffer(f))return f.length===0?-1:R(g,f,l,v,b);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?b?Uint8Array.prototype.indexOf.call(g,f,l):Uint8Array.prototype.lastIndexOf.call(g,f,l):R(g,[f],l,v,b);throw new TypeError("val must be string, number or Buffer")}function R(g,f,l,v,b){var N=1,C=g.length,G=f.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(g.length<2||f.length<2)return-1;N=2,C/=2,G/=2,l/=2}function z(Nr,Rr){return N===1?Nr[Rr]:Nr.readUInt16BE(Rr*N)}var J;if(b){var le=-1;for(J=l;J<C;J++)if(z(g,J)===z(f,le===-1?0:J-le)){if(le===-1&&(le=J),J-le+1===G)return le*N}else le!==-1&&(J-=J-le),le=-1}else for(l+G>C&&(l=C-G),J=l;J>=0;J--){for(var se=!0,kt=0;kt<G;kt++)if(z(g,J+kt)!==z(f,kt)){se=!1;break}if(se)return J}return-1}a.prototype.includes=function(f,l,v){return this.indexOf(f,l,v)!==-1},a.prototype.indexOf=function(f,l,v){return F(this,f,l,v,!0)},a.prototype.lastIndexOf=function(f,l,v){return F(this,f,l,v,!1)};function L(g,f,l,v){l=Number(l)||0;var b=g.length-l;v?(v=Number(v),v>b&&(v=b)):v=b;var N=f.length;v>N/2&&(v=N/2);for(var C=0;C<v;++C){var G=parseInt(f.substr(C*2,2),16);if(xr(G))return C;g[l+C]=G}return C}function k(g,f,l,v){return Mt(Or(f,g.length-l),g,l,v)}function B(g,f,l,v){return Mt(bi(f),g,l,v)}function ue(g,f,l,v){return Mt(_n(f),g,l,v)}function fe(g,f,l,v){return Mt(Si(f,g.length-l),g,l,v)}a.prototype.write=function(f,l,v,b){if(l===void 0)b="utf8",v=this.length,l=0;else if(v===void 0&&typeof l=="string")b=l,v=this.length,l=0;else if(isFinite(l))l=l>>>0,isFinite(v)?(v=v>>>0,b===void 0&&(b="utf8")):(b=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var N=this.length-l;if((v===void 0||v>N)&&(v=N),f.length>0&&(v<0||l<0)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");b||(b="utf8");for(var C=!1;;)switch(b){case"hex":return L(this,f,l,v);case"utf8":case"utf-8":return k(this,f,l,v);case"ascii":case"latin1":case"binary":return B(this,f,l,v);case"base64":return ue(this,f,l,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fe(this,f,l,v);default:if(C)throw new TypeError("Unknown encoding: "+b);b=(""+b).toLowerCase(),C=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ye(g,f,l){return f===0&&l===g.length?ho.fromByteArray(g):ho.fromByteArray(g.slice(f,l))}function Y(g,f,l){l=Math.min(g.length,l);for(var v=[],b=f;b<l;){var N=g[b],C=null,G=N>239?4:N>223?3:N>191?2:1;if(b+G<=l){var z,J,le,se;switch(G){case 1:N<128&&(C=N);break;case 2:z=g[b+1],(z&192)===128&&(se=(N&31)<<6|z&63,se>127&&(C=se));break;case 3:z=g[b+1],J=g[b+2],(z&192)===128&&(J&192)===128&&(se=(N&15)<<12|(z&63)<<6|J&63,se>2047&&(se<55296||se>57343)&&(C=se));break;case 4:z=g[b+1],J=g[b+2],le=g[b+3],(z&192)===128&&(J&192)===128&&(le&192)===128&&(se=(N&15)<<18|(z&63)<<12|(J&63)<<6|le&63,se>65535&&se<1114112&&(C=se))}}C===null?(C=65533,G=1):C>65535&&(C-=65536,v.push(C>>>10&1023|55296),C=56320|C&1023),v.push(C),b+=G}return Ne(v)}var Ae=4096;function Ne(g){var f=g.length;if(f<=Ae)return String.fromCharCode.apply(String,g);for(var l="",v=0;v<f;)l+=String.fromCharCode.apply(String,g.slice(v,v+=Ae));return l}function ft(g,f,l){var v="";l=Math.min(g.length,l);for(var b=f;b<l;++b)v+=String.fromCharCode(g[b]&127);return v}function re(g,f,l){var v="";l=Math.min(g.length,l);for(var b=f;b<l;++b)v+=String.fromCharCode(g[b]);return v}function Re(g,f,l){var v=g.length;(!f||f<0)&&(f=0),(!l||l<0||l>v)&&(l=v);for(var b="",N=f;N<l;++N)b+=wn[g[N]];return b}function V(g,f,l){for(var v=g.slice(f,l),b="",N=0;N<v.length-1;N+=2)b+=String.fromCharCode(v[N]+v[N+1]*256);return b}a.prototype.slice=function(f,l){var v=this.length;f=~~f,l=l===void 0?v:~~l,f<0?(f+=v,f<0&&(f=0)):f>v&&(f=v),l<0?(l+=v,l<0&&(l=0)):l>v&&(l=v),l<f&&(l=f);var b=this.subarray(f,l);return Object.setPrototypeOf(b,a.prototype),b};function D(g,f,l){if(g%1!==0||g<0)throw new RangeError("offset is not uint");if(g+f>l)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(f,l,v){f=f>>>0,l=l>>>0,v||D(f,l,this.length);for(var b=this[f],N=1,C=0;++C<l&&(N*=256);)b+=this[f+C]*N;return b},a.prototype.readUintBE=a.prototype.readUIntBE=function(f,l,v){f=f>>>0,l=l>>>0,v||D(f,l,this.length);for(var b=this[f+--l],N=1;l>0&&(N*=256);)b+=this[f+--l]*N;return b},a.prototype.readUint8=a.prototype.readUInt8=function(f,l){return f=f>>>0,l||D(f,1,this.length),this[f]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(f,l){return f=f>>>0,l||D(f,2,this.length),this[f]|this[f+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(f,l){return f=f>>>0,l||D(f,2,this.length),this[f]<<8|this[f+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(f,l){return f=f>>>0,l||D(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(f,l){return f=f>>>0,l||D(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},a.prototype.readIntLE=function(f,l,v){f=f>>>0,l=l>>>0,v||D(f,l,this.length);for(var b=this[f],N=1,C=0;++C<l&&(N*=256);)b+=this[f+C]*N;return N*=128,b>=N&&(b-=Math.pow(2,8*l)),b},a.prototype.readIntBE=function(f,l,v){f=f>>>0,l=l>>>0,v||D(f,l,this.length);for(var b=l,N=1,C=this[f+--b];b>0&&(N*=256);)C+=this[f+--b]*N;return N*=128,C>=N&&(C-=Math.pow(2,8*l)),C},a.prototype.readInt8=function(f,l){return f=f>>>0,l||D(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},a.prototype.readInt16LE=function(f,l){f=f>>>0,l||D(f,2,this.length);var v=this[f]|this[f+1]<<8;return v&32768?v|4294901760:v},a.prototype.readInt16BE=function(f,l){f=f>>>0,l||D(f,2,this.length);var v=this[f+1]|this[f]<<8;return v&32768?v|4294901760:v},a.prototype.readInt32LE=function(f,l){return f=f>>>0,l||D(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},a.prototype.readInt32BE=function(f,l){return f=f>>>0,l||D(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},a.prototype.readFloatLE=function(f,l){return f=f>>>0,l||D(f,4,this.length),lr.read(this,f,!0,23,4)},a.prototype.readFloatBE=function(f,l){return f=f>>>0,l||D(f,4,this.length),lr.read(this,f,!1,23,4)},a.prototype.readDoubleLE=function(f,l){return f=f>>>0,l||D(f,8,this.length),lr.read(this,f,!0,52,8)},a.prototype.readDoubleBE=function(f,l){return f=f>>>0,l||D(f,8,this.length),lr.read(this,f,!1,52,8)};function Ie(g,f,l,v,b,N){if(!a.isBuffer(g))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>b||f<N)throw new RangeError('"value" argument is out of bounds');if(l+v>g.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(f,l,v,b){if(f=+f,l=l>>>0,v=v>>>0,!b){var N=Math.pow(2,8*v)-1;Ie(this,f,l,v,N,0)}var C=1,G=0;for(this[l]=f&255;++G<v&&(C*=256);)this[l+G]=f/C&255;return l+v},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(f,l,v,b){if(f=+f,l=l>>>0,v=v>>>0,!b){var N=Math.pow(2,8*v)-1;Ie(this,f,l,v,N,0)}var C=v-1,G=1;for(this[l+C]=f&255;--C>=0&&(G*=256);)this[l+C]=f/G&255;return l+v},a.prototype.writeUint8=a.prototype.writeUInt8=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,1,255,0),this[l]=f&255,l+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,2,65535,0),this[l]=f&255,this[l+1]=f>>>8,l+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,2,65535,0),this[l]=f>>>8,this[l+1]=f&255,l+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,4,4294967295,0),this[l+3]=f>>>24,this[l+2]=f>>>16,this[l+1]=f>>>8,this[l]=f&255,l+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,4,4294967295,0),this[l]=f>>>24,this[l+1]=f>>>16,this[l+2]=f>>>8,this[l+3]=f&255,l+4},a.prototype.writeIntLE=function(f,l,v,b){if(f=+f,l=l>>>0,!b){var N=Math.pow(2,8*v-1);Ie(this,f,l,v,N-1,-N)}var C=0,G=1,z=0;for(this[l]=f&255;++C<v&&(G*=256);)f<0&&z===0&&this[l+C-1]!==0&&(z=1),this[l+C]=(f/G>>0)-z&255;return l+v},a.prototype.writeIntBE=function(f,l,v,b){if(f=+f,l=l>>>0,!b){var N=Math.pow(2,8*v-1);Ie(this,f,l,v,N-1,-N)}var C=v-1,G=1,z=0;for(this[l+C]=f&255;--C>=0&&(G*=256);)f<0&&z===0&&this[l+C+1]!==0&&(z=1),this[l+C]=(f/G>>0)-z&255;return l+v},a.prototype.writeInt8=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,1,127,-128),f<0&&(f=255+f+1),this[l]=f&255,l+1},a.prototype.writeInt16LE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,2,32767,-32768),this[l]=f&255,this[l+1]=f>>>8,l+2},a.prototype.writeInt16BE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,2,32767,-32768),this[l]=f>>>8,this[l+1]=f&255,l+2},a.prototype.writeInt32LE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,4,2147483647,-2147483648),this[l]=f&255,this[l+1]=f>>>8,this[l+2]=f>>>16,this[l+3]=f>>>24,l+4},a.prototype.writeInt32BE=function(f,l,v){return f=+f,l=l>>>0,v||Ie(this,f,l,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[l]=f>>>24,this[l+1]=f>>>16,this[l+2]=f>>>8,this[l+3]=f&255,l+4};function vn(g,f,l,v,b,N){if(l+v>g.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function Ge(g,f,l,v,b){return f=+f,l=l>>>0,b||vn(g,f,l,4),lr.write(g,f,l,v,23,4),l+4}a.prototype.writeFloatLE=function(f,l,v){return Ge(this,f,l,!0,v)},a.prototype.writeFloatBE=function(f,l,v){return Ge(this,f,l,!1,v)};function Ir(g,f,l,v,b){return f=+f,l=l>>>0,b||vn(g,f,l,8),lr.write(g,f,l,v,52,8),l+8}a.prototype.writeDoubleLE=function(f,l,v){return Ir(this,f,l,!0,v)},a.prototype.writeDoubleBE=function(f,l,v){return Ir(this,f,l,!1,v)},a.prototype.copy=function(f,l,v,b){if(!a.isBuffer(f))throw new TypeError("argument should be a Buffer");if(v||(v=0),!b&&b!==0&&(b=this.length),l>=f.length&&(l=f.length),l||(l=0),b>0&&b<v&&(b=v),b===v||f.length===0||this.length===0)return 0;if(l<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("sourceEnd out of bounds");b>this.length&&(b=this.length),f.length-l<b-v&&(b=f.length-l+v);var N=b-v;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(l,v,b):Uint8Array.prototype.set.call(f,this.subarray(v,b),l),N},a.prototype.fill=function(f,l,v,b){if(typeof f=="string"){if(typeof l=="string"?(b=l,l=0,v=this.length):typeof v=="string"&&(b=v,v=this.length),b!==void 0&&typeof b!="string")throw new TypeError("encoding must be a string");if(typeof b=="string"&&!a.isEncoding(b))throw new TypeError("Unknown encoding: "+b);if(f.length===1){var N=f.charCodeAt(0);(b==="utf8"&&N<128||b==="latin1")&&(f=N)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(l<0||this.length<l||this.length<v)throw new RangeError("Out of range index");if(v<=l)return this;l=l>>>0,v=v===void 0?this.length:v>>>0,f||(f=0);var C;if(typeof f=="number")for(C=l;C<v;++C)this[C]=f;else{var G=a.isBuffer(f)?f:a.from(f,b),z=G.length;if(z===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(C=0;C<v-l;++C)this[C+l]=G[C%z]}return this};var mn=/[^+/0-9A-Za-z-_]/g;function Ei(g){if(g=g.split("=")[0],g=g.trim().replace(mn,""),g.length<2)return"";for(;g.length%4!==0;)g=g+"=";return g}function Or(g,f){f=f||1/0;for(var l,v=g.length,b=null,N=[],C=0;C<v;++C){if(l=g.charCodeAt(C),l>55295&&l<57344){if(!b){if(l>56319){(f-=3)>-1&&N.push(239,191,189);continue}else if(C+1===v){(f-=3)>-1&&N.push(239,191,189);continue}b=l;continue}if(l<56320){(f-=3)>-1&&N.push(239,191,189),b=l;continue}l=(b-55296<<10|l-56320)+65536}else b&&(f-=3)>-1&&N.push(239,191,189);if(b=null,l<128){if((f-=1)<0)break;N.push(l)}else if(l<2048){if((f-=2)<0)break;N.push(l>>6|192,l&63|128)}else if(l<65536){if((f-=3)<0)break;N.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((f-=4)<0)break;N.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return N}function bi(g){for(var f=[],l=0;l<g.length;++l)f.push(g.charCodeAt(l)&255);return f}function Si(g,f){for(var l,v,b,N=[],C=0;C<g.length&&!((f-=2)<0);++C)l=g.charCodeAt(C),v=l>>8,b=l%256,N.push(b),N.push(v);return N}function _n(g){return ho.toByteArray(Ei(g))}function Mt(g,f,l,v){for(var b=0;b<v&&!(b+l>=f.length||b>=g.length);++b)f[b+l]=g[b];return b}function Ke(g,f){return g instanceof f||g!=null&&g.constructor!=null&&g.constructor.name!=null&&g.constructor.name===f.name}function xr(g){return g!==g}var wn=function(){for(var g="0123456789abcdef",f=new Array(256),l=0;l<16;++l)for(var v=l*16,b=0;b<16;++b)f[v+b]=g[l]+g[b];return f}()}),X=gi.Buffer;gi.SlowBuffer;gi.INSPECT_MAX_BYTES;gi.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fo=function(e,r){return Fo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},Fo(e,r)};function yi(t,e){Fo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Xt=function(t){yi(e,t);function e(r){var i=t.call(this,r)||this;return Object.setPrototypeOf(i,e.prototype),i}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),e}(Error),ce=function(t){yi(e,t);function e(r){var i=t.call(this,r)||this;return Object.setPrototypeOf(i,e.prototype),i}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),e}(TypeError);function Ln(t){return t&&t.Math==Math&&t}function Fu(){return Ln(typeof globalThis=="object"&&globalThis)||Ln(typeof window=="object"&&window)||Ln(typeof self=="object"&&self)||Ln(typeof global=="object"&&global)||Function("return this")()}function Cy(){var t=Fu();return typeof t.navigator=="object"&&t.navigator.product==="ReactNative"}var Py=function(e){var r=Cy()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var i=X.alloc(e),o=0;o<e;++o)i[o]=Math.floor(Math.random()*256);return i},Fy=function(){{if(typeof window<"u"){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(X.alloc(e))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(e){return global.crypto.getRandomValues(X.alloc(e))}:Py}},Bu=Fy();function By(t){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(t))}function Jo(t){return Object.prototype.toString.call(t)==="[object Uint8Array]"}function Dy(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Ly(t){return yn(t)&&Object.prototype.toString.call(t)==="[object Date]"}function yn(t){return typeof t=="object"&&t!==null}function vi(t,e){var r=!1;function i(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];return r||(console.warn(e),r=!0),t.apply(this,o)}return i}function ti(t){if(ArrayBuffer.isView(t))return X.from(t.buffer,t.byteOffset,t.byteLength);if(By(t))return X.from(t);throw new ce("Must use either Buffer or TypedArray")}var Uy=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,Du=function(t){return typeof t=="string"&&Uy.test(t)},Bo=function(t){if(!Du(t))throw new ce('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var e=t.replace(/-/g,"");return X.from(e,"hex")},ua=function(t,e){return e===void 0&&(e=!0),e?t.toString("hex",0,4)+"-"+t.toString("hex",4,6)+"-"+t.toString("hex",6,8)+"-"+t.toString("hex",8,10)+"-"+t.toString("hex",10,16):t.toString("hex")},My=Math.pow(2,53),ky=-Math.pow(2,53),Lu=4,zt=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(e!=null&&typeof e!="string"&&!ArrayBuffer.isView(e)&&!(e instanceof ArrayBuffer)&&!Array.isArray(e))throw new ce("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??t.BSON_BINARY_SUBTYPE_DEFAULT,e==null?(this.buffer=X.alloc(t.BUFFER_SIZE),this.position=0):(typeof e=="string"?this.buffer=X.from(e,"binary"):Array.isArray(e)?this.buffer=X.from(e):this.buffer=ti(e),this.position=this.buffer.byteLength)}return t.prototype.put=function(e){if(typeof e=="string"&&e.length!==1)throw new ce("only accepts single character String");if(typeof e!="number"&&e.length!==1)throw new ce("only accepts single character Uint8Array or Array");var r;if(typeof e=="string"?r=e.charCodeAt(0):typeof e=="number"?r=e:r=e[0],r<0||r>255)throw new ce("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var i=X.alloc(t.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=r}},t.prototype.write=function(e,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+e.length){var i=X.alloc(this.buffer.length+e.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i}ArrayBuffer.isView(e)?(this.buffer.set(ti(e),r),this.position=r+e.byteLength>this.position?r+e.length:this.position):typeof e=="string"&&(this.buffer.write(e,r,e.length,"binary"),this.position=r+e.length>this.position?r+e.length:this.position)},t.prototype.read=function(e,r){return r=r&&r>0?r:this.position,this.buffer.slice(e,e+r)},t.prototype.value=function(e){return e=!!e,e&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},t.prototype.length=function(){return this.position},t.prototype.toJSON=function(){return this.buffer.toString("base64")},t.prototype.toString=function(e){return this.buffer.toString(e)},t.prototype.toExtendedJSON=function(e){e=e||{};var r=this.buffer.toString("base64"),i=Number(this.sub_type).toString(16);return e.legacy?{$binary:r,$type:i.length===1?"0"+i:i}:{$binary:{base64:r,subType:i.length===1?"0"+i:i}}},t.prototype.toUUID=function(){if(this.sub_type===t.SUBTYPE_UUID)return new ca(this.buffer.slice(0,this.position));throw new Xt('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(t.SUBTYPE_UUID,'" is currently supported.'))},t.fromExtendedJSON=function(e,r){r=r||{};var i,o;if("$binary"in e?r.legacy&&typeof e.$binary=="string"&&"$type"in e?(o=e.$type?parseInt(e.$type,16):0,i=X.from(e.$binary,"base64")):typeof e.$binary!="string"&&(o=e.$binary.subType?parseInt(e.$binary.subType,16):0,i=X.from(e.$binary.base64,"base64")):"$uuid"in e&&(o=4,i=Bo(e.$uuid)),!i)throw new ce("Unexpected Binary Extended JSON format ".concat(JSON.stringify(e)));return o===Lu?new ca(i):new t(i,o)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BUFFER_SIZE=256,t.SUBTYPE_DEFAULT=0,t.SUBTYPE_FUNCTION=1,t.SUBTYPE_BYTE_ARRAY=2,t.SUBTYPE_UUID_OLD=3,t.SUBTYPE_UUID=4,t.SUBTYPE_MD5=5,t.SUBTYPE_ENCRYPTED=6,t.SUBTYPE_COLUMN=7,t.SUBTYPE_USER_DEFINED=128,t}();Object.defineProperty(zt.prototype,"_bsontype",{value:"Binary"});var po=16,ca=function(t){yi(e,t);function e(r){var i=this,o,n;if(r==null)o=e.generate();else if(r instanceof e)o=X.from(r.buffer),n=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===po)o=ti(r);else if(typeof r=="string")o=Bo(r);else throw new ce("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return i=t.call(this,o,Lu)||this,i.__id=n,i}return Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,e.cacheHexString&&(this.__id=ua(r))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(r){if(r===void 0&&(r=!0),e.cacheHexString&&this.__id)return this.__id;var i=ua(this.id,r);return e.cacheHexString&&(this.__id=i),i},e.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(r){if(!r)return!1;if(r instanceof e)return r.id.equals(this.id);try{return new e(r).id.equals(this.id)}catch{return!1}},e.prototype.toBinary=function(){return new zt(this.id,zt.SUBTYPE_UUID)},e.generate=function(){var r=Bu(po);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,X.from(r)},e.isValid=function(r){return r?r instanceof e?!0:typeof r=="string"?Du(r):Jo(r)?r.length!==po?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},e.createFromHexString=function(r){var i=Bo(r);return new e(i)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},e}(zt),mi=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);this.code=e,this.scope=r}return t.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},t.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},t.fromExtendedJSON=function(e){return new t(e.$code,e.$scope)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},t}();Object.defineProperty(mi.prototype,"_bsontype",{value:"Code"});function $y(t){return yn(t)&&t.$id!=null&&typeof t.$ref=="string"&&(t.$db==null||typeof t.$db=="string")}var hn=function(){function t(e,r,i,o){if(!(this instanceof t))return new t(e,r,i,o);var n=e.split(".");n.length===2&&(i=n.shift(),e=n.shift()),this.collection=e,this.oid=r,this.db=i,this.fields=o||{}}return Object.defineProperty(t.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(e.$db=this.db),e},t.prototype.toExtendedJSON=function(e){e=e||{};var r={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},t.fromExtendedJSON=function(e){var r=Object.assign({},e);return delete r.$ref,delete r.$id,delete r.$db,new t(e.$ref,e.$id,e.$db,r)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},t}();Object.defineProperty(hn.prototype,"_bsontype",{value:"DBRef"});var Ye=void 0;try{Ye=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var fa=1<<16,jy=1<<24,vr=fa*fa,Uu=vr*vr,la=Uu/2,ha={},da={},$=function(){function t(e,r,i){if(e===void 0&&(e=0),!(this instanceof t))return new t(e,r,i);typeof e=="bigint"?Object.assign(this,t.fromBigInt(e,!!r)):typeof e=="string"?Object.assign(this,t.fromString(e,!!r)):(this.low=e|0,this.high=r|0,this.unsigned=!!i),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return t.fromBits=function(e,r,i){return new t(e,r,i)},t.fromInt=function(e,r){var i,o,n;return r?(e>>>=0,(n=0<=e&&e<256)&&(o=da[e],o)?o:(i=t.fromBits(e,(e|0)<0?-1:0,!0),n&&(da[e]=i),i)):(e|=0,(n=-128<=e&&e<128)&&(o=ha[e],o)?o:(i=t.fromBits(e,e<0?-1:0,!1),n&&(ha[e]=i),i))},t.fromNumber=function(e,r){if(isNaN(e))return r?t.UZERO:t.ZERO;if(r){if(e<0)return t.UZERO;if(e>=Uu)return t.MAX_UNSIGNED_VALUE}else{if(e<=-la)return t.MIN_VALUE;if(e+1>=la)return t.MAX_VALUE}return e<0?t.fromNumber(-e,r).neg():t.fromBits(e%vr|0,e/vr|0,r)},t.fromBigInt=function(e,r){return t.fromString(e.toString(),r)},t.fromString=function(e,r,i){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t.ZERO;if(typeof r=="number"?(i=r,r=!1):r=!!r,i=i||10,i<2||36<i)throw RangeError("radix");var o;if((o=e.indexOf("-"))>0)throw Error("interior hyphen");if(o===0)return t.fromString(e.substring(1),r,i).neg();for(var n=t.fromNumber(Math.pow(i,8)),a=t.ZERO,c=0;c<e.length;c+=8){var h=Math.min(8,e.length-c),s=parseInt(e.substring(c,c+h),i);if(h<8){var u=t.fromNumber(Math.pow(i,h));a=a.mul(u).add(t.fromNumber(s))}else a=a.mul(n),a=a.add(t.fromNumber(s))}return a.unsigned=r,a},t.fromBytes=function(e,r,i){return i?t.fromBytesLE(e,r):t.fromBytesBE(e,r)},t.fromBytesLE=function(e,r){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},t.fromBytesBE=function(e,r){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)},t.isLong=function(e){return yn(e)&&e.__isLong__===!0},t.fromValue=function(e,r){return typeof e=="number"?t.fromNumber(e,r):typeof e=="string"?t.fromString(e,r):t.fromBits(e.low,e.high,typeof r=="boolean"?r:e.unsigned)},t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var r=this.high>>>16,i=this.high&65535,o=this.low>>>16,n=this.low&65535,a=e.high>>>16,c=e.high&65535,h=e.low>>>16,s=e.low&65535,u=0,d=0,y=0,w=0;return w+=n+s,y+=w>>>16,w&=65535,y+=o+h,d+=y>>>16,y&=65535,d+=i+c,u+=d>>>16,d&=65535,u+=r+a,u&=65535,t.fromBits(y<<16|w,u<<16|d,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.prototype.comp=function(e){return this.compare(e)},t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");if(Ye){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?Ye.div_u:Ye.div_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,Ye.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var i,o,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return t.UZERO;if(e.gt(this.shru(1)))return t.UONE;n=t.UZERO}else{if(this.eq(t.MIN_VALUE)){if(e.eq(t.ONE)||e.eq(t.NEG_ONE))return t.MIN_VALUE;if(e.eq(t.MIN_VALUE))return t.ONE;var a=this.shr(1);return i=a.div(e).shl(1),i.eq(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(o=this.sub(e.mul(i)),n=i.add(o.div(e)),n)}else if(e.eq(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=t.ZERO}for(o=this;o.gte(e);){i=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),h=c<=48?1:Math.pow(2,c-48),s=t.fromNumber(i),u=s.mul(e);u.isNegative()||u.gt(o);)i-=h,s=t.fromNumber(i,this.unsigned),u=s.mul(e);s.isZero()&&(s=t.ONE),n=n.add(s),o=o.sub(u)}return n},t.prototype.div=function(e){return this.divide(e)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},t.prototype.eq=function(e){return this.equals(e)},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(t.MIN_VALUE)?64:this.neg().getNumBitsAbs();var e=this.high!==0?this.high:this.low,r;for(r=31;r>0&&!(e&1<<r);r--);return this.high!==0?r+33:r+1},t.prototype.greaterThan=function(e){return this.comp(e)>0},t.prototype.gt=function(e){return this.greaterThan(e)},t.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},t.prototype.gte=function(e){return this.greaterThanOrEqual(e)},t.prototype.ge=function(e){return this.greaterThanOrEqual(e)},t.prototype.isEven=function(){return(this.low&1)===0},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isOdd=function(){return(this.low&1)===1},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isZero=function(){return this.high===0&&this.low===0},t.prototype.lessThan=function(e){return this.comp(e)<0},t.prototype.lt=function(e){return this.lessThan(e)},t.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},t.prototype.lte=function(e){return this.lessThanOrEqual(e)},t.prototype.modulo=function(e){if(t.isLong(e)||(e=t.fromValue(e)),Ye){var r=(this.unsigned?Ye.rem_u:Ye.rem_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,Ye.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},t.prototype.mod=function(e){return this.modulo(e)},t.prototype.rem=function(e){return this.modulo(e)},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),Ye){var r=Ye.mul(this.low,this.high,e.low,e.high);return t.fromBits(r,Ye.get_high(),this.unsigned)}if(e.isZero())return t.ZERO;if(this.eq(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.eq(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(t.TWO_PWR_24)&&e.lt(t.TWO_PWR_24))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,o=this.high&65535,n=this.low>>>16,a=this.low&65535,c=e.high>>>16,h=e.high&65535,s=e.low>>>16,u=e.low&65535,d=0,y=0,w=0,E=0;return E+=a*u,w+=E>>>16,E&=65535,w+=n*u,y+=w>>>16,w&=65535,w+=a*s,y+=w>>>16,w&=65535,y+=o*u,d+=y>>>16,y&=65535,y+=n*s,d+=y>>>16,y&=65535,y+=a*h,d+=y>>>16,y&=65535,d+=i*u+o*s+n*h+a*c,d&=65535,t.fromBits(w<<16|E,d<<16|y,this.unsigned)},t.prototype.mul=function(e){return this.multiply(e)},t.prototype.negate=function(){return!this.unsigned&&this.eq(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=function(){return this.negate()},t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.notEquals=function(e){return!this.equals(e)},t.prototype.neq=function(e){return this.notEquals(e)},t.prototype.ne=function(e){return this.notEquals(e)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=function(e){return this.shiftLeft(e)},t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=function(e){return this.shiftRight(e)},t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),e&=63,e===0)return this;var r=this.high;if(e<32){var i=this.low;return t.fromBits(i>>>e|r<<32-e,r>>>e,this.unsigned)}else return e===32?t.fromBits(r,0,this.unsigned):t.fromBits(r>>>e-32,0,this.unsigned)},t.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},t.prototype.shru=function(e){return this.shiftRightUnsigned(e)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.neg())},t.prototype.sub=function(e){return this.subtract(e)},t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*vr+(this.low>>>0):this.high*vr+(this.low>>>0)},t.prototype.toBigInt=function(){return BigInt(this.toString())},t.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},t.prototype.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},t.prototype.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},t.prototype.toSigned=function(){return this.unsigned?t.fromBits(this.low,this.high,!1):this},t.prototype.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(t.MIN_VALUE)){var r=t.fromNumber(e),i=this.div(r),o=i.mul(r).sub(this);return i.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var n=t.fromNumber(Math.pow(e,6),this.unsigned),a=this,c="";;){var h=a.div(n),s=a.sub(h.mul(n)).toInt()>>>0,u=s.toString(e);if(a=h,a.isZero())return u+c;for(;u.length<6;)u="0"+u;c=""+u+c}},t.prototype.toUnsigned=function(){return this.unsigned?this:t.fromBits(this.low,this.high,!0)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.eqz=function(){return this.isZero()},t.prototype.le=function(e){return this.lessThanOrEqual(e)},t.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},t.fromExtendedJSON=function(e,r){var i=t.fromString(e.$numberLong);return r&&r.relaxed?i.toNumber():i},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},t.TWO_PWR_24=t.fromInt(jy),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t}();Object.defineProperty($.prototype,"__isLong__",{value:!0});Object.defineProperty($.prototype,"_bsontype",{value:"Long"});var Wy=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,qy=/^(\+|-)?(Infinity|inf)$/i,Hy=/^(\+|-)?NaN$/i,rn=6111,go=-6176,pa=6176,Gy=34,yo=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ga=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ya=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Ky=/^([-+])?(\d+)?$/,Vy=31,va=16383,Jy=30,Yy=31;function ma(t){return!isNaN(parseInt(t,10))}function Xy(t){var e=$.fromNumber(1e9),r=$.fromNumber(0);if(!t.parts[0]&&!t.parts[1]&&!t.parts[2]&&!t.parts[3])return{quotient:t,rem:r};for(var i=0;i<=3;i++)r=r.shiftLeft(32),r=r.add(new $(t.parts[i],0)),t.parts[i]=r.div(e).low,r=r.modulo(e);return{quotient:t,rem:r}}function zy(t,e){if(!t&&!e)return{high:$.fromNumber(0),low:$.fromNumber(0)};var r=t.shiftRightUnsigned(32),i=new $(t.getLowBits(),0),o=e.shiftRightUnsigned(32),n=new $(e.getLowBits(),0),a=r.multiply(o),c=r.multiply(n),h=i.multiply(o),s=i.multiply(n);return a=a.add(c.shiftRightUnsigned(32)),c=new $(c.getLowBits(),0).add(h).add(s.shiftRightUnsigned(32)),a=a.add(c.shiftRightUnsigned(32)),s=c.shiftLeft(32).add(new $(s.getLowBits(),0)),{high:a,low:s}}function Qy(t,e){var r=t.high>>>0,i=e.high>>>0;if(r<i)return!0;if(r===i){var o=t.low>>>0,n=e.low>>>0;if(o<n)return!0}return!1}function hr(t,e){throw new ce('"'.concat(t,'" is not a valid Decimal128 string - ').concat(e))}var Yo=function(){function t(e){if(!(this instanceof t))return new t(e);if(typeof e=="string")this.bytes=t.fromString(e).bytes;else if(Jo(e)){if(e.byteLength!==16)throw new ce("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new ce("Decimal128 must take a Buffer or string")}return t.fromString=function(e){var r=!1,i=!1,o=!1,n=0,a=0,c=0,h=0,s=0,u=[0],d=0,y=0,w=0,E=0,A=0,m=0,_=new $(0,0),x=new $(0,0),I=0,T=0;if(e.length>=7e3)throw new ce(""+e+" not a valid Decimal128 string");var F=e.match(Wy),R=e.match(qy),L=e.match(Hy);if(!F&&!R&&!L||e.length===0)throw new ce(""+e+" not a valid Decimal128 string");if(F){var k=F[2],B=F[4],ue=F[5],fe=F[6];B&&fe===void 0&&hr(e,"missing exponent power"),B&&k===void 0&&hr(e,"missing exponent base"),B===void 0&&(ue||fe)&&hr(e,"missing e before exponent")}if((e[T]==="+"||e[T]==="-")&&(r=e[T++]==="-"),!ma(e[T])&&e[T]!=="."){if(e[T]==="i"||e[T]==="I")return new t(X.from(r?ga:ya));if(e[T]==="N")return new t(X.from(yo))}for(;ma(e[T])||e[T]===".";){if(e[T]==="."){i&&hr(e,"contains multiple periods"),i=!0,T=T+1;continue}d<34&&(e[T]!=="0"||o)&&(o||(s=a),o=!0,u[y++]=parseInt(e[T],10),d=d+1),o&&(c=c+1),i&&(h=h+1),a=a+1,T=T+1}if(i&&!a)throw new ce(""+e+" not a valid Decimal128 string");if(e[T]==="e"||e[T]==="E"){var ye=e.substr(++T).match(Ky);if(!ye||!ye[2])return new t(X.from(yo));A=parseInt(ye[0],10),T=T+ye[0].length}if(e[T])return new t(X.from(yo));if(w=0,!d)w=0,E=0,u[0]=0,c=1,d=1,n=0;else if(E=d-1,n=c,n!==1)for(;u[s+n-1]===0;)n=n-1;for(A<=h&&h-A>1<<14?A=go:A=A-h;A>rn;){if(E=E+1,E-w>Gy){var Y=u.join("");if(Y.match(/^0+$/)){A=rn;break}hr(e,"overflow")}A=A-1}for(;A<go||d<c;){if(E===0&&n<d){A=go,n=0;break}if(d<c?c=c-1:E=E-1,A<rn)A=A+1;else{var Y=u.join("");if(Y.match(/^0+$/)){A=rn;break}hr(e,"overflow")}}if(E-w+1<n){var Ae=a;i&&(s=s+1,Ae=Ae+1),r&&(s=s+1,Ae=Ae+1);var Ne=parseInt(e[s+E+1],10),ft=0;if(Ne>=5&&(ft=1,Ne===5)){for(ft=u[E]%2===1?1:0,m=s+E+2;m<Ae;m++)if(parseInt(e[m],10)){ft=1;break}}if(ft){for(var re=E;re>=0;re--)if(++u[re]>9&&(u[re]=0,re===0))if(A<rn)A=A+1,u[re]=1;else return new t(X.from(r?ga:ya))}}if(_=$.fromNumber(0),x=$.fromNumber(0),n===0)_=$.fromNumber(0),x=$.fromNumber(0);else if(E-w<17){var re=w;for(x=$.fromNumber(u[re++]),_=new $(0,0);re<=E;re++)x=x.multiply($.fromNumber(10)),x=x.add($.fromNumber(u[re]))}else{var re=w;for(_=$.fromNumber(u[re++]);re<=E-17;re++)_=_.multiply($.fromNumber(10)),_=_.add($.fromNumber(u[re]));for(x=$.fromNumber(u[re++]);re<=E;re++)x=x.multiply($.fromNumber(10)),x=x.add($.fromNumber(u[re]))}var Re=zy(_,$.fromString("100000000000000000"));Re.low=Re.low.add(x),Qy(Re.low,x)&&(Re.high=Re.high.add($.fromNumber(1))),I=A+pa;var V={low:$.fromNumber(0),high:$.fromNumber(0)};Re.high.shiftRightUnsigned(49).and($.fromNumber(1)).equals($.fromNumber(1))?(V.high=V.high.or($.fromNumber(3).shiftLeft(61)),V.high=V.high.or($.fromNumber(I).and($.fromNumber(16383).shiftLeft(47))),V.high=V.high.or(Re.high.and($.fromNumber(0x7fffffffffff)))):(V.high=V.high.or($.fromNumber(I&16383).shiftLeft(49)),V.high=V.high.or(Re.high.and($.fromNumber(562949953421311)))),V.low=Re.low,r&&(V.high=V.high.or($.fromString("9223372036854775808")));var D=X.alloc(16);return T=0,D[T++]=V.low.low&255,D[T++]=V.low.low>>8&255,D[T++]=V.low.low>>16&255,D[T++]=V.low.low>>24&255,D[T++]=V.low.high&255,D[T++]=V.low.high>>8&255,D[T++]=V.low.high>>16&255,D[T++]=V.low.high>>24&255,D[T++]=V.high.low&255,D[T++]=V.high.low>>8&255,D[T++]=V.high.low>>16&255,D[T++]=V.high.low>>24&255,D[T++]=V.high.high&255,D[T++]=V.high.high>>8&255,D[T++]=V.high.high>>16&255,D[T++]=V.high.high>>24&255,new t(D)},t.prototype.toString=function(){for(var e,r=0,i=new Array(36),o=0;o<i.length;o++)i[o]=0;var n=0,a=!1,c,h={parts:[0,0,0,0]},s,u,d=[];n=0;var y=this.bytes,w=y[n++]|y[n++]<<8|y[n++]<<16|y[n++]<<24,E=y[n++]|y[n++]<<8|y[n++]<<16|y[n++]<<24,A=y[n++]|y[n++]<<8|y[n++]<<16|y[n++]<<24,m=y[n++]|y[n++]<<8|y[n++]<<16|y[n++]<<24;n=0;var _={low:new $(w,E),high:new $(A,m)};_.high.lessThan($.ZERO)&&d.push("-");var x=m>>26&Vy;if(x>>3===3){if(x===Jy)return d.join("")+"Infinity";if(x===Yy)return"NaN";e=m>>15&va,c=8+(m>>14&1)}else c=m>>14&7,e=m>>17&va;var I=e-pa;if(h.parts[0]=(m&16383)+((c&15)<<14),h.parts[1]=A,h.parts[2]=E,h.parts[3]=w,h.parts[0]===0&&h.parts[1]===0&&h.parts[2]===0&&h.parts[3]===0)a=!0;else for(u=3;u>=0;u--){var T=0,F=Xy(h);if(h=F.quotient,T=F.rem.low,!!T)for(s=8;s>=0;s--)i[u*9+s]=T%10,T=Math.floor(T/10)}if(a)r=1,i[n]=0;else for(r=36;!i[n];)r=r-1,n=n+1;var R=r-1+I;if(R>=34||R<=-7||I>0){if(r>34)return d.push("".concat(0)),I>0?d.push("E+".concat(I)):I<0&&d.push("E".concat(I)),d.join("");d.push("".concat(i[n++])),r=r-1,r&&d.push(".");for(var o=0;o<r;o++)d.push("".concat(i[n++]));d.push("E"),R>0?d.push("+".concat(R)):d.push("".concat(R))}else if(I>=0)for(var o=0;o<r;o++)d.push("".concat(i[n++]));else{var L=r+I;if(L>0)for(var o=0;o<L;o++)d.push("".concat(i[n++]));else d.push("0");for(d.push(".");L++<0;)d.push("0");for(var o=0;o<r-Math.max(L-1,0);o++)d.push("".concat(i[n++]))}return d.join("")},t.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},t.fromExtendedJSON=function(e){return t.fromString(e.$numberDecimal)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},t}();Object.defineProperty(Yo.prototype,"_bsontype",{value:"Decimal128"});var _i=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toJSON=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},t.fromExtendedJSON=function(e,r){var i=parseFloat(e.$numberDouble);return r&&r.relaxed?i:new t(i)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},t}();Object.defineProperty(_i.prototype,"_bsontype",{value:"Double"});var wi=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e|0}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},t.fromExtendedJSON=function(e,r){return r&&r.relaxed?parseInt(e.$numberInt,10):new t(e.$numberInt)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},t}();Object.defineProperty(wi.prototype,"_bsontype",{value:"Int32"});var Xo=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$maxKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MaxKey()"},t}();Object.defineProperty(Xo.prototype,"_bsontype",{value:"MaxKey"});var zo=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$minKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MinKey()"},t}();Object.defineProperty(zo.prototype,"_bsontype",{value:"MinKey"});var Zy=new RegExp("^[0-9a-fA-F]{24}$"),Gt=null,dt=Symbol("id"),it=function(){function t(e){if(!(this instanceof t))return new t(e);var r;if(typeof e=="object"&&e&&"id"in e){if(typeof e.id!="string"&&!ArrayBuffer.isView(e.id))throw new ce("Argument passed in must have an id that is of type string or Buffer");"toHexString"in e&&typeof e.toHexString=="function"?r=X.from(e.toHexString(),"hex"):r=e.id}else r=e;if(r==null||typeof r=="number")this[dt]=t.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[dt]=r instanceof X?r:ti(r);else if(typeof r=="string")if(r.length===12){var i=X.from(r);if(i.byteLength===12)this[dt]=i;else throw new ce("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&Zy.test(r))this[dt]=X.from(r,"hex");else throw new ce("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new ce("Argument passed in does not match the accepted types");t.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(t.prototype,"id",{get:function(){return this[dt]},set:function(e){this[dt]=e,t.cacheHexString&&(this.__id=e.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(){if(t.cacheHexString&&this.__id)return this.__id;var e=this.id.toString("hex");return t.cacheHexString&&!this.__id&&(this.__id=e),e},t.getInc=function(){return t.index=(t.index+1)%16777215},t.generate=function(e){typeof e!="number"&&(e=Math.floor(Date.now()/1e3));var r=t.getInc(),i=X.alloc(12);return i.writeUInt32BE(e,0),Gt===null&&(Gt=Bu(5)),i[4]=Gt[0],i[5]=Gt[1],i[6]=Gt[2],i[7]=Gt[3],i[8]=Gt[4],i[11]=r&255,i[10]=r>>8&255,i[9]=r>>16&255,i},t.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(e==null)return!1;if(e instanceof t)return this[dt][11]===e[dt][11]&&this[dt].equals(e[dt]);if(typeof e=="string"&&t.isValid(e)&&e.length===12&&Jo(this.id))return e===X.prototype.toString.call(this.id,"latin1");if(typeof e=="string"&&t.isValid(e)&&e.length===24)return e.toLowerCase()===this.toHexString();if(typeof e=="string"&&t.isValid(e)&&e.length===12)return X.from(e).equals(this.id);if(typeof e=="object"&&"toHexString"in e&&typeof e.toHexString=="function"){var r=e.toHexString(),i=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===i}return!1},t.prototype.getTimestamp=function(){var e=new Date,r=this.id.readUInt32BE(0);return e.setTime(Math.floor(r)*1e3),e},t.createPk=function(){return new t},t.createFromTime=function(e){var r=X.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(e,0),new t(r)},t.createFromHexString=function(e){if(typeof e>"u"||e!=null&&e.length!==24)throw new ce("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new t(X.from(e,"hex"))},t.isValid=function(e){if(e==null)return!1;try{return new t(e),!0}catch{return!1}},t.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},t.fromExtendedJSON=function(e){return new t(e.$oid)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},t.index=Math.floor(Math.random()*16777215),t}();Object.defineProperty(it.prototype,"generate",{value:vi(function(t){return it.generate(t)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(it.prototype,"getInc",{value:vi(function(){return it.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(it.prototype,"get_inc",{value:vi(function(){return it.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(it,"get_inc",{value:vi(function(){return it.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(it.prototype,"_bsontype",{value:"ObjectID"});function e0(t){return t.split("").sort().join("")}var dn=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(this.pattern=e,this.options=e0(r??""),this.pattern.indexOf("\0")!==-1)throw new Xt("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new Xt("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var i=0;i<this.options.length;i++)if(!(this.options[i]==="i"||this.options[i]==="m"||this.options[i]==="x"||this.options[i]==="l"||this.options[i]==="s"||this.options[i]==="u"))throw new Xt("The regular expression option [".concat(this.options[i],"] is not supported"))}return t.parseOptions=function(e){return e?e.split("").sort().join(""):""},t.prototype.toExtendedJSON=function(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},t.fromExtendedJSON=function(e){if("$regex"in e)if(typeof e.$regex!="string"){if(e.$regex._bsontype==="BSONRegExp")return e}else return new t(e.$regex,t.parseOptions(e.$options));if("$regularExpression"in e)return new t(e.$regularExpression.pattern,t.parseOptions(e.$regularExpression.options));throw new ce("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(e)))},t}();Object.defineProperty(dn.prototype,"_bsontype",{value:"BSONRegExp"});var Qo=function(){function t(e){if(!(this instanceof t))return new t(e);this.value=e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(){return this.value},t.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(){return{$symbol:this.value}},t.fromExtendedJSON=function(e){return new t(e.$symbol)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t}();Object.defineProperty(Qo.prototype,"_bsontype",{value:"Symbol"});var t0=$,Mu=function(t){yi(e,t);function e(r,i){var o=this;return o instanceof e?($.isLong(r)?o=t.call(this,r.low,r.high,!0)||this:yn(r)&&typeof r.t<"u"&&typeof r.i<"u"?o=t.call(this,r.i,r.t,!0)||this:o=t.call(this,r,i,!0)||this,Object.defineProperty(o,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),o):new e(r,i)}return e.prototype.toJSON=function(){return{$timestamp:this.toString()}},e.fromInt=function(r){return new e($.fromInt(r,!0))},e.fromNumber=function(r){return new e($.fromNumber(r,!0))},e.fromBits=function(r,i){return new e(r,i)},e.fromString=function(r,i){return new e($.fromString(r,!0,i))},e.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},e.fromExtendedJSON=function(r){return new e(r.$timestamp)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},e.MAX_VALUE=$.MAX_UNSIGNED_VALUE,e}(t0);function r0(t){return yn(t)&&Reflect.has(t,"_bsontype")&&typeof t._bsontype=="string"}var ku=2147483647,$u=-2147483648,ju=9223372036854776e3,Wu=-9223372036854776e3,n0={$oid:it,$binary:zt,$uuid:zt,$symbol:Qo,$numberInt:wi,$numberDecimal:Yo,$numberDouble:_i,$numberLong:$,$minKey:zo,$maxKey:Xo,$regex:dn,$regularExpression:dn,$timestamp:Mu};function qu(t,e){if(e===void 0&&(e={}),typeof t=="number"){if(e.relaxed||e.legacy)return t;if(Math.floor(t)===t){if(t>=$u&&t<=ku)return new wi(t);if(t>=Wu&&t<=ju)return $.fromNumber(t)}return new _i(t)}if(t==null||typeof t!="object")return t;if(t.$undefined)return null;for(var r=Object.keys(t).filter(function(d){return d.startsWith("$")&&t[d]!=null}),i=0;i<r.length;i++){var o=n0[r[i]];if(o)return o.fromExtendedJSON(t,e)}if(t.$date!=null){var n=t.$date,a=new Date;return e.legacy?typeof n=="number"?a.setTime(n):typeof n=="string"&&a.setTime(Date.parse(n)):typeof n=="string"?a.setTime(Date.parse(n)):$.isLong(n)?a.setTime(n.toNumber()):typeof n=="number"&&e.relaxed&&a.setTime(n),a}if(t.$code!=null){var c=Object.assign({},t);return t.$scope&&(c.$scope=qu(t.$scope)),mi.fromExtendedJSON(t)}if($y(t)||t.$dbPointer){var h=t.$ref?t:t.$dbPointer;if(h instanceof hn)return h;var s=Object.keys(h).filter(function(d){return d.startsWith("$")}),u=!0;if(s.forEach(function(d){["$ref","$id","$db"].indexOf(d)===-1&&(u=!1)}),u)return hn.fromExtendedJSON(h)}return t}function i0(t,e){return t.map(function(r,i){e.seenObjects.push({propertyName:"index ".concat(i),obj:null});try{return Pt(r,e)}finally{e.seenObjects.pop()}})}function _a(t){var e=t.toISOString();return t.getUTCMilliseconds()!==0?e:e.slice(0,-5)+"Z"}function Pt(t,e){if((typeof t=="object"||typeof t=="function")&&t!==null){var r=e.seenObjects.findIndex(function(_){return _.obj===t});if(r!==-1){var i=e.seenObjects.map(function(_){return _.propertyName}),o=i.slice(0,r).map(function(_){return"".concat(_," -> ")}).join(""),n=i[r],a=" -> "+i.slice(r+1,i.length-1).map(function(_){return"".concat(_," -> ")}).join(""),c=i[i.length-1],h=" ".repeat(o.length+n.length/2),s="-".repeat(a.length+(n.length+c.length)/2-1);throw new ce(`Converting circular structure to EJSON:
`+"    ".concat(o).concat(n).concat(a).concat(c,`
`)+"    ".concat(h,"\\").concat(s,"/"))}e.seenObjects[e.seenObjects.length-1].obj=t}if(Array.isArray(t))return i0(t,e);if(t===void 0)return null;if(t instanceof Date||Ly(t)){var u=t.getTime(),d=u>-1&&u<2534023188e5;return e.legacy?e.relaxed&&d?{$date:t.getTime()}:{$date:_a(t)}:e.relaxed&&d?{$date:_a(t)}:{$date:{$numberLong:t.getTime().toString()}}}if(typeof t=="number"&&(!e.relaxed||!isFinite(t))){if(Math.floor(t)===t){var y=t>=$u&&t<=ku,w=t>=Wu&&t<=ju;if(y)return{$numberInt:t.toString()};if(w)return{$numberLong:t.toString()}}return{$numberDouble:t.toString()}}if(t instanceof RegExp||Dy(t)){var E=t.flags;if(E===void 0){var A=t.toString().match(/[gimuy]*$/);A&&(E=A[0])}var m=new dn(t.source,E);return m.toExtendedJSON(e)}return t!=null&&typeof t=="object"?s0(t,e):t}var o0={Binary:function(t){return new zt(t.value(),t.sub_type)},Code:function(t){return new mi(t.code,t.scope)},DBRef:function(t){return new hn(t.collection||t.namespace,t.oid,t.db,t.fields)},Decimal128:function(t){return new Yo(t.bytes)},Double:function(t){return new _i(t.value)},Int32:function(t){return new wi(t.value)},Long:function(t){return $.fromBits(t.low!=null?t.low:t.low_,t.low!=null?t.high:t.high_,t.low!=null?t.unsigned:t.unsigned_)},MaxKey:function(){return new Xo},MinKey:function(){return new zo},ObjectID:function(t){return new it(t)},ObjectId:function(t){return new it(t)},BSONRegExp:function(t){return new dn(t.pattern,t.options)},Symbol:function(t){return new Qo(t.value)},Timestamp:function(t){return Mu.fromBits(t.low,t.high)}};function s0(t,e){if(t==null||typeof t!="object")throw new Xt("not an object instance");var r=t._bsontype;if(typeof r>"u"){var i={};for(var o in t){e.seenObjects.push({propertyName:o,obj:null});try{var n=Pt(t[o],e);o==="__proto__"?Object.defineProperty(i,o,{value:n,writable:!0,enumerable:!0,configurable:!0}):i[o]=n}finally{e.seenObjects.pop()}}return i}else if(r0(t)){var a=t;if(typeof a.toExtendedJSON!="function"){var c=o0[t._bsontype];if(!c)throw new ce("Unrecognized or invalid _bsontype: "+t._bsontype);a=c(a)}return r==="Code"&&a.scope?a=new mi(a.code,Pt(a.scope,e)):r==="DBRef"&&a.oid&&(a=new hn(Pt(a.collection,e),Pt(a.oid,e),Pt(a.db,e),Pt(a.fields,e))),a.toExtendedJSON(e)}else throw new Xt("_bsontype must be a string, but was: "+typeof r)}var je;(function(t){function e(n,a){var c=Object.assign({},{relaxed:!0,legacy:!1},a);return typeof c.relaxed=="boolean"&&(c.strict=!c.relaxed),typeof c.strict=="boolean"&&(c.relaxed=!c.strict),JSON.parse(n,function(h,s){if(h.indexOf("\0")!==-1)throw new Xt("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(h)));return qu(s,c)})}t.parse=e;function r(n,a,c,h){c!=null&&typeof c=="object"&&(h=c,c=0),a!=null&&typeof a=="object"&&!Array.isArray(a)&&(h=a,a=void 0,c=0);var s=Object.assign({relaxed:!0,legacy:!1},h,{seenObjects:[{propertyName:"(root)",obj:null}]}),u=Pt(n,s);return JSON.stringify(u,a,c)}t.stringify=r;function i(n,a){return a=a||{},JSON.parse(r(n,a))}t.serialize=i;function o(n,a){return a=a||{},e(JSON.stringify(n),a)}t.deserialize=o})(je||(je={}));var wa=Fu();wa.Map?wa.Map:function(){function t(e){e===void 0&&(e=[]),this._keys=[],this._values={};for(var r=0;r<e.length;r++)if(e[r]!=null){var i=e[r],o=i[0],n=i[1];this._keys.push(o),this._values[o]={v:n,i:this._keys.length-1}}}return t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(e){var r=this._values[e];return r==null?!1:(delete this._values[e],this._keys.splice(r.i,1),!0)},t.prototype.entries=function(){var e=this,r=0;return{next:function(){var i=e._keys[r++];return{value:i!==void 0?[i,e._values[i].v]:void 0,done:i===void 0}}}},t.prototype.forEach=function(e,r){r=r||this;for(var i=0;i<this._keys.length;i++){var o=this._keys[i];e.call(r,this._values[o].v,o,r)}},t.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},t.prototype.has=function(e){return this._values[e]!=null},t.prototype.keys=function(){var e=this,r=0;return{next:function(){var i=e._keys[r++];return{value:i!==void 0?i:void 0,done:i===void 0}}}},t.prototype.set=function(e,r){return this._values[e]?(this._values[e].v=r,this):(this._keys.push(e),this._values[e]={v:r,i:this._keys.length-1},this)},t.prototype.values=function(){var e=this,r=0;return{next:function(){var i=e._keys[r++];return{value:i!==void 0?e._values[i].v:void 0,done:i===void 0}}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),t}();$.fromNumber(My);$.fromNumber(ky);var vo=new Uint8Array(8);new DataView(vo.buffer,vo.byteOffset,vo.byteLength);var a0=1024*1024*17;X.alloc(a0);var u0=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},c0=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},f0=function(){function t(e,r){this._stages=[],e&&r&&(this._db=e,this._request=new Be.reqClass(this._db.config),this._collectionName=r)}return t.prototype.end=function(){return u0(this,void 0,void 0,function(){var e;return c0(this,function(r){switch(r.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return e=r.sent(),e&&e.data&&e.data.list?[2,{requestId:e.requestId,data:JSON.parse(e.data.list).map(je.parse)}]:[2,e]}})})},t.prototype.unwrap=function(){return this._stages},t.prototype.done=function(){return this._stages.map(function(e){var r,i=e.stageKey,o=e.stageValue;return r={},r[i]=JSON.parse(o),r})},t.prototype._pipe=function(e,r){return this._stages.push({stageKey:"$"+e,stageValue:JSON.stringify(r)}),this},t.prototype.addFields=function(e){return this._pipe("addFields",e)},t.prototype.bucket=function(e){return this._pipe("bucket",e)},t.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},t.prototype.count=function(e){return this._pipe("count",e)},t.prototype.geoNear=function(e){return this._pipe("geoNear",e)},t.prototype.group=function(e){return this._pipe("group",e)},t.prototype.limit=function(e){return this._pipe("limit",e)},t.prototype.match=function(e){return this._pipe("match",Po.encode(e))},t.prototype.project=function(e){return this._pipe("project",e)},t.prototype.lookup=function(e){return this._pipe("lookup",e)},t.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},t.prototype.sample=function(e){return this._pipe("sample",e)},t.prototype.skip=function(e){return this._pipe("skip",e)},t.prototype.sort=function(e){return this._pipe("sort",e)},t.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},t.prototype.unwind=function(e){return this._pipe("unwind",e)},t}();const Hu=f0;var l0=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),h0=function(t){l0(e,t);function e(r,i){return t.call(this,r,i)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new aa(this._db,this._coll,r)},e.prototype.add=function(r,i){var o=new aa(this._db,this._coll,void 0);return o.create(r,i)},e.prototype.aggregate=function(){return new Hu(this._db,this._coll)},e}(yy),d0={eq:function(t){return new we(H.EQ,[t])},neq:function(t){return new we(H.NEQ,[t])},lt:function(t){return new we(H.LT,[t])},lte:function(t){return new we(H.LTE,[t])},gt:function(t){return new we(H.GT,[t])},gte:function(t){return new we(H.GTE,[t])},in:function(t){return new we(H.IN,t)},nin:function(t){return new we(H.NIN,t)},all:function(t){return new we(H.ALL,t)},elemMatch:function(t){return new we(H.ELEM_MATCH,[t])},exists:function(t){return new we(H.EXISTS,[t])},size:function(t){return new we(H.SIZE,[t])},mod:function(t){return new we(H.MOD,[t])},geoNear:function(t){return new we(H.GEO_NEAR,[t])},geoWithin:function(t){return new we(H.GEO_WITHIN,[t])},geoIntersects:function(t){return new we(H.GEO_INTERSECTS,[t])},and:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new Jt(He.AND,t)},nor:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new Jt(He.NOR,t)},or:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new Jt(He.OR,t)},not:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new Jt(He.NOT,t)},set:function(t){return new ge(K.SET,[t])},remove:function(){return new ge(K.REMOVE,[])},inc:function(t){return new ge(K.INC,[t])},mul:function(t){return new ge(K.MUL,[t])},push:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r;if(Dt(t[0])&&t[0].hasOwnProperty("each")){var i=t[0];r={$each:i.each,$position:i.position,$sort:i.sort,$slice:i.slice}}else de(t[0])?r=t[0]:r=Array.from(t);return new ge(K.PUSH,r)},pull:function(t){return new ge(K.PULL,t)},pullAll:function(t){return new ge(K.PULL_ALL,t)},pop:function(){return new ge(K.POP,[])},shift:function(){return new ge(K.SHIFT,[])},unshift:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new ge(K.UNSHIFT,t)},addToSet:function(t){return new ge(K.ADD_TO_SET,t)},rename:function(t){return new ge(K.RENAME,[t])},bit:function(t){return new ge(K.BIT,[t])},max:function(t){return new ge(K.MAX,[t])},min:function(t){return new ge(K.MIN,[t])},expr:function(t){return{$expr:t}},jsonSchema:function(t){return{$jsonSchema:t}},text:function(t){return uy(t)?{$search:t.search}:{$search:t.search,$language:t.language,$caseSensitive:t.caseSensitive,$diacriticSensitive:t.diacriticSensitive}},aggregate:{pipeline:function(){return new Hu},abs:function(t){return new P("abs",t)},add:function(t){return new P("add",t)},ceil:function(t){return new P("ceil",t)},divide:function(t){return new P("divide",t)},exp:function(t){return new P("exp",t)},floor:function(t){return new P("floor",t)},ln:function(t){return new P("ln",t)},log:function(t){return new P("log",t)},log10:function(t){return new P("log10",t)},mod:function(t){return new P("mod",t)},multiply:function(t){return new P("multiply",t)},pow:function(t){return new P("pow",t)},sqrt:function(t){return new P("sqrt",t)},subtract:function(t){return new P("subtract",t)},trunc:function(t){return new P("trunc",t)},arrayElemAt:function(t){return new P("arrayElemAt",t)},arrayToObject:function(t){return new P("arrayToObject",t)},concatArrays:function(t){return new P("concatArrays",t)},filter:function(t){return new P("filter",t)},in:function(t){return new P("in",t)},indexOfArray:function(t){return new P("indexOfArray",t)},isArray:function(t){return new P("isArray",t)},map:function(t){return new P("map",t)},range:function(t){return new P("range",t)},reduce:function(t){return new P("reduce",t)},reverseArray:function(t){return new P("reverseArray",t)},size:function(t){return new P("size",t)},slice:function(t){return new P("slice",t)},zip:function(t){return new P("zip",t)},and:function(t){return new P("and",t)},not:function(t){return new P("not",t)},or:function(t){return new P("or",t)},cmp:function(t){return new P("cmp",t)},eq:function(t){return new P("eq",t)},gt:function(t){return new P("gt",t)},gte:function(t){return new P("gte",t)},lt:function(t){return new P("lt",t)},lte:function(t){return new P("lte",t)},neq:function(t){return new P("ne",t)},cond:function(t){return new P("cond",t)},ifNull:function(t){return new P("ifNull",t)},switch:function(t){return new P("switch",t)},dateFromParts:function(t){return new P("dateFromParts",t)},dateFromString:function(t){return new P("dateFromString",t)},dayOfMonth:function(t){return new P("dayOfMonth",t)},dayOfWeek:function(t){return new P("dayOfWeek",t)},dayOfYear:function(t){return new P("dayOfYear",t)},isoDayOfWeek:function(t){return new P("isoDayOfWeek",t)},isoWeek:function(t){return new P("isoWeek",t)},isoWeekYear:function(t){return new P("isoWeekYear",t)},millisecond:function(t){return new P("millisecond",t)},minute:function(t){return new P("minute",t)},month:function(t){return new P("month",t)},second:function(t){return new P("second",t)},hour:function(t){return new P("hour",t)},week:function(t){return new P("week",t)},year:function(t){return new P("year",t)},literal:function(t){return new P("literal",t)},mergeObjects:function(t){return new P("mergeObjects",t)},objectToArray:function(t){return new P("objectToArray",t)},allElementsTrue:function(t){return new P("allElementsTrue",t)},anyElementTrue:function(t){return new P("anyElementTrue",t)},setDifference:function(t){return new P("setDifference",t)},setEquals:function(t){return new P("setEquals",t)},setIntersection:function(t){return new P("setIntersection",t)},setIsSubset:function(t){return new P("setIsSubset",t)},setUnion:function(t){return new P("setUnion",t)},concat:function(t){return new P("concat",t)},dateToString:function(t){return new P("dateToString",t)},indexOfBytes:function(t){return new P("indexOfBytes",t)},indexOfCP:function(t){return new P("indexOfCP",t)},split:function(t){return new P("split",t)},strLenBytes:function(t){return new P("strLenBytes",t)},strLenCP:function(t){return new P("strLenCP",t)},strcasecmp:function(t){return new P("strcasecmp",t)},substr:function(t){return new P("substr",t)},substrBytes:function(t){return new P("substrBytes",t)},substrCP:function(t){return new P("substrCP",t)},toLower:function(t){return new P("toLower",t)},toUpper:function(t){return new P("toUpper",t)},meta:function(t){return new P("meta",t)},addToSet:function(t){return new P("addToSet",t)},avg:function(t){return new P("avg",t)},first:function(t){return new P("first",t)},last:function(t){return new P("last",t)},max:function(t){return new P("max",t)},min:function(t){return new P("min",t)},push:function(t){return new P("push",t)},stdDevPop:function(t){return new P("stdDevPop",t)},stdDevSamp:function(t){return new P("stdDevSamp",t)},sum:function(t){return new P("sum",t)},let:function(t){return new P("let",t)}},project:{slice:function(t){return new Ea("slice",t)},elemMatch:function(t){return new Ea("elemMatch",t)}}},P=function(){function t(e,r){this["$"+e]=r}return t}(),Ea=function(){function t(e,r){this["$"+e]=r}return t}(),p0=function(){function t(e){var r=e.regexp,i=e.options;if(!r)throw new TypeError("regexp must be a string");this.$regex=r,this.$options=i}return t.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(t.prototype,"_internalType",{get:function(){return Tu},enumerable:!0,configurable:!0}),t}();function g0(t){return new p0(t)}var Gu={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}},gt=globalThis&&globalThis.__assign||function(){return gt=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},gt.apply(this,arguments)},nn=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},on=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},y0="database.getInTransaction",ba="database.updateDocInTransaction",v0="database.deleteDocInTransaction",m0="database.insertDocInTransaction",Sa=function(){function t(e,r,i){this._coll=r,this.id=i,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return t.prototype.create=function(e){return nn(this,void 0,void 0,function(){var r,i,o,n;return on(this,function(a){switch(a.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,data:je.stringify(ln(e),{relaxed:!1})},this.id&&(r._id=this.id),[4,this._request.send(m0,r)];case 1:if(i=a.sent(),i.code)throw i;if(o=je.parse(i.inserted),n=je.parse(i.ok),n==1&&o==1)return[2,gt(gt({},i),{ok:n,inserted:o})];throw new Error(Gu.INSERT_DOC_FAIL.message)}})})},t.prototype.get=function(){return nn(this,void 0,void 0,function(){var e,r;return on(this,function(i){switch(i.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(y0,e)];case 1:if(r=i.sent(),r.code)throw r;return[2,{data:r.data!=="null"?pi.formatField(je.parse(r.data)):je.parse(r.data),requestId:r.requestId}]}})})},t.prototype.set=function(e){return nn(this,void 0,void 0,function(){var r,i;return on(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:je.stringify(ln(e),{relaxed:!1}),upsert:!0},[4,this._request.send(ba,r)];case 1:if(i=o.sent(),i.code)throw i;return[2,gt(gt({},i),{updated:je.parse(i.updated),upserted:i.upserted?JSON.parse(i.upserted):null})]}})})},t.prototype.update=function(e){return nn(this,void 0,void 0,function(){var r,i;return on(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:je.stringify(Vo.encode(e),{relaxed:!1})},[4,this._request.send(ba,r)];case 1:if(i=o.sent(),i.code)throw i;return[2,gt(gt({},i),{updated:je.parse(i.updated)})]}})})},t.prototype.delete=function(){return nn(this,void 0,void 0,function(){var e,r;return on(this,function(i){switch(i.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(v0,e)];case 1:if(r=i.sent(),r.code)throw r;return[2,gt(gt({},r),{deleted:je.parse(r.deleted)})]}})})},t}(),_0=function(){function t(e,r){this._coll=r,this._transaction=e}return t}(),w0=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),E0=function(t){w0(e,t);function e(r,i){return t.call(this,r,i)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new Sa(this._transaction,this._coll,r)},e.prototype.add=function(r){var i;r._id!==void 0&&(i=r._id);var o=new Sa(this._transaction,this._coll,i);return o.create(r)},e}(_0),_r=globalThis&&globalThis.__awaiter||function(t,e,r,i){function o(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function h(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?n(u.value):o(u.value).then(c,h)}s((i=i.apply(t,e||[])).next())})},wr=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(s[0]===6&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},b0="database.startTransaction",S0="database.commitTransaction",A0="database.abortTransaction",Ku=function(){function t(e){this._db=e,this._request=new Be.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return t.prototype.init=function(){return _r(this,void 0,void 0,function(){var e;return wr(this,function(r){switch(r.label){case 0:return[4,this._request.send(b0)];case 1:if(e=r.sent(),e.code)throw e;return this.inited=!0,this._id=e.transactionId,[2]}})})},t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new E0(this,e)},t.prototype.getTransactionId=function(){return this._id},t.prototype.getRequestMethod=function(){return this._request},t.prototype.commit=function(){return _r(this,void 0,void 0,function(){var e,r;return wr(this,function(i){switch(i.label){case 0:return e={transactionId:this._id},[4,this._request.send(S0,e)];case 1:if(r=i.sent(),r.code)throw r;return this.commited=!0,[2,r]}})})},t.prototype.rollback=function(e){return _r(this,void 0,void 0,function(){var r,i;return wr(this,function(o){switch(o.label){case 0:return r={transactionId:this._id},[4,this._request.send(A0,r)];case 1:if(i=o.sent(),i.code)throw i;return this.aborted=!0,this.abortReason=e,[2,i]}})})},t}();function T0(){return _r(this,void 0,void 0,function(){var t;return wr(this,function(e){switch(e.label){case 0:return t=new Ku(this),[4,t.init()];case 1:return e.sent(),[2,t]}})})}function Vu(t,e){return e===void 0&&(e=3),_r(this,void 0,void 0,function(){var r,i,o,n,a=this;return wr(this,function(c){switch(c.label){case 0:return c.trys.push([0,4,,10]),r=new Ku(this),[4,r.init()];case 1:return c.sent(),[4,t(r)];case 2:if(i=c.sent(),r.aborted===!0)throw r.abortReason;return[4,r.commit()];case 3:return c.sent(),[2,i];case 4:if(o=c.sent(),r.inited===!1)throw o;return n=function(h){return _r(a,void 0,void 0,function(){return wr(this,function(s){switch(s.label){case 0:if(!(!r.aborted&&!r.commited))return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r.rollback()];case 2:return s.sent(),[3,4];case 3:return s.sent(),[3,4];case 4:throw h;case 5:throw r.aborted===!0?r.abortReason:h}})})},e<=0?[4,n(o)]:[3,6];case 5:c.sent(),c.label=6;case 6:return o&&o.code===Gu.DATABASE_TRANSACTION_CONFLICT.code?[4,Vu.bind(this)(t,--e)]:[3,8];case 7:return[2,c.sent()];case 8:return[4,n(o)];case 9:return c.sent(),[3,10];case 10:return[2]}})})}var Be=function(){function t(e){this.config=e,this.Geo=ly,this.serverDate=ay,this.command=d0,this.RegExp=g0,this.startTransaction=T0,this.runTransaction=Vu,this.logicCommand=Jt,this.updateCommand=ge,this.queryCommand=we}return t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new h0(this,e)},t.prototype.createCollection=function(e){var r=new t.reqClass(this.config),i={collectionName:e};return r.send("database.addCollection",i)},t}(),ri=globalThis&&globalThis.__assign||function(){return ri=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ri.apply(this,arguments)},I0="database";function O0(t){var e=this.platform,r=e.adapter,i=e.runtime;return Be.reqClass=this.request.constructor,Be.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},Be.runtime=i,this.wsClientClass&&(Be.wsClass=r.wsClass,Be.wsClientClass=this.wsClientClass),Be.ws||(Be.ws=null),new Be(ri(ri({},this.config),t))}var Ju={name:I0,entity:{database:O0}};try{cloudbase.registerComponent(Ju)}catch{}function x0(t){try{t.registerComponent(Ju)}catch(e){console.warn(e)}}const N0="@cloudbase/js-sdk",R0="1.7.2",C0="cloudbase javascript sdk",P0="dist/index.cjs.js",F0="dist/index.esm.js",B0="miniprogram_dist",D0="./index.d.ts",L0={lint:'eslint --fix "./src/**/*.ts" "./database/**/*.ts"',build:"rm -rf dist/ && gulp build","build:cdn":"gulp cdn","build:miniapp":"gulp miniapp","build:e2e":"rm -rf dist/ && NODE_ENV=e2e gulp e2e"},U0={access:"public"},M0={type:"git",url:"https://github.com/TencentCloudBase/cloudbase-js-sdk"},k0=["tcb","cloudbase","Cloudbase","serverless","Serverless","javascript","JavaScript"],$0=["miniprogram_dist","**/dist/","/index.d.ts","**/package.json"],j0=["app","auth","database","functions","storage"],W0="",q0="ISC",H0={"@cloudbase/analytics":"^1.1.1-alpha.0","@cloudbase/app":"^1.4.1","@cloudbase/auth":"^1.6.1","@cloudbase/database":"0.9.18-next","@cloudbase/functions":"^1.3.4","@cloudbase/realtime":"^1.1.4-alpha.0","@cloudbase/storage":"^1.3.4","@cloudbase/types":"^1.1.3-alpha.0","@cloudbase/utilities":"^1.3.4"},G0={"@babel/core":"^7.9.0","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/plugin-transform-runtime":"^7.9.0","@babel/preset-env":"^7.9.5","@babel/preset-typescript":"^7.9.0","@typescript-eslint/eslint-plugin":"^3.8.0","@typescript-eslint/parser":"^3.8.0","awesome-typescript-loader":"^5.2.1","babel-loader":"^8.1.0",eslint:"^7.6.0","eslint-config-alloy":"^3.7.4",gulp:"^4.0.2","gulp-clean":"^0.4.0","gulp-rename":"^2.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^6.0.0-alpha.1","json-loader":"^0.5.7","merge-stream":"^2.0.0","package-json-cleanup-loader":"^1.0.3",typescript:"^3.8.3",webpack:"4.41.3","webpack-cli":"^3.3.11","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","webpack-visualizer-plugin":"^0.1.11"},K0=["last 2 version","> 1%","not dead","chrome 53"],V0="29ca0bf24318daa1fbb230910edf0b1545e17e7f",J0={name:N0,version:R0,description:C0,main:P0,module:F0,miniprogram:B0,typings:D0,scripts:L0,publishConfig:U0,repository:M0,keywords:k0,files:$0,components:j0,author:W0,license:q0,dependencies:H0,devDependencies:G0,browserslist:K0,gitHead:V0};var Y0=J0.version;tt.registerVersion(Y0);try{rd(tt),ld(tt),gd(tt),x0(tt),$g(tt),zg(tt)}catch{}try{window.cloudbase=tt}catch{}const Yu=tt.init({env:"hitwh-innovation-society-c0a6eda"}),dr=Yu.auth({persistence:"none"});Yu.database();const Zo=t=>(lf("data-v-8c6500c3"),t=t(),hf(),t),X0={class:"container"},z0={class:"board"},Q0=Zo(()=>he("div",{class:"left"},null,-1)),Z0={class:"right"},ev={class:"PhoneDiv"},tv={key:0,class:"phoneReg"},rv={class:"CodeDiv"},nv={class:"CodeDiv"},iv=Zo(()=>he("div",{class:"forgetPassword"},"本次登录将会重置您的密码为上方所设",-1)),ov={class:"PhoneDiv"},sv={key:0,class:"phoneReg"},av={class:"CodeDiv"},uv={class:"CodeDiv"},cv={class:"PhoneDiv"},fv={key:0,class:"phoneReg"},lv={class:"CodeDiv"},hv={class:"CodeDiv"},dv={class:"BtnDiv"},pv=Zo(()=>he("div",{class:"tip"},"HitWh创投社",-1)),gv=sf({__name:"Login",setup(t){const e=df();pf();let r=Je(""),i=Je(""),o=Je(""),n=Je(""),a=Je(""),c=Je(""),h=Je(""),s=Je(""),u=Je(""),d=Je(0),y=0,w=0,E=Je(1),A=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,m=Je(!1);af(()=>{});function _(F){console.log(F),w?(clearTimeout(w),w=setTimeout(()=>{A.test(F.trim())?m.value=!1:m.value=!0},2e3)):w=setTimeout(()=>{A.test(F.trim())?m.value=!1:m.value=!0},2e3)}function x(){E.value==0&&A.test(r.value.trim())?(m.value=!1,dr.sendPhoneCode(r.value).then(F=>{console.log("验证码发送成功"),Fr({title:"验证码发送成功",message:Br("i",{style:"color: teal"},"请注意查收短信，若未收到短信，请在60秒后重试")}),d.value=60,y=setInterval(()=>{d.value--,d.value||clearInterval(y)},1e3)})):E.value==1&&A.test(r.value.trim())?(m.value=!1,dr.sendPhoneCode(r.value).then(F=>{console.log("验证码发送成功"),Fr({title:"验证码发送成功",message:Br("i",{style:"color: teal"},"请注意查收短信，若未收到短信，请在60秒后重试")}),d.value=60,y=setInterval(()=>{d.value--,d.value||clearInterval(y)},1e3)})):E.value==3&&A.test(h.value.trim())?(m.value=!1,dr.sendPhoneCode(h.value).then(F=>{console.log("验证码发送成功"),Fr({title:"验证码发送成功",message:Br("i",{style:"color: teal"},"请注意查收短信，若未收到短信，请在60秒后重试")}),d.value=60,y=setInterval(()=>{d.value--,d.value||clearInterval(y)},1e3)})):m.value=!0}function I(){E.value==3?dr.forceResetPwdByPhoneCode({phoneNumber:h.value,phoneCode:s.value,password:u.value}).then(F=>{console.log("登录成功"),e.push({name:"Home",query:{}})}).catch(F=>{console.log("0",F,"0"),Fr({title:"修改密码失败",message:Br("i",{style:"color: teal"},"您设置的新密码太短或者太弱！")})}):dr.signInWithPhoneCodeOrPassword({phoneNumber:r.value,phoneCode:i.value,password:o.value}).then(F=>{console.log("登录成功"),e.push({name:"Home",query:{}})}).catch(F=>{console.log("error",F),Fr({title:"登录失败",message:Br("i",{style:"color: teal"},"请查看手机号或者密码或者验证码是否输入正确")})})}function T(){dr.signUpWithPhoneCode(n.value,a.value,c.value).then(F=>{console.log("注册成功",F)}).catch(F=>{console.log("注册失败")})}return(F,R)=>{const L=uf,k=cf;return At(),St("div",X0,[he("div",z0,[Q0,he("div",Z0,[W(E)==3?(At(),St(Fi,{key:0},[he("div",ev,[Te(k,{modelValue:W(h),"onUpdate:modelValue":R[0]||(R[0]=B=>me(h)?h.value=B:h=B),class:"w-50 m-2",placeholder:"Phone","prefix-icon":W(Tn),clearable:"",onInput:_},{append:lt(()=>[Oe(Te(L,{type:"primary",onClick:x},{default:lt(()=>[Dr("getCode")]),_:1},512),[[xe,!W(d)]]),Oe(he("span",null,Lr(W(d)),513),[[xe,W(d)]])]),_:1},8,["modelValue","prefix-icon"]),W(m)?(At(),St("div",tv,"请检查手机号是否合规")):Bi("",!0)]),he("div",rv,[Te(k,{type:"Code",modelValue:W(s),"onUpdate:modelValue":R[1]||(R[1]=B=>me(s)?s.value=B:s=B),class:"w-50 m-2",placeholder:"Code","prefix-icon":W(Ur),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),he("div",nv,[Te(k,{type:"Password",modelValue:W(u),"onUpdate:modelValue":R[2]||(R[2]=B=>me(u)?u.value=B:u=B),class:"w-50 m-2",placeholder:"Password","prefix-icon":W(Ur),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"]),iv])],64)):W(E)?(At(),St(Fi,{key:1},[he("div",ov,[Oe(Te(k,{modelValue:W(r),"onUpdate:modelValue":R[3]||(R[3]=B=>me(r)?r.value=B:r=B),class:"w-50 m-2",placeholder:"Phone","prefix-icon":W(Tn),clearable:"",onInput:_},{append:lt(()=>[Oe(Te(L,{type:"primary",onClick:x},{default:lt(()=>[Dr("getCode")]),_:1},512),[[xe,!W(d)]]),Oe(he("span",null,Lr(W(d)),513),[[xe,W(d)]])]),_:1},8,["modelValue","prefix-icon"]),[[xe,W(E)==1]]),Oe(Te(k,{modelValue:W(r),"onUpdate:modelValue":R[4]||(R[4]=B=>me(r)?r.value=B:r=B),class:"w-50 m-2",placeholder:"Phone","prefix-icon":W(Tn),clearable:"",onInput:_},null,8,["modelValue","prefix-icon"]),[[xe,W(E)==2]]),W(m)?(At(),St("div",sv,"请检查手机号是否合规")):Bi("",!0)]),Oe(he("div",av,[Te(k,{type:"Code",modelValue:W(i),"onUpdate:modelValue":R[6]||(R[6]=B=>me(i)?i.value=B:i=B),class:"w-50 m-2",placeholder:"Code","prefix-icon":W(Ur),"show-password":"",clearable:""},{append:lt(()=>[Oe(Te(L,{type:"primary",onClick:R[5]||(R[5]=B=>me(E)?E.value=W(E)==1?2:1:E=W(E)==1?2:1),icon:W(ps)},null,8,["icon"]),[[xe,!W(d)]]),Oe(he("span",null,Lr(W(d)),513),[[xe,W(d)]])]),_:1},8,["modelValue","prefix-icon"])],512),[[xe,W(E)==1]]),Oe(he("div",uv,[Te(k,{type:"Password",modelValue:W(o),"onUpdate:modelValue":R[8]||(R[8]=B=>me(o)?o.value=B:o=B),class:"w-50 m-2",placeholder:"Password","prefix-icon":W(Ur),"show-password":"",clearable:""},{append:lt(()=>[Oe(Te(L,{type:"primary",onClick:R[7]||(R[7]=B=>me(E)?E.value=W(E)==1?2:1:E=W(E)==1?2:1),icon:W(ps)},null,8,["icon"]),[[xe,!W(d)]]),Oe(he("span",null,Lr(W(d)),513),[[xe,W(d)]])]),_:1},8,["modelValue","prefix-icon"]),he("div",{class:"forgetPassword",onClick:R[9]||(R[9]=B=>{me(E)?E.value=3:E=3,me(m)?m.value=!1:m=!1})}," 忘记密码 ")],512),[[xe,W(E)==2]])],64)):(At(),St(Fi,{key:2},[he("div",cv,[Te(k,{modelValue:W(n),"onUpdate:modelValue":R[10]||(R[10]=B=>me(n)?n.value=B:n=B),class:"w-50 m-2",placeholder:"Phone","prefix-icon":W(Tn),clearable:"",onInput:_},{append:lt(()=>[Oe(Te(L,{type:"primary",onClick:x},{default:lt(()=>[Dr("getCode")]),_:1},512),[[xe,!W(d)]]),Oe(he("span",null,Lr(W(d)),513),[[xe,W(d)]])]),_:1},8,["modelValue","prefix-icon"]),W(m)?(At(),St("div",fv,"请检查手机号是否合规")):Bi("",!0)]),he("div",lv,[Te(k,{type:"Code",modelValue:W(a),"onUpdate:modelValue":R[11]||(R[11]=B=>me(a)?a.value=B:a=B),class:"w-50 m-2",placeholder:"Code","prefix-icon":W(ff),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),he("div",hv,[Te(k,{type:"Password",modelValue:W(c),"onUpdate:modelValue":R[12]||(R[12]=B=>me(c)?c.value=B:c=B),class:"w-50 m-2",placeholder:"Password","prefix-icon":W(Ur),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])])],64)),he("div",dv,[Oe(Te(L,{type:"primary",size:"large",onClick:I},{default:lt(()=>[Dr("Login")]),_:1},512),[[xe,W(E)]]),Oe(Te(L,{type:"primary",size:"large",onClick:T},{default:lt(()=>[Dr("Sign")]),_:1},512),[[xe,!W(E)]]),W(E)?(At(),St("div",{key:0,class:"signup",onClick:R[13]||(R[13]=B=>{me(E)?E.value=0:E=0,me(m)?m.value=!1:m=!1})}," signup ")):(At(),St("div",{key:1,class:"signup",onClick:R[14]||(R[14]=B=>{me(E)?E.value=2:E=2,me(m)?m.value=!1:m=!1})}," back "))]),pv])])])}}});const _v=gf(gv,[["__scopeId","data-v-8c6500c3"]]);export{_v as default};
